<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>MySQL InnoDB 引擎 | 代码狗的小屋</title><meta name="author" content="Code Dog"><meta name="copyright" content="Code Dog"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="逻辑存储结构 表空间（Tablespace）：一个 MySQL 实例可以对应多个表空间，用于存储记录、索引等数据，一个表空间内含有多个段（Segment）。 段（Segment）：分为数据段（Leaf node segment）、索引段（Non-leaf node segment）、回滚段（Rollback segment），InnoDB 是索引组织表，数据段就是 B+ 树的叶子节点，索引段就是">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL InnoDB 引擎">
<meta property="og:url" content="https://codedog1024.github.io/2025/12/09/MySQL12/index.html">
<meta property="og:site_name" content="代码狗的小屋">
<meta property="og:description" content="逻辑存储结构 表空间（Tablespace）：一个 MySQL 实例可以对应多个表空间，用于存储记录、索引等数据，一个表空间内含有多个段（Segment）。 段（Segment）：分为数据段（Leaf node segment）、索引段（Non-leaf node segment）、回滚段（Rollback segment），InnoDB 是索引组织表，数据段就是 B+ 树的叶子节点，索引段就是">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://codedog1024.github.io/img/04.jpg">
<meta property="article:published_time" content="2025-12-09T13:41:17.000Z">
<meta property="article:modified_time" content="2025-12-11T14:09:37.569Z">
<meta property="article:author" content="Code Dog">
<meta property="article:tag" content="MySQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://codedog1024.github.io/img/04.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "MySQL InnoDB 引擎",
  "url": "https://codedog1024.github.io/2025/12/09/MySQL12/",
  "image": "https://codedog1024.github.io/img/04.jpg",
  "datePublished": "2025-12-09T13:41:17.000Z",
  "dateModified": "2025-12-11T14:09:37.569Z",
  "author": [
    {
      "@type": "Person",
      "name": "Code Dog",
      "url": "https://codedog1024.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://codedog1024.github.io/2025/12/09/MySQL12/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const hour = new Date().getHours()
          const isNight = hour <= 6 || hour >= 1
          if (theme === undefined) isNight ? activateDarkMode() : activateLightMode()
          else theme === 'light' ? activateLightMode() : activateDarkMode()
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'MySQL InnoDB 引擎',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">40</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/04.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">代码狗的小屋</span></a><a class="nav-page-title" href="/"><span class="site-name">MySQL InnoDB 引擎</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">MySQL InnoDB 引擎</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-12-09T13:41:17.000Z" title="发表于 2025-12-09 21:41:17">2025-12-09</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-12-11T14:09:37.569Z" title="更新于 2025-12-11 22:09:37">2025-12-11</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h2 id="逻辑存储结构"><a href="#逻辑存储结构" class="headerlink" title="逻辑存储结构"></a>逻辑存储结构</h2><ol>
<li>表空间（Tablespace）：一个 MySQL 实例可以对应多个表空间，用于存储<code>记录</code>、<code>索引</code>等数据，一个表空间内含有多个段（Segment）。</li>
<li>段（Segment）：分为<code>数据段（Leaf node segment）</code>、<code>索引段（Non-leaf node segment）</code>、<code>回滚段（Rollback segment）</code>，InnoDB 是索引组织表，数据段就是 B+ 树的叶子节点，索引段就是 B+ 数据非叶子阶段。一个段内含有多个区（Extent）。</li>
<li>区（Extent）：每个区的大小为 <code>1M</code>，默认情况下，一个区中含有 <code>64</code> 个页（Page），即每个页的大小为 <code>16 K</code>.</li>
<li>页（Page）：InnoDB 引擎最小的存储单元，每个页大小为 <code>16K</code>，为了保证页的连续性，InnoDB 引擎每次会从磁盘申请 4 ~ 5 个区。</li>
<li>行（Row）：即每一条记录。包含两个隐藏字段：<code>Trx_id</code> 和 <code>Roll_pointer</code>，Trx_id 用于保存事务 id，Roll_pointer 用于保存记录的旧值记录。</li>
</ol>
<h2 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h2><p>MySQL 5.5 之后，InndDB 引擎为默认的存储引擎。在架构上，InnoDB 引擎分为<code>内存架构</code>和<code>磁盘架构</code>。</p>
<h3 id="内存架构"><a href="#内存架构" class="headerlink" title="内存架构"></a>内存架构</h3><h4 id="Buffer-Pool"><a href="#Buffer-Pool" class="headerlink" title="Buffer Pool"></a>Buffer Pool</h4><p><code>缓冲池</code>是主内存中的一个区域，用于保存<code>常用数据</code>，当操作数据时，优先判断<code>缓冲池中是否</code>，存在则直接<code>操作缓冲池的数据</code>，<code>再写入到磁盘</code>，减少IO，加快处理速度。若<code>不存在</code>，则<code>从磁盘加载数据并存入缓冲池</code>。</p>
<p><code>缓冲池</code>中的存储单位是<code>页（Page）</code>，底层使用<code>链表数据结构</code>来管理每个页（Page），每个页都有<code>三种状态</code>，分为是：</p>
<ol>
<li>Free：未使用，空闲的页</li>
<li>Clean：被使用，数据未被修改过的页，保存的数据与磁盘中的数据一致</li>
<li>Dirty：被使用，数据被修改过的页，保存的数据与磁盘中的数据不一致</li>
</ol>
<h4 id="Change-Buffer"><a href="#Change-Buffer" class="headerlink" title="Change Buffer"></a>Change Buffer</h4><p><code>更改缓冲区</code>，只用于<code>非唯一二级索引页</code>，在执行 DML 语句时，如果<code>缓冲池</code>中不存在数据，会将数据变更保存在这里，等待未来数据被读取时，再将原始数据与被修改后的数据合并，并存入<code>缓冲池</code>，之后再由<code>缓冲池</code>将数据写入磁盘。</p>
<h4 id="Adaptive-Hash-Index"><a href="#Adaptive-Hash-Index" class="headerlink" title="Adaptive Hash Index"></a>Adaptive Hash Index</h4><p><code>自适应哈希索引</code>，用于优化对<code>缓冲池</code>中数据的查询，InnoDB 引擎会自动检测每个索引页，如果观测到 Hash 索引可以提升查询速度，则建立 Hash 索引，因此称为<code>自适应哈希索引</code>。</p>
<p><code>自适应哈希索引</code>的开启可以通过 <code>innodb_adaptive_hash_index</code> 全局参数来控制，默认为 <code>ON</code>。</p>
<h4 id="Log-Buffer"><a href="#Log-Buffer" class="headerlink" title="Log Buffer"></a>Log Buffer</h4><p><code>日志缓冲区</code>，用来保存要写入磁盘的<code>日志信息（redo log、undo log）</code>，默认大小为 <code>16MB</code>，日志缓冲区的日志会定期写入到磁盘中，适当增加缓冲区的大小，可以较少磁盘IO。</p>
<p><code>日志缓冲区</code>的大小可以通过 <code>innodb_log_buffer_size</code> 全局参数控制，默认大小为 <code>16777216</code>。<br><code>日志缓冲区</code>的日志写入时机可以通过 <code>innodb_flush_log_at_trx_commit</code> 全局参数控制，默认值为 <code>1</code>。</p>
<ul>
<li>0：每秒将日志写入磁盘</li>
<li>1：当事务提交时将日志写入磁盘</li>
<li>2：每秒将日志写入磁盘，事务提交后也会写入磁盘</li>
</ul>
<h3 id="磁盘架构"><a href="#磁盘架构" class="headerlink" title="磁盘架构"></a>磁盘架构</h3><h4 id="System-Tavkesoace"><a href="#System-Tavkesoace" class="headerlink" title="System Tavkesoace"></a>System Tavkesoace</h4><p><code>系统表空间</code>是<code>更改缓冲区</code>的存储空间，可以通过 <code>innodb_data_file_path</code> 全局参数来查看文件所在位置。</p>
<h4 id="File-Per-Table-Tablespaces"><a href="#File-Per-Table-Tablespaces" class="headerlink" title="File-Per-Table-Tablespaces"></a>File-Per-Table-Tablespaces</h4><p><code>文件表空间</code>，该区域用于保存每个表的数据和索引，可以通过 <code>innodb_file_per_table</code> 全局参数来开启，默认为开启状态，因此每个系统表都会有对应的文件来存储。</p>
<h4 id="General-Tablespaces"><a href="#General-Tablespaces" class="headerlink" title="General Tablespaces"></a>General Tablespaces</h4><p><code>通用表空间</code>，该空间需要通过 <code>CREATE TABLESPACE</code> 语法来手动创建，并且在建表是，可以通过 <code>CREATE TABLE xxx ... TABLESPACE xxx</code> 来指定表空间。</p>
<ol>
<li><p>创建表空间</p>
<blockquote>
<p>CREATE TABLESPACE 表空间名 ADD DATAFILE 文件名 ENGINE&#x3D;引擎名;</p>
</blockquote>
</li>
<li><p>指定表空间</p>
<blockquote>
<p>CREATE TABLE 表名 … TABLESAPCE 表空间名;</p>
</blockquote>
</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建表空间</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">CREATE</span> TABLESPACE test_space <span class="keyword">ADD</span> DATAFILE <span class="string">&#x27;test_space.ibd&#x27;</span> ENGINE<span class="operator">=</span>InnoDB;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.08</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建表并指定表空间</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">CREATE TABLE</span> tb_test(id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT, name <span class="type">VARCHAR</span>(<span class="number">10</span>))ENGINE<span class="operator">=</span>INNODB TABLESPACE test_space;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.04</span> sec)</span><br></pre></td></tr></table></figure>

<h4 id="Undo-Tablespaces"><a href="#Undo-Tablespaces" class="headerlink" title="Undo Tablespaces"></a>Undo Tablespaces</h4><p><code>撤销表空间</code>，用于存储 <code>undo log</code> 日志，每个 MySQL 实例在初始化是都会<code>创建两个默认的撤销表空间</code>，默认大小为 <code>16MB</code>。</p>
<h4 id="Temp-Tablespaces"><a href="#Temp-Tablespaces" class="headerlink" title="Temp Tablespaces"></a>Temp Tablespaces</h4><p><code>临时表空间</code>，用于存储创建的临时表。</p>
<h4 id="Doublewrite-Buffer-Files"><a href="#Doublewrite-Buffer-Files" class="headerlink" title="Doublewrite Buffer Files"></a>Doublewrite Buffer Files</h4><p><code>双写缓冲区</code>，为了保证数据安全，InnoDB 引擎在将数据页的数据从<code>缓冲池</code>中写入到<code>磁盘</code>前，会先将数据读入到<code>双写缓冲区</code>，以便系统异常时<code>恢复数据</code>。</p>
<p>文件名：<code>#ib_16384_0.dblwr</code> 和 <code>#ib_16384_1.dblwr</code></p>
<h4 id="Redo-Log"><a href="#Redo-Log" class="headerlink" title="Redo Log"></a>Redo Log</h4><p><code>重做日志</code>，用来实现事务的持久性，该日志文件由两部分组成，分别为：<code>重做日志缓冲区（redo log buffer）</code>和<code>重做日志文件（redo log）</code>，前者存在于内存中，而后则存在于磁盘中。当事务提交后，会把所有的修改信息保存在该日志中，在将<code>脏页</code>中的数据写入到磁盘时，若发生错误，则可以通过该日志恢复。</p>
<p>文件名：<code>ib_logfile0</code> 和 <code>ib_logfile1</code></p>
<h3 id="后台线程"><a href="#后台线程" class="headerlink" title="后台线程"></a>后台线程</h3><p><code>后台线程</code>用于将<code>缓冲池</code>中的数据在合适的时机写入到<code>磁盘文件</code>中。</p>
<h4 id="Master-Thread"><a href="#Master-Thread" class="headerlink" title="Master Thread"></a>Master Thread</h4><p>核心后台线程，<code>负责调度其他线程</code>，还负责将缓冲池的数据异步写入到磁盘文件中，保持数据的一致性，还包括脏页的刷新、合并插入缓存、undo 页的回收。</p>
<h4 id="IO-Thread"><a href="#IO-Thread" class="headerlink" title="IO Thread"></a>IO Thread</h4><p>InnoDB 引擎中大量的使用了 <code>AIO</code> 来处理 IO 请求，这样可以极大的提高数据库的性能，IO Thread 主要负责这些 IO 请求的回调。</p>
<table>
<thead>
<tr>
<th>线程类型</th>
<th>默认个数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>Read Thread</td>
<td>4</td>
<td>负责读操作</td>
</tr>
<tr>
<td>Write Thread</td>
<td>4</td>
<td>负责写操作</td>
</tr>
<tr>
<td>Log Thread</td>
<td>1</td>
<td>负责将日志缓冲区的数据写入到磁盘</td>
</tr>
<tr>
<td>Insert buffer Thread</td>
<td>1</td>
<td>负责将写缓冲区的数据写入到磁盘</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span>  <span class="keyword">SHOW</span> ENGINE INNODB STATUS;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------+------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> Type   <span class="operator">|</span> Name <span class="operator">|</span> Status                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------+------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> InnoDB <span class="operator">|</span>      <span class="operator">|</span> </span><br><span class="line"><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span></span><br><span class="line"><span class="number">2025</span><span class="number">-12</span><span class="number">-10</span> <span class="number">22</span>:<span class="number">23</span>:<span class="number">02</span> <span class="number">135807807575744</span> INNODB MONITOR OUTPUT</span><br><span class="line"><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span></span><br><span class="line"><span class="keyword">Per</span> <span class="keyword">second</span> averages calculated <span class="keyword">from</span> the <span class="keyword">last</span> <span class="number">7</span> seconds</span><br><span class="line"><span class="comment">-----------------</span></span><br><span class="line">BACKGROUND THREAD</span><br><span class="line"><span class="comment">-----------------</span></span><br><span class="line">srv_master_thread loops: <span class="number">152</span> srv_active, <span class="number">0</span> srv_shutdown, <span class="number">1699977</span> srv_idle</span><br><span class="line">srv_master_thread log flush <span class="keyword">and</span> writes: <span class="number">0</span></span><br><span class="line"><span class="comment">----------</span></span><br><span class="line">SEMAPHORES</span><br><span class="line"><span class="comment">----------</span></span><br><span class="line">OS WAIT <span class="keyword">ARRAY</span> INFO: reservation count <span class="number">1435</span></span><br><span class="line">OS WAIT <span class="keyword">ARRAY</span> INFO: signal count <span class="number">1342</span></span><br><span class="line">RW<span class="operator">-</span>shared spins <span class="number">0</span>, rounds <span class="number">0</span>, OS waits <span class="number">0</span></span><br><span class="line">RW<span class="operator">-</span>excl spins <span class="number">0</span>, rounds <span class="number">0</span>, OS waits <span class="number">0</span></span><br><span class="line">RW<span class="operator">-</span>sx spins <span class="number">0</span>, rounds <span class="number">0</span>, OS waits <span class="number">0</span></span><br><span class="line">Spin rounds <span class="keyword">per</span> wait: <span class="number">0.00</span> RW<span class="operator">-</span>shared, <span class="number">0.00</span> RW<span class="operator">-</span>excl, <span class="number">0.00</span> RW<span class="operator">-</span>sx</span><br><span class="line"><span class="comment">------------</span></span><br><span class="line">TRANSACTIONS</span><br><span class="line"><span class="comment">------------</span></span><br><span class="line">Trx id counter <span class="number">16208099</span></span><br><span class="line">Purge done <span class="keyword">for</span> trx<span class="string">&#x27;s n:o &lt; 16208099 undo n:o &lt; 0 state: running but idle</span></span><br><span class="line"><span class="string">History list length 0</span></span><br><span class="line"><span class="string">LIST OF TRANSACTIONS FOR EACH SESSION:</span></span><br><span class="line"><span class="string">---TRANSACTION 417283258445016, not started</span></span><br><span class="line"><span class="string">0 lock struct(s), heap size 1128, 0 row lock(s)</span></span><br><span class="line"><span class="string">---TRANSACTION 417283258444208, not started</span></span><br><span class="line"><span class="string">0 lock struct(s), heap size 1128, 0 row lock(s)</span></span><br><span class="line"><span class="string">---TRANSACTION 417283258443400, not started</span></span><br><span class="line"><span class="string">0 lock struct(s), heap size 1128, 0 row lock(s)</span></span><br><span class="line"><span class="string">--------</span></span><br><span class="line"><span class="string">FILE I/O</span></span><br><span class="line"><span class="string">--------</span></span><br><span class="line"><span class="string">I/O thread 0 state: waiting for completed aio requests (insert buffer thread)</span></span><br><span class="line"><span class="string">I/O thread 1 state: waiting for completed aio requests (read thread)</span></span><br><span class="line"><span class="string">I/O thread 2 state: waiting for completed aio requests (read thread)</span></span><br><span class="line"><span class="string">I/O thread 3 state: waiting for completed aio requests (read thread)</span></span><br><span class="line"><span class="string">I/O thread 4 state: waiting for completed aio requests (read thread)</span></span><br><span class="line"><span class="string">I/O thread 5 state: waiting for completed aio requests (write thread)</span></span><br><span class="line"><span class="string">I/O thread 6 state: waiting for completed aio requests (write thread)</span></span><br><span class="line"><span class="string">I/O thread 7 state: waiting for completed aio requests (write thread)</span></span><br><span class="line"><span class="string">I/O thread 8 state: waiting for completed aio requests (write thread)</span></span><br><span class="line"><span class="string">Pending normal aio reads: [0, 0, 0, 0] , aio writes: [0, 0, 0, 0] ,</span></span><br><span class="line"><span class="string"> ibuf aio reads:</span></span><br><span class="line"><span class="string">Pending flushes (fsync) log: 0; buffer pool: 0</span></span><br><span class="line"><span class="string">127074 OS file reads, 41083 OS file writes, 17100 OS fsyncs</span></span><br><span class="line"><span class="string">0.00 reads/s, 0 avg bytes/read, 0.00 writes/s, 0.00 fsyncs/s</span></span><br><span class="line"><span class="string">-------------------------------------</span></span><br><span class="line"><span class="string">INSERT BUFFER AND ADAPTIVE HASH INDEX</span></span><br><span class="line"><span class="string">-------------------------------------</span></span><br><span class="line"><span class="string">Ibuf: size 1, free list len 0, seg size 2, 0 merges</span></span><br><span class="line"><span class="string">merged operations:</span></span><br><span class="line"><span class="string"> insert 0, delete mark 0, delete 0</span></span><br><span class="line"><span class="string">discarded operations:</span></span><br><span class="line"><span class="string"> insert 0, delete mark 0, delete 0</span></span><br><span class="line"><span class="string">Hash table size 34679, node heap has 7 buffer(s)</span></span><br><span class="line"><span class="string">Hash table size 34679, node heap has 2 buffer(s)</span></span><br><span class="line"><span class="string">Hash table size 34679, node heap has 2 buffer(s)</span></span><br><span class="line"><span class="string">Hash table size 34679, node heap has 2 buffer(s)</span></span><br><span class="line"><span class="string">Hash table size 34679, node heap has 2 buffer(s)</span></span><br><span class="line"><span class="string">Hash table size 34679, node heap has 2 buffer(s)</span></span><br><span class="line"><span class="string">Hash table size 34679, node heap has 2 buffer(s)</span></span><br><span class="line"><span class="string">Hash table size 34679, node heap has 1 buffer(s)</span></span><br><span class="line"><span class="string">0.00 hash searches/s, 0.00 non-hash searches/s</span></span><br><span class="line"><span class="string">---</span></span><br><span class="line"><span class="string">LOG</span></span><br><span class="line"><span class="string">---</span></span><br><span class="line"><span class="string">Log sequence number          7478758901</span></span><br><span class="line"><span class="string">Log buffer assigned up to    7478758901</span></span><br><span class="line"><span class="string">Log buffer completed up to   7478758901</span></span><br><span class="line"><span class="string">Log written up to            7478758901</span></span><br><span class="line"><span class="string">Log flushed up to            7478758901</span></span><br><span class="line"><span class="string">Added dirty pages up to      7478758901</span></span><br><span class="line"><span class="string">Pages flushed up to          7478758901</span></span><br><span class="line"><span class="string">Last checkpoint at           7478758901</span></span><br><span class="line"><span class="string">Log minimum file id is       2282</span></span><br><span class="line"><span class="string">Log maximum file id is       2283</span></span><br><span class="line"><span class="string">8651 log i/o&#x27;</span>s done, <span class="number">0.00</span> log i<span class="operator">/</span>o<span class="string">&#x27;s/second</span></span><br><span class="line"><span class="string">----------------------</span></span><br><span class="line"><span class="string">BUFFER POOL AND MEMORY</span></span><br><span class="line"><span class="string">----------------------</span></span><br><span class="line"><span class="string">Total large memory allocated 0</span></span><br><span class="line"><span class="string">Dictionary memory allocated 655290</span></span><br><span class="line"><span class="string">Buffer pool size   8192</span></span><br><span class="line"><span class="string">Free buffers       3107</span></span><br><span class="line"><span class="string">Database pages     5065</span></span><br><span class="line"><span class="string">Old database pages 1851</span></span><br><span class="line"><span class="string">Modified db pages  0</span></span><br><span class="line"><span class="string">Pending reads      0</span></span><br><span class="line"><span class="string">Pending writes: LRU 0, flush list 0, single page 0</span></span><br><span class="line"><span class="string">Pages made young 1025, not young 201951</span></span><br><span class="line"><span class="string">0.00 youngs/s, 0.00 non-youngs/s</span></span><br><span class="line"><span class="string">Pages read 114645, created 8698, written 12947</span></span><br><span class="line"><span class="string">0.00 reads/s, 0.00 creates/s, 0.00 writes/s</span></span><br><span class="line"><span class="string">No buffer pool page gets since the last printout</span></span><br><span class="line"><span class="string">Pages read ahead 0.00/s, evicted without access 0.00/s, Random read ahead 0.00/s</span></span><br><span class="line"><span class="string">LRU len: 5065, unzip_LRU len: 0</span></span><br><span class="line"><span class="string">I/O sum[0]:cur[0], unzip sum[0]:cur[0]</span></span><br><span class="line"><span class="string">--------------</span></span><br><span class="line"><span class="string">ROW OPERATIONS</span></span><br><span class="line"><span class="string">--------------</span></span><br><span class="line"><span class="string">0 queries inside InnoDB, 0 queries in queue</span></span><br><span class="line"><span class="string">0 read views open inside InnoDB</span></span><br><span class="line"><span class="string">Process ID=11545, Main thread ID=135807587309248 , state=sleeping</span></span><br><span class="line"><span class="string">Number of rows inserted 145, updated 5, deleted 4, read 5826966</span></span><br><span class="line"><span class="string">0.00 inserts/s, 0.00 updates/s, 0.00 deletes/s, 0.00 reads/s</span></span><br><span class="line"><span class="string">Number of system rows inserted 1371, updated 763, deleted 1281, read 87908</span></span><br><span class="line"><span class="string">0.00 inserts/s, 0.00 updates/s, 0.00 deletes/s, 0.00 reads/s</span></span><br><span class="line"><span class="string">----------------------------</span></span><br><span class="line"><span class="string">END OF INNODB MONITOR OUTPUT</span></span><br><span class="line"><span class="string">============================</span></span><br><span class="line"><span class="string"> |</span></span><br><span class="line"><span class="string">+--------+------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="string">1 row in set (0.00 sec)</span></span><br></pre></td></tr></table></figure>

<h4 id="Purge-Thread"><a href="#Purge-Thread" class="headerlink" title="Purge Thread"></a>Purge Thread</h4><p>用于回收当事务提交之后的 undo log，当事务提交后，undo log 就没用了，使用此线程回收。</p>
<h4 id="Page-Cleaner-Thread"><a href="#Page-Cleaner-Thread" class="headerlink" title="Page Cleaner Thread"></a>Page Cleaner Thread</h4><p>协助 Master Thread 将脏页数据写入到磁盘中，减轻 Master Thread 的压力，减少阻塞。</p>
<h2 id="事务原理"><a href="#事务原理" class="headerlink" title="事务原理"></a>事务原理</h2><p><code>事务</code>是一组操作的集合，它是一个不可分割的工作单位，事务中的所有操作被视为一个整体，要么全部执行成功，要么全部执行失败。</p>
<p>事物的特性（ACID）：</p>
<ol>
<li>原子性（Atomicity）：事务时不可分割的最小操作单元</li>
<li>一致性（Consistency）：事务完成时，所有数据状态一致</li>
<li>隔离性（Isolation）：事务开启后，不会受到外部并发操作的影响</li>
<li>持久性（Durability）：事务一旦提交或回滚，对数据的改变是永久性的</li>
</ol>
<p>原子性、一致性、隔离性是基于 InnoDB 引擎中的 <code>redo log</code> 和 <code>undo log</code> 来实现的。隔离性是基于<code>锁</code>和 <code>MVCC</code> 来实现的。</p>
<h3 id="Redo-log"><a href="#Redo-log" class="headerlink" title="Redo log"></a>Redo log</h3><p><code>重做日志</code>，用于记录事务提交时对数据页所做的物理修改，以此来实现<code>持久性</code>。</p>
<p>该日志由两部分组成，分别是 <code>重做日志缓冲区（redo log buffer0</code> 和 <code>重做日志文件（redo log file）</code>，前者存在于内存中，后者在磁盘中。当事务提交时，会把所有的修改记录保存在重做日志文件中，当缓冲池将脏页数据写入到磁盘时，如果发生错误，可以根据记录来恢复数据。</p>
<h3 id="Undo-log"><a href="#Undo-log" class="headerlink" title="Undo log"></a>Undo log</h3><p><code>回滚日志</code>，用于记录数据被修改前的信息，当发生回滚时，可以根据 Undo log 中的记录逆向恢复数据。</p>
<p>当我们在操作数据时，会在 undo log 中记录与我们操作相反的操作记录，比如我们执行了 DELETE 语句，undo log 中会记录一条 INSERT 语句，我们执行了 UPDATE 语句，undo log 也会记录一条 UPDATE 语句，只不过和我们的 UPDATE 相反的操作。当我们执行 ROLLBACK 时，就可以同过 undo log 中的记录来逆向恢复数据，以此来达到<code>数据回滚</code>的功能，确保了事务的<code>原子性</code>。</p>
<p>事务创建时也会创建 undo log，但是当事务结束时（提交或者回滚），并不会立即销毁 undo log，这些日志可能还用于 MVCC</p>
<p>undo log 存放在 回滚段 <code>（rollback segment）</code> 中，其中包含了 <code>1024</code> 个 undo log segment。</p>
<h2 id="MVCC"><a href="#MVCC" class="headerlink" title="MVCC"></a>MVCC</h2><h3 id="当前读"><a href="#当前读" class="headerlink" title="当前读"></a>当前读</h3><p><code>当前读</code>：读取的是记录的<code>最新版本</code>，且读取时要确保<code>其他事务不能修改</code>当前记录，所以会对记录进行<code>加锁</code>。如：<code>SELECT ... LOCK IN SHARE MODE</code> 、<code>SELECT ... FOR UPDATE</code>、<code>INSERT</code>、<code>UPDATE</code>、<code>DELETE</code> 等。</p>
<h3 id="快照读"><a href="#快照读" class="headerlink" title="快照读"></a>快照读</h3><p><code>快照读</code>，即简单的 SELECT 语句，读取的是记录的可见版本，有可能不是最新版而是历史数据，因此<code>不需要加锁</code>，是非阻塞读。</p>
<table>
<thead>
<tr>
<th>隔离级别</th>
<th>快照读</th>
</tr>
</thead>
<tbody><tr>
<td>Read Committed</td>
<td>每次执行 SELECT 语句，都会生成一个新的快照读</td>
</tr>
<tr>
<td>Repeatable Read</td>
<td>第一个 SELECT 语句会生成快照读，后续的重复的 SELECT 直接读取快照读数据</td>
</tr>
<tr>
<td>Serializable</td>
<td>快照读会退化为当前读，每一次执行 SELECT 都是当前读</td>
</tr>
</tbody></table>
<h3 id="MVCC-介绍"><a href="#MVCC-介绍" class="headerlink" title="MVCC 介绍"></a>MVCC 介绍</h3><p>MVCC：全称是 <code>Multi Version Concurrency Control</code>，多版本并发控制。<code>用于维护一个数据的多个版本</code>，避免对同一数据进行操作时发生冲突，快照读为 MySQL 实现 MVCC 提供了一个非阻塞读功能。MVCC 的实现，还需要依赖于数据库中记录的<code>三个隐式字段</code>、<code>undo log 日志</code>、<code>readview</code>。</p>
<h3 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h3><h4 id="三个隐藏字段"><a href="#三个隐藏字段" class="headerlink" title="三个隐藏字段"></a>三个隐藏字段</h4><table>
<thead>
<tr>
<th>字段名</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>DB_TRX_ID</td>
<td>最近修改事务 ID，用于记录最后一次修改该记录的事务 ID</td>
</tr>
<tr>
<td>DB_ROLL_PTR</td>
<td>回滚指针，指向这条记录的上一个版本，用于配合 undo log</td>
</tr>
<tr>
<td>DB_ROW_ID</td>
<td>隐藏主键，如果表结构没有主键，才会生成该隐藏字段</td>
</tr>
</tbody></table>
<p>如何查看：找到对应表的 idb 文件，执行 <code>idb2sdi xxx.idb</code> 命令。</p>
<h4 id="undo-log"><a href="#undo-log" class="headerlink" title="undo log"></a>undo log</h4><p>前边提到过，在事务结束时，并不会立即删除 undo log，因为 undo log 可能用于 MVCC。</p>
<p>执行 <code>INSERT</code> 语句而产生了 undo log，只有在回滚时才会使用，因为在事务结束时会立即删除，而 <code>UPDATE</code> 和 <code>DELETE</code> 语句产生的 undo log，不仅在回滚时使用，在快照读时也会使用，因此不会立即删除。</p>
<p><code>undo log 版本链</code>，用于记录多个事务修改同一记录时，该记录的各个版本</p>
<h4 id="readview"><a href="#readview" class="headerlink" title="readview"></a>readview</h4><p>ReadView，即<code>读视图</code>，是<code>快照读</code>在执行 SQL 时 MVCC 提取数据的依据，记录并维护系统当前活跃事务ID。</p>
<p>ReadView 中包含了四个核心字段：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>m_ids</td>
<td>活跃事务ID的集合</td>
</tr>
<tr>
<td>min_trx_id</td>
<td>最小活跃事务ID</td>
</tr>
<tr>
<td>max_trx_id</td>
<td>预分配事务ID，即当前最大事务ID + 1</td>
</tr>
<tr>
<td>creator_trx_id</td>
<td>ReadView 创建者的事务ID</td>
</tr>
</tbody></table>
<p>当快照读执行时，如何判断能够访问<code>undo log 版本链</code>中的哪个版本：</p>
<ol>
<li>trx_id &#x3D; creator_trx_id：可以访问</li>
<li>trx_id &lt; min_trx_id：可以访问</li>
<li>trx_id &gt; max_trx_id：<code>不可以访问</code></li>
<li>min_trx_id &lt;&#x3D; trx_id &lt;&#x3D; max_trx_id 且 trx_id 不存在于 m_ids：可以访问</li>
</ol>
<p>假设存在如下事务:</p>
<table>
<thead>
<tr>
<th>事务 2</th>
<th>事务 3</th>
<th>事务 4</th>
<th>事务 5</th>
</tr>
</thead>
<tbody><tr>
<td>BEGIN</td>
<td>BEGIN</td>
<td>BEGIN</td>
<td>BEGIN</td>
</tr>
<tr>
<td>UPDATE（age -&gt; 3）</td>
<td></td>
<td>SELECT</td>
<td></td>
</tr>
<tr>
<td>COMMIT</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>UPDATE（name -&gt; A3）</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>SELECT</td>
</tr>
<tr>
<td></td>
<td>COMMIT</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>UPDATE（age -&gt; 10）</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>SELECT</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>SELECT</td>
</tr>
<tr>
<td></td>
<td></td>
<td>COMMIT</td>
<td></td>
</tr>
</tbody></table>
<p>根据该事务执行顺序会生成如下的 undo log 版本链</p>
<table>
<thead>
<tr>
<th>地址</th>
<th>id</th>
<th>age</th>
<th>name</th>
<th>DB_TRX_ID</th>
<th>DB_ROLL_PTR</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td>30</td>
<td>10</td>
<td>A3</td>
<td>4</td>
<td>0x0003</td>
</tr>
<tr>
<td>0x0003</td>
<td>30</td>
<td>3</td>
<td>A3</td>
<td>3</td>
<td>0x0002</td>
</tr>
<tr>
<td>0x0002</td>
<td>30</td>
<td>3</td>
<td>A30</td>
<td>2</td>
<td>0x0001</td>
</tr>
<tr>
<td>0x0001</td>
<td>30</td>
<td>30</td>
<td>A30</td>
<td>1</td>
<td>null</td>
</tr>
</tbody></table>
<p>Read Commit 隔离级别下，每一次执行快照读都会生成一个 ReadView</p>
<ol>
<li>事务 5 第一次执行 SELECT 时会生成一个 ReadView，各字段的值为：<code>m_ids : [3, 4, 5], min_trx_id: 3, max_trx_id: 6, creator_trx_id: 5</code></li>
<li>事务 5 第二次执行 SELECT 时仍会生成一个 ReadView，个字段的值为：<code>m_ids : [4, 5], min_trx_id: 4, max_trx_id: 6, creator_trx_id: 5</code></li>
<li>根据规则，第一个 SELECT 时会查询到地址为 0x0002 的数据</li>
<li>根据规则，第一个 SELECT 时会查询到地址为 0x0003 的数据，两次查询结果不一致</li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://codedog1024.github.io">Code Dog</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://codedog1024.github.io/2025/12/09/MySQL12/">https://codedog1024.github.io/2025/12/09/MySQL12/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://codedog1024.github.io" target="_blank">代码狗的小屋</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/MySQL/">MySQL</a></div><div class="post-share"><div class="social-share" data-image="/img/04.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related full-width" href="/2025/12/08/MySQL11/" title="MySQL 锁"><img class="cover" src="/img/01.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">MySQL 锁</div></div><div class="info-2"><div class="info-item-1">锁介绍锁是数据库管理系统提供的一种机制，用于控制多个用户对数据库的访问。锁的种类很多，如表锁、行锁、索引锁等。锁的级别也很多，如共享锁、排他锁等。锁的级别会影响锁的等待时间，因此需要根据实际需求选择合适的锁级别。 分类按照锁的颗粒度：  全局锁：锁定整个数据库，对数据库的所有操作都需要等待。 表锁：锁定一个表，对表中的所有操作都需要等待。 行锁：锁定一行数据，对一行数据进行操作时，其他线程不能对同一行数据进行操作。  全局锁全局锁是数据库管理系统提供的一种锁，用于锁定整个数据库，对数据库的所有操作都需要等待。  添加全局锁：  FLUSH TABLES WITH READ LOCK;   释放全局锁：  UNLOCK TABLES;    123-- 会话 1mysql&gt; FLUSH TABLES WITH READ LOCK;Query OK, 0 rows affected (0.01 sec)  1234567891011121314151617181920212223242526272829303132333435363738-- 会话 2--...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/10/29/MySQL1/" title="MySQL 概述"><img class="cover" src="/img/09.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-29</div><div class="info-item-2">MySQL 概述</div></div><div class="info-2"><div class="info-item-1">概述数据库：数据库就是一个仓库，将数据进行有组织的存储管理。 MySQL: 是一个关系型数据库管理系统（Relational Database Management System，RDBMS），MySQL 并不是数据库。 SQL：SQL是Structured Query Language的缩写，是一种数据库查询和程序设计语言。我们需要通过编写 SQL 语句来操作数据库。 数据库分类   数据库 类型    Oracle 关系型数据库   MySQL 关系型数据库   SQL Server 关系型数据库   PostgreSQL 关系型数据库   IBM DB2 关系型数据库   SQLite 关系型数据库   MongoDB 非关系型数据库   Microsoft Azure SQL Database 关系型数据库   Hive 关系型数据库   下载安装 MySQL社区版 下载地址 启动、停止 启动命令：net start 服务名 停止命令：net stop 服务名  连接 使用 MySQL 提供的命令行工具 使用 windows 终端，执行 MySQL [-h...</div></div></div></a><a class="pagination-related" href="/2025/10/29/MySQL2/" title="MySQL SQL"><img class="cover" src="/img/07.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-29</div><div class="info-item-2">MySQL SQL</div></div><div class="info-2"><div class="info-item-1">SQL 通用语法 SQL 语句可以单行或多行编写，以分号结尾。 SQL 中应使用空格来格式化语句，提高可读性。 SQL 语句大小写不敏感，但建议使用大写。 注释： 单行注释：--、# 多行注释：/* */    SQL 分类   分类 全称 描述    DDL Data Definition Language 数据定义语言，用于定义数据库对象，如表、索引、视图、存储过程、函数等   DML Data Manipulation Language 数据操作语言，用于对数据库中的数据进行增删改   DQL Data Query Language 数据查询语言，用于查询数据库中的数据   DCL Data Control Language 数据控制语言，用于控制数据库的访问权限   DDL操作数据库   功能 SQL 语法 描述    查询 SHOW DATABASES; 查询全部数据库   查询 SELECT DATABASE(); 查询当前数据库   创建 CREATE DATABASE [IF NOT EXISTS] 数据库名 [DEFAULT CHARACTER SET...</div></div></div></a><a class="pagination-related" href="/2025/11/06/MySQL4/" title="MySQL 约束"><img class="cover" src="/img/08.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-06</div><div class="info-item-2">MySQL 约束</div></div><div class="info-2"><div class="info-item-1">约束约束：作用在表中的字段上，保证字段的数据满足要求，用于保证数据的正确型、有效性、安全性。 分类   约束 作用 关键字    主键 该值必须唯一、不重复、不能为 NULL PRIMARY KEY   外键 该值必须在指定表中存在 FOREIGN KEY   唯一 该值必须唯一、不重复 UNIQUE   非空 该值不能为空 NOT NULL   默认值 若为指定该值，则使用默认值 DEFAULT   检查 检查字段的值 CHECK   约束代码示例123456789101112CREATE TABLE users (    -- 主键，并且自增    id INT PRIMARY KEY AUTO_INCREMENT COMMENT &#x27;ID&#x27;,    -- 唯一，并且不能为空    name VARCHAR(10) NOT NULL UNIQUE COMMENT &#x27;姓名&#x27;,    -- 检查，年龄必须大于 0 且小于 120    age INT CHECK ( age &gt; 0 AND age &lt; 120) COMMENT...</div></div></div></a><a class="pagination-related" href="/2025/11/07/MySQL5/" title="MySQL 多表查询"><img class="cover" src="/img/06.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-07</div><div class="info-item-2">MySQL 多表查询</div></div><div class="info-2"><div class="info-item-1">多表关系在实际开发中，每个表之间都存在一些关系，基本上分为三种：一对一、一对多(多对一)、多对多。 一对一一对一关系，比如：学生表和档案表，对于学生来说，一个学生只能拥有一份档案，而档案只能属于一个学生，这就是一对一。 12345678910111213CREATE TABLE student (    id   INT PRIMARY KEY AUTO_INCREMENT COMMENT &#x27;ID&#x27;,    name VARCHAR(10) UNIQUE NOT NULL COMMENT &#x27;姓名&#x27;) COMMENT &#x27;学生表&#x27;;CREATE TABLE profile (    id   INT PRIMARY KEY AUTO_INCREMENT COMMENT &#x27;ID&#x27;,    phone CHAR(11) UNIQUE COMMENT &#x27;电话号&#x27;,    address VARCHAR(100) COMMENT &#x27;家庭住址&#x27;,    --...</div></div></div></a><a class="pagination-related" href="/2025/11/06/MySQL3/" title="MySQL 函数"><img class="cover" src="/img/13.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-06</div><div class="info-item-2">MySQL 函数</div></div><div class="info-2"><div class="info-item-1">函数函数是一段已经被编写好，可以直接使用的代码片段。MySQL 中内置了很多的函数，我们可以使用这些函数来完成一些简单的任务。 字符串函数常用字符串函数   函数 描述    CONCAT(str1, str2, …) 连接字符串   LOWER(str) 将字符串转换为小写   UPPER(str) 将字符串转换为大写   LPAD(str, len, pad_str) 左填充字符串   RPAD(str, len, pad_str) 右填充字符串   TRIM(str) 去掉字符串两侧的空格   SUBSTRING(str, start, len) 截取字符串   REPLACE(str, old_str, new_str) 替换字符串   LENGTH(str) 返回字符串的长度   LOCATE(substr, str) 返回子字符串在字符串中的位置   INSTR(str,...</div></div></div></a><a class="pagination-related" href="/2025/11/09/MySQL7/" title="MySQL 存储引擎"><img class="cover" src="/img/10.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-09</div><div class="info-item-2">MySQL 存储引擎</div></div><div class="info-2"><div class="info-item-1">MySQL 体系结构图 客户端连接器：Native C API、JDBC、ODBC、.NET、PHP、Python、Ruby、Cobol 等 MySQL 服务端： 连接层：连接池 服务层：SQL 接口、解析器、查询优化器、缓存 引擎层：可插拔存储引擎 存储层：数据文件、索引文件、数据结构、数据结构描述文件    存储引擎简介存储引擎是 MySQL 数据库管理系统中的核心部分，负责处理数据存储和检索。存储引擎提供了一种机制，将数据存储在数据库管理系统中，并允许用户使用各种查询语句来检索数据。存储引擎是基于表的，而不是库，所以同一个库中的不同表可以有不同的存储引擎。  查看数据库支持的存储引擎  SHOW ENGINES;   设置存储引擎  CREATE TABLE table_name (……) ENGINE&#x3D;[存储引擎名];    123456789101112131415161718192021-- 查看建表语句-- ENGINE=InnoDB 默认存储引擎为 InnoDBSHOW CREATE TABLE account;--...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Code Dog</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">40</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84"><span class="toc-number">1.</span> <span class="toc-text">逻辑存储结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%B6%E6%9E%84"><span class="toc-number">2.</span> <span class="toc-text">架构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E6%9E%B6%E6%9E%84"><span class="toc-number">2.1.</span> <span class="toc-text">内存架构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Buffer-Pool"><span class="toc-number">2.1.1.</span> <span class="toc-text">Buffer Pool</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Change-Buffer"><span class="toc-number">2.1.2.</span> <span class="toc-text">Change Buffer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Adaptive-Hash-Index"><span class="toc-number">2.1.3.</span> <span class="toc-text">Adaptive Hash Index</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Log-Buffer"><span class="toc-number">2.1.4.</span> <span class="toc-text">Log Buffer</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A3%81%E7%9B%98%E6%9E%B6%E6%9E%84"><span class="toc-number">2.2.</span> <span class="toc-text">磁盘架构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#System-Tavkesoace"><span class="toc-number">2.2.1.</span> <span class="toc-text">System Tavkesoace</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#File-Per-Table-Tablespaces"><span class="toc-number">2.2.2.</span> <span class="toc-text">File-Per-Table-Tablespaces</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#General-Tablespaces"><span class="toc-number">2.2.3.</span> <span class="toc-text">General Tablespaces</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Undo-Tablespaces"><span class="toc-number">2.2.4.</span> <span class="toc-text">Undo Tablespaces</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Temp-Tablespaces"><span class="toc-number">2.2.5.</span> <span class="toc-text">Temp Tablespaces</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Doublewrite-Buffer-Files"><span class="toc-number">2.2.6.</span> <span class="toc-text">Doublewrite Buffer Files</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Redo-Log"><span class="toc-number">2.2.7.</span> <span class="toc-text">Redo Log</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E5%8F%B0%E7%BA%BF%E7%A8%8B"><span class="toc-number">2.3.</span> <span class="toc-text">后台线程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Master-Thread"><span class="toc-number">2.3.1.</span> <span class="toc-text">Master Thread</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IO-Thread"><span class="toc-number">2.3.2.</span> <span class="toc-text">IO Thread</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Purge-Thread"><span class="toc-number">2.3.3.</span> <span class="toc-text">Purge Thread</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Page-Cleaner-Thread"><span class="toc-number">2.3.4.</span> <span class="toc-text">Page Cleaner Thread</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E5%8E%9F%E7%90%86"><span class="toc-number">3.</span> <span class="toc-text">事务原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Redo-log"><span class="toc-number">3.1.</span> <span class="toc-text">Redo log</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Undo-log"><span class="toc-number">3.2.</span> <span class="toc-text">Undo log</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MVCC"><span class="toc-number">4.</span> <span class="toc-text">MVCC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BD%93%E5%89%8D%E8%AF%BB"><span class="toc-number">4.1.</span> <span class="toc-text">当前读</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BF%AB%E7%85%A7%E8%AF%BB"><span class="toc-number">4.2.</span> <span class="toc-text">快照读</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MVCC-%E4%BB%8B%E7%BB%8D"><span class="toc-number">4.3.</span> <span class="toc-text">MVCC 介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="toc-number">4.4.</span> <span class="toc-text">实现原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E4%B8%AA%E9%9A%90%E8%97%8F%E5%AD%97%E6%AE%B5"><span class="toc-number">4.4.1.</span> <span class="toc-text">三个隐藏字段</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#undo-log"><span class="toc-number">4.4.2.</span> <span class="toc-text">undo log</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#readview"><span class="toc-number">4.4.3.</span> <span class="toc-text">readview</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/12/09/MySQL12/" title="MySQL InnoDB 引擎"><img src="/img/04.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL InnoDB 引擎"/></a><div class="content"><a class="title" href="/2025/12/09/MySQL12/" title="MySQL InnoDB 引擎">MySQL InnoDB 引擎</a><time datetime="2025-12-09T13:41:17.000Z" title="发表于 2025-12-09 21:41:17">2025-12-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/12/08/MySQL11/" title="MySQL 锁"><img src="/img/01.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL 锁"/></a><div class="content"><a class="title" href="/2025/12/08/MySQL11/" title="MySQL 锁">MySQL 锁</a><time datetime="2025-12-08T12:14:44.000Z" title="发表于 2025-12-08 20:14:44">2025-12-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/11/25/MySQL10/" title="MySQL 视图/存储过程/触发器"><img src="/img/05.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL 视图/存储过程/触发器"/></a><div class="content"><a class="title" href="/2025/11/25/MySQL10/" title="MySQL 视图/存储过程/触发器">MySQL 视图/存储过程/触发器</a><time datetime="2025-11-25T14:32:08.000Z" title="发表于 2025-11-25 22:32:08">2025-11-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/11/24/MySQL9/" title="MySQL SQL 优化"><img src="/img/03.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL SQL 优化"/></a><div class="content"><a class="title" href="/2025/11/24/MySQL9/" title="MySQL SQL 优化">MySQL SQL 优化</a><time datetime="2025-11-24T12:40:22.000Z" title="发表于 2025-11-24 20:40:22">2025-11-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/11/11/MySQL8/" title="MySQL 索引"><img src="/img/13.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL 索引"/></a><div class="content"><a class="title" href="/2025/11/11/MySQL8/" title="MySQL 索引">MySQL 索引</a><time datetime="2025-11-11T15:37:21.000Z" title="发表于 2025-11-11 23:37:21">2025-11-11</time></div></div></div></div></div></div></main><footer id="footer" style="background: ture;"><div id="footer-wrap"><div class="copyright">&copy;2025 By Code Dog</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script>(() => {
  const destroyAplayer = () => {
    if (window.aplayers) {
      for (let i = 0; i < window.aplayers.length; i++) {
        if (!window.aplayers[i].options.fixed) {
          window.aplayers[i].destroy()
        }
      }
    }
  }

  const runMetingJS = () => {
    typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()
  }

  btf.addGlobalFn('pjaxSend', destroyAplayer, 'destroyAplayer')
  btf.addGlobalFn('pjaxComplete', loadMeting, 'runMetingJS')
})()</script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>(() => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => fn())
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      const usePjax = true
      false 
        ? (usePjax ? pjax.loadUrl('/404.html') : window.location.href = '/404.html')
        : window.location.href = e.request.responseURL
    }
  })
})()</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>