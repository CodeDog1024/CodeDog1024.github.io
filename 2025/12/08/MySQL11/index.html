<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>MySQL 锁 | 代码狗的小屋</title><meta name="author" content="Code Dog"><meta name="copyright" content="Code Dog"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="锁介绍锁是数据库管理系统提供的一种机制，用于控制多个用户对数据库的访问。锁的种类很多，如表锁、行锁、索引锁等。锁的级别也很多，如共享锁、排他锁等。锁的级别会影响锁的等待时间，因此需要根据实际需求选择合适的锁级别。 分类按照锁的颗粒度：  全局锁：锁定整个数据库，对数据库的所有操作都需要等待。 表锁：锁定一个表，对表中的所有操作都需要等待。 行锁：锁定一行数据，对一行数据进行操作时，其他线程不能对同">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL 锁">
<meta property="og:url" content="https://codedog1024.github.io/2025/12/08/MySQL11/index.html">
<meta property="og:site_name" content="代码狗的小屋">
<meta property="og:description" content="锁介绍锁是数据库管理系统提供的一种机制，用于控制多个用户对数据库的访问。锁的种类很多，如表锁、行锁、索引锁等。锁的级别也很多，如共享锁、排他锁等。锁的级别会影响锁的等待时间，因此需要根据实际需求选择合适的锁级别。 分类按照锁的颗粒度：  全局锁：锁定整个数据库，对数据库的所有操作都需要等待。 表锁：锁定一个表，对表中的所有操作都需要等待。 行锁：锁定一行数据，对一行数据进行操作时，其他线程不能对同">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://codedog1024.github.io/img/01.jpg">
<meta property="article:published_time" content="2025-12-08T12:14:44.000Z">
<meta property="article:modified_time" content="2025-12-09T13:40:00.268Z">
<meta property="article:author" content="Code Dog">
<meta property="article:tag" content="MySQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://codedog1024.github.io/img/01.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "MySQL 锁",
  "url": "https://codedog1024.github.io/2025/12/08/MySQL11/",
  "image": "https://codedog1024.github.io/img/01.jpg",
  "datePublished": "2025-12-08T12:14:44.000Z",
  "dateModified": "2025-12-09T13:40:00.268Z",
  "author": [
    {
      "@type": "Person",
      "name": "Code Dog",
      "url": "https://codedog1024.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://codedog1024.github.io/2025/12/08/MySQL11/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const hour = new Date().getHours()
          const isNight = hour <= 6 || hour >= 1
          if (theme === undefined) isNight ? activateDarkMode() : activateLightMode()
          else theme === 'light' ? activateLightMode() : activateDarkMode()
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'MySQL 锁',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">40</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/01.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">代码狗的小屋</span></a><a class="nav-page-title" href="/"><span class="site-name">MySQL 锁</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">MySQL 锁</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-12-08T12:14:44.000Z" title="发表于 2025-12-08 20:14:44">2025-12-08</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-12-09T13:40:00.268Z" title="更新于 2025-12-09 21:40:00">2025-12-09</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h2 id="锁"><a href="#锁" class="headerlink" title="锁"></a>锁</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>锁是数据库管理系统提供的一种机制，用于控制多个用户对数据库的访问。锁的种类很多，如<code>表锁</code>、<code>行锁</code>、<code>索引锁</code>等。锁的级别也很多，如共享锁、排他锁等。锁的级别会影响锁的等待时间，因此需要根据实际需求选择合适的锁级别。</p>
<h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><p>按照锁的颗粒度：</p>
<ol>
<li>全局锁：锁定整个数据库，对数据库的所有操作都需要等待。</li>
<li>表锁：锁定一个表，对表中的所有操作都需要等待。</li>
<li>行锁：锁定一行数据，对一行数据进行操作时，其他线程不能对同一行数据进行操作。</li>
</ol>
<h3 id="全局锁"><a href="#全局锁" class="headerlink" title="全局锁"></a>全局锁</h3><p>全局锁是数据库管理系统提供的一种锁，用于锁定整个数据库，对数据库的所有操作都需要等待。</p>
<ol>
<li><p>添加全局锁：</p>
<blockquote>
<p>FLUSH TABLES WITH READ LOCK;</p>
</blockquote>
</li>
<li><p>释放全局锁：</p>
<blockquote>
<p>UNLOCK TABLES;</p>
</blockquote>
</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 会话 1</span></span><br><span class="line">mysql<span class="operator">&gt;</span> FLUSH TABLES <span class="keyword">WITH</span> READ LOCK;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 会话 2</span></span><br><span class="line"><span class="comment">-- 在全局锁的状态下可以执行 DQL 操作</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_user;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------------+------------------------+-----------------------------+------+--------+--------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name      <span class="operator">|</span> phone       <span class="operator">|</span> email                  <span class="operator">|</span> profession                  <span class="operator">|</span> age  <span class="operator">|</span> gender <span class="operator">|</span> status <span class="operator">|</span> create_time         <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------------+------------------------+-----------------------------+------+--------+--------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> 吕布      <span class="operator">|</span> <span class="number">17799990000</span> <span class="operator">|</span> lvbu666<span class="variable">@163</span>.com        <span class="operator">|</span> 化工                        <span class="operator">|</span>   <span class="number">23</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">6</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-02</span><span class="number">-02</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> 曹操      <span class="operator">|</span> <span class="number">17799990001</span> <span class="operator">|</span> caocao666<span class="variable">@qq</span>.com       <span class="operator">|</span> 化工                        <span class="operator">|</span>   <span class="number">33</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-03</span><span class="number">-05</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> 赵云      <span class="operator">|</span> <span class="number">17799990002</span> <span class="operator">|</span> <span class="number">17799990</span><span class="variable">@139</span>.com       <span class="operator">|</span> 英语                        <span class="operator">|</span>   <span class="number">34</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">2002</span><span class="number">-03</span><span class="number">-02</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> 孙悟空    <span class="operator">|</span> <span class="number">17799990003</span> <span class="operator">|</span> <span class="number">17799990</span><span class="variable">@sina</span>.com      <span class="operator">|</span> 工程造价                    <span class="operator">|</span>   <span class="number">54</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-07</span><span class="number">-02</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> 花木兰    <span class="operator">|</span> <span class="number">17799990004</span> <span class="operator">|</span> <span class="number">19980729</span><span class="variable">@sina</span>.com      <span class="operator">|</span> 软件工程                    <span class="operator">|</span>   <span class="number">23</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-04</span><span class="number">-22</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">6</span> <span class="operator">|</span> 大桥      <span class="operator">|</span> <span class="number">17799990005</span> <span class="operator">|</span> daqiao666<span class="variable">@sina</span>.com     <span class="operator">|</span> 舞蹈                        <span class="operator">|</span>   <span class="number">22</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-02</span><span class="number">-07</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">7</span> <span class="operator">|</span> 露娜      <span class="operator">|</span> <span class="number">17799990006</span> <span class="operator">|</span> luna_love<span class="variable">@sina</span>.com     <span class="operator">|</span> 应用数学                    <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-02</span><span class="number">-08</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">8</span> <span class="operator">|</span> 程咬金    <span class="operator">|</span> <span class="number">17799990007</span> <span class="operator">|</span> chengyaojin<span class="variable">@163</span>.com    <span class="operator">|</span> 化工                        <span class="operator">|</span>   <span class="number">38</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">5</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-05</span><span class="number">-23</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">9</span> <span class="operator">|</span> 项羽      <span class="operator">|</span> <span class="number">17799990008</span> <span class="operator">|</span> xiaoyu666<span class="variable">@qq</span>.com       <span class="operator">|</span> 金属材料                    <span class="operator">|</span>   <span class="number">43</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-09</span><span class="number">-18</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">10</span> <span class="operator">|</span> 白起      <span class="operator">|</span> <span class="number">17799990009</span> <span class="operator">|</span> baiqi666<span class="variable">@sina</span>.com      <span class="operator">|</span> 机械工程及其自动化          <span class="operator">|</span>   <span class="number">27</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-08</span><span class="number">-16</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">11</span> <span class="operator">|</span> 韩信      <span class="operator">|</span> <span class="number">17799990010</span> <span class="operator">|</span> hanxin520<span class="variable">@163</span>.com      <span class="operator">|</span> 无机非金属材料工程          <span class="operator">|</span>   <span class="number">27</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-06</span><span class="number">-12</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">12</span> <span class="operator">|</span> 荆轲      <span class="operator">|</span> <span class="number">17799990011</span> <span class="operator">|</span> jingke123<span class="variable">@163</span>.com      <span class="operator">|</span> 会计                        <span class="operator">|</span>   <span class="number">29</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-05</span><span class="number">-11</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">13</span> <span class="operator">|</span> 兰陵王    <span class="operator">|</span> <span class="number">17799990012</span> <span class="operator">|</span> lanlingwang666<span class="variable">@126</span>.com <span class="operator">|</span> 工程造价                    <span class="operator">|</span>   <span class="number">44</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-04</span><span class="number">-09</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">14</span> <span class="operator">|</span> 狂铁      <span class="operator">|</span> <span class="number">17799990013</span> <span class="operator">|</span> kuangtie<span class="variable">@sina</span>.com      <span class="operator">|</span> 应用数学                    <span class="operator">|</span>   <span class="number">43</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-04</span><span class="number">-10</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">15</span> <span class="operator">|</span> 貂蝉      <span class="operator">|</span> <span class="number">17799990014</span> <span class="operator">|</span> <span class="number">84958948374</span><span class="variable">@qq</span>.com     <span class="operator">|</span> 软件工程                    <span class="operator">|</span>   <span class="number">40</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">3</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-02</span><span class="number">-12</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">16</span> <span class="operator">|</span> 妲己      <span class="operator">|</span> <span class="number">17799990015</span> <span class="operator">|</span> <span class="number">2783238293</span><span class="variable">@qq</span>.com      <span class="operator">|</span> 软件工程                    <span class="operator">|</span>   <span class="number">31</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-01</span><span class="number">-30</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">17</span> <span class="operator">|</span> 芈月      <span class="operator">|</span> <span class="number">17799990016</span> <span class="operator">|</span> xiaomi2001.com         <span class="operator">|</span> 工业经济                    <span class="operator">|</span>   <span class="number">35</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2000</span><span class="number">-05</span><span class="number">-03</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">18</span> <span class="operator">|</span> 嬴政      <span class="operator">|</span> <span class="number">17799990017</span> <span class="operator">|</span> <span class="number">8839434342</span><span class="variable">@qq</span>.com      <span class="operator">|</span> 化工                        <span class="operator">|</span>   <span class="number">38</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-08</span><span class="number">-08</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">19</span> <span class="operator">|</span> 狄仁杰    <span class="operator">|</span> <span class="number">17799990018</span> <span class="operator">|</span> jujiamlm8166u<span class="variable">@163</span>.com  <span class="operator">|</span> 国际贸易                    <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2007</span><span class="number">-03</span><span class="number">-12</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">20</span> <span class="operator">|</span> 安琪拉    <span class="operator">|</span> <span class="number">17799990019</span> <span class="operator">|</span> jdodm1h<span class="variable">@126</span>.com        <span class="operator">|</span> 城市规划                    <span class="operator">|</span>   <span class="number">51</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-08</span><span class="number">-15</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">21</span> <span class="operator">|</span> 典韦      <span class="operator">|</span> <span class="number">17799990020</span> <span class="operator">|</span> ycaunanjian<span class="variable">@163</span>.com    <span class="operator">|</span> 城市规划                    <span class="operator">|</span>   <span class="number">52</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">2000</span><span class="number">-04</span><span class="number">-12</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">22</span> <span class="operator">|</span> 廉颇      <span class="operator">|</span> <span class="number">17799990021</span> <span class="operator">|</span> lianpo321<span class="variable">@126</span>.com      <span class="operator">|</span> 土木工程                    <span class="operator">|</span>   <span class="number">19</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">3</span>      <span class="operator">|</span> <span class="number">2002</span><span class="number">-07</span><span class="number">-18</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">23</span> <span class="operator">|</span> 后裔      <span class="operator">|</span> <span class="number">17799990022</span> <span class="operator">|</span> altycj2000<span class="variable">@139</span>.com     <span class="operator">|</span> 城市园林                    <span class="operator">|</span>   <span class="number">20</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2002</span><span class="number">-03</span><span class="number">-10</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">24</span> <span class="operator">|</span> 姜子牙    <span class="operator">|</span> <span class="number">17799990023</span> <span class="operator">|</span> <span class="number">37483844</span><span class="variable">@qq</span>.com        <span class="operator">|</span> 工程造价                    <span class="operator">|</span>   <span class="number">29</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">4</span>      <span class="operator">|</span> <span class="number">2003</span><span class="number">-05</span><span class="number">-26</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">25</span> <span class="operator">|</span> 诸葛亮    <span class="operator">|</span> <span class="number">17799990024</span> <span class="operator">|</span> zhuge666<span class="variable">@sina</span>.com      <span class="operator">|</span> 软件工程                    <span class="operator">|</span>   <span class="number">22</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2025</span><span class="number">-11</span><span class="number">-26</span> <span class="number">19</span>:<span class="number">32</span>:<span class="number">30</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------------+------------------------+-----------------------------+------+--------+--------+---------------------+</span></span><br><span class="line"><span class="number">25</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 执行 DML 操作会被阻塞</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">UPDATE</span> tb_user <span class="keyword">SET</span> profession <span class="operator">=</span> <span class="string">&#x27;会计&#x27;</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">25</span>;</span><br><span class="line"><span class="operator">^</span>C<span class="operator">^</span>C <span class="comment">-- query aborted</span></span><br><span class="line">ERROR <span class="number">1317</span> (<span class="number">70100</span>): Query execution was interrupted</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 会话 3</span></span><br><span class="line"><span class="comment">-- 备份全库</span></span><br><span class="line">root<span class="variable">@iZ2zeckoeb761cyuvcssaqZ</span>:<span class="operator">~</span># mysqldump <span class="operator">-</span>uroot <span class="operator">-</span>pXXXXXX mysql_study <span class="operator">&gt;</span> tb_user.sql;</span><br><span class="line">mysqldump: [Warning] <span class="keyword">Using</span> a password <span class="keyword">on</span> the command line interface can be insecure.</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用 --single-transaction 参数，可以在不加锁的情况下来确保数据一致性</span></span><br><span class="line">root<span class="variable">@iZ2zeckoeb761cyuvcssaqZ</span>:<span class="operator">~</span># mysqldump <span class="comment">--single-transaction -uroot -pXXXXXX mysql_study &gt; tb_user.sql;</span></span><br><span class="line">mysqldump: [Warning] <span class="keyword">Using</span> a password <span class="keyword">on</span> the command line interface can be insecure.</span><br></pre></td></tr></table></figure>

<h3 id="表级锁"><a href="#表级锁" class="headerlink" title="表级锁"></a>表级锁</h3><p>表级锁，加锁的颗粒度是表级。应用于 MyISAM、Innodb、BDB 等存储引擎中。</p>
<p>在表级锁的基础上又分为以下三类：</p>
<ol>
<li>表锁</li>
<li>元数据锁</li>
<li>意向锁</li>
</ol>
<h4 id="表锁"><a href="#表锁" class="headerlink" title="表锁"></a>表锁</h4><p>对于表锁，又分为两类</p>
<ol>
<li>表共享读锁（read lock）：所有会话均可读，但不可写</li>
<li>表独占写锁（write lock）：当前会话可读写，其他会话不可读不可写</li>
</ol>
<p>表锁的使用</p>
<ol>
<li><p>加锁</p>
<blockquote>
<p>LOCK TABLES 表名 [READ | WRITE];</p>
</blockquote>
</li>
<li><p>解锁</p>
<blockquote>
<p>UNLOCK TABLES;</p>
</blockquote>
</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 读锁</span></span><br><span class="line"><span class="comment">-- 添加锁</span></span><br><span class="line">mysql<span class="operator">&gt;</span> LOCK TABLES tb_user READ;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 读锁状态下，可以执行 DQL 操作</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_user;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------------+------------------------+-----------------------------+------+--------+--------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name      <span class="operator">|</span> phone       <span class="operator">|</span> email                  <span class="operator">|</span> profession                  <span class="operator">|</span> age  <span class="operator">|</span> gender <span class="operator">|</span> status <span class="operator">|</span> create_time         <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------------+------------------------+-----------------------------+------+--------+--------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> 吕布      <span class="operator">|</span> <span class="number">17799990000</span> <span class="operator">|</span> lvbu666<span class="variable">@163</span>.com        <span class="operator">|</span> 化工                        <span class="operator">|</span>   <span class="number">23</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">6</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-02</span><span class="number">-02</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> 曹操      <span class="operator">|</span> <span class="number">17799990001</span> <span class="operator">|</span> caocao666<span class="variable">@qq</span>.com       <span class="operator">|</span> 化工                        <span class="operator">|</span>   <span class="number">33</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-03</span><span class="number">-05</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> 赵云      <span class="operator">|</span> <span class="number">17799990002</span> <span class="operator">|</span> <span class="number">17799990</span><span class="variable">@139</span>.com       <span class="operator">|</span> 英语                        <span class="operator">|</span>   <span class="number">34</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">2002</span><span class="number">-03</span><span class="number">-02</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> 孙悟空    <span class="operator">|</span> <span class="number">17799990003</span> <span class="operator">|</span> <span class="number">17799990</span><span class="variable">@sina</span>.com      <span class="operator">|</span> 工程造价                    <span class="operator">|</span>   <span class="number">54</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-07</span><span class="number">-02</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> 花木兰    <span class="operator">|</span> <span class="number">17799990004</span> <span class="operator">|</span> <span class="number">19980729</span><span class="variable">@sina</span>.com      <span class="operator">|</span> 软件工程                    <span class="operator">|</span>   <span class="number">23</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-04</span><span class="number">-22</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">6</span> <span class="operator">|</span> 大桥      <span class="operator">|</span> <span class="number">17799990005</span> <span class="operator">|</span> daqiao666<span class="variable">@sina</span>.com     <span class="operator">|</span> 舞蹈                        <span class="operator">|</span>   <span class="number">22</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-02</span><span class="number">-07</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">7</span> <span class="operator">|</span> 露娜      <span class="operator">|</span> <span class="number">17799990006</span> <span class="operator">|</span> luna_love<span class="variable">@sina</span>.com     <span class="operator">|</span> 应用数学                    <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-02</span><span class="number">-08</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">8</span> <span class="operator">|</span> 程咬金    <span class="operator">|</span> <span class="number">17799990007</span> <span class="operator">|</span> chengyaojin<span class="variable">@163</span>.com    <span class="operator">|</span> 化工                        <span class="operator">|</span>   <span class="number">38</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">5</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-05</span><span class="number">-23</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">9</span> <span class="operator">|</span> 项羽      <span class="operator">|</span> <span class="number">17799990008</span> <span class="operator">|</span> xiaoyu666<span class="variable">@qq</span>.com       <span class="operator">|</span> 金属材料                    <span class="operator">|</span>   <span class="number">43</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-09</span><span class="number">-18</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">10</span> <span class="operator">|</span> 白起      <span class="operator">|</span> <span class="number">17799990009</span> <span class="operator">|</span> baiqi666<span class="variable">@sina</span>.com      <span class="operator">|</span> 机械工程及其自动化          <span class="operator">|</span>   <span class="number">27</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-08</span><span class="number">-16</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">11</span> <span class="operator">|</span> 韩信      <span class="operator">|</span> <span class="number">17799990010</span> <span class="operator">|</span> hanxin520<span class="variable">@163</span>.com      <span class="operator">|</span> 无机非金属材料工程          <span class="operator">|</span>   <span class="number">27</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-06</span><span class="number">-12</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">12</span> <span class="operator">|</span> 荆轲      <span class="operator">|</span> <span class="number">17799990011</span> <span class="operator">|</span> jingke123<span class="variable">@163</span>.com      <span class="operator">|</span> 会计                        <span class="operator">|</span>   <span class="number">29</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-05</span><span class="number">-11</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">13</span> <span class="operator">|</span> 兰陵王    <span class="operator">|</span> <span class="number">17799990012</span> <span class="operator">|</span> lanlingwang666<span class="variable">@126</span>.com <span class="operator">|</span> 工程造价                    <span class="operator">|</span>   <span class="number">44</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-04</span><span class="number">-09</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">14</span> <span class="operator">|</span> 狂铁      <span class="operator">|</span> <span class="number">17799990013</span> <span class="operator">|</span> kuangtie<span class="variable">@sina</span>.com      <span class="operator">|</span> 应用数学                    <span class="operator">|</span>   <span class="number">43</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-04</span><span class="number">-10</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">15</span> <span class="operator">|</span> 貂蝉      <span class="operator">|</span> <span class="number">17799990014</span> <span class="operator">|</span> <span class="number">84958948374</span><span class="variable">@qq</span>.com     <span class="operator">|</span> 软件工程                    <span class="operator">|</span>   <span class="number">40</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">3</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-02</span><span class="number">-12</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">16</span> <span class="operator">|</span> 妲己      <span class="operator">|</span> <span class="number">17799990015</span> <span class="operator">|</span> <span class="number">2783238293</span><span class="variable">@qq</span>.com      <span class="operator">|</span> 软件工程                    <span class="operator">|</span>   <span class="number">31</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-01</span><span class="number">-30</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">17</span> <span class="operator">|</span> 芈月      <span class="operator">|</span> <span class="number">17799990016</span> <span class="operator">|</span> xiaomi2001.com         <span class="operator">|</span> 工业经济                    <span class="operator">|</span>   <span class="number">35</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2000</span><span class="number">-05</span><span class="number">-03</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">18</span> <span class="operator">|</span> 嬴政      <span class="operator">|</span> <span class="number">17799990017</span> <span class="operator">|</span> <span class="number">8839434342</span><span class="variable">@qq</span>.com      <span class="operator">|</span> 化工                        <span class="operator">|</span>   <span class="number">38</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-08</span><span class="number">-08</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">19</span> <span class="operator">|</span> 狄仁杰    <span class="operator">|</span> <span class="number">17799990018</span> <span class="operator">|</span> jujiamlm8166u<span class="variable">@163</span>.com  <span class="operator">|</span> 国际贸易                    <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2007</span><span class="number">-03</span><span class="number">-12</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">20</span> <span class="operator">|</span> 安琪拉    <span class="operator">|</span> <span class="number">17799990019</span> <span class="operator">|</span> jdodm1h<span class="variable">@126</span>.com        <span class="operator">|</span> 城市规划                    <span class="operator">|</span>   <span class="number">51</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-08</span><span class="number">-15</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">21</span> <span class="operator">|</span> 典韦      <span class="operator">|</span> <span class="number">17799990020</span> <span class="operator">|</span> ycaunanjian<span class="variable">@163</span>.com    <span class="operator">|</span> 城市规划                    <span class="operator">|</span>   <span class="number">52</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">2000</span><span class="number">-04</span><span class="number">-12</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">22</span> <span class="operator">|</span> 廉颇      <span class="operator">|</span> <span class="number">17799990021</span> <span class="operator">|</span> lianpo321<span class="variable">@126</span>.com      <span class="operator">|</span> 土木工程                    <span class="operator">|</span>   <span class="number">19</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">3</span>      <span class="operator">|</span> <span class="number">2002</span><span class="number">-07</span><span class="number">-18</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">23</span> <span class="operator">|</span> 后裔      <span class="operator">|</span> <span class="number">17799990022</span> <span class="operator">|</span> altycj2000<span class="variable">@139</span>.com     <span class="operator">|</span> 城市园林                    <span class="operator">|</span>   <span class="number">20</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2002</span><span class="number">-03</span><span class="number">-10</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">24</span> <span class="operator">|</span> 姜子牙    <span class="operator">|</span> <span class="number">17799990023</span> <span class="operator">|</span> <span class="number">37483844</span><span class="variable">@qq</span>.com        <span class="operator">|</span> 工程造价                    <span class="operator">|</span>   <span class="number">29</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">4</span>      <span class="operator">|</span> <span class="number">2003</span><span class="number">-05</span><span class="number">-26</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">25</span> <span class="operator">|</span> 诸葛亮    <span class="operator">|</span> <span class="number">17799990024</span> <span class="operator">|</span> zhuge666<span class="variable">@sina</span>.com      <span class="operator">|</span> 会计                        <span class="operator">|</span>   <span class="number">22</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2025</span><span class="number">-11</span><span class="number">-26</span> <span class="number">19</span>:<span class="number">32</span>:<span class="number">30</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------------+------------------------+-----------------------------+------+--------+--------+---------------------+</span></span><br><span class="line"><span class="number">25</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 在读锁状态下，当前会话下无法执行 DML 操作，其他会话下可以执行 DML 操作，但会阻塞，需要等待读锁释放</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">UPDATE</span> tb_user <span class="keyword">SET</span> profession <span class="operator">=</span> <span class="string">&#x27;会计&#x27;</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">25</span>;</span><br><span class="line">ERROR <span class="number">1099</span> (HY000): <span class="keyword">Table</span> <span class="string">&#x27;tb_user&#x27;</span> was locked <span class="keyword">with</span> a READ lock <span class="keyword">and</span> can<span class="string">&#x27;t be updated</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 写锁</span></span><br><span class="line"><span class="comment">-- 对于写锁来说，当前会话内可以执行 DQL 和 DML 操作，而其他会话下无法执行任何读写操作</span></span><br><span class="line">mysql<span class="operator">&gt;</span> LOCK TABLES tb_user WRITE;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_user;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------------+------------------------+-----------------------------+------+--------+--------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name      <span class="operator">|</span> phone       <span class="operator">|</span> email                  <span class="operator">|</span> profession                  <span class="operator">|</span> age  <span class="operator">|</span> gender <span class="operator">|</span> status <span class="operator">|</span> create_time         <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------------+------------------------+-----------------------------+------+--------+--------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> 吕布      <span class="operator">|</span> <span class="number">17799990000</span> <span class="operator">|</span> lvbu666<span class="variable">@163</span>.com        <span class="operator">|</span> 化工                        <span class="operator">|</span>   <span class="number">23</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">6</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-02</span><span class="number">-02</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> 曹操      <span class="operator">|</span> <span class="number">17799990001</span> <span class="operator">|</span> caocao666<span class="variable">@qq</span>.com       <span class="operator">|</span> 化工                        <span class="operator">|</span>   <span class="number">33</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-03</span><span class="number">-05</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> 赵云      <span class="operator">|</span> <span class="number">17799990002</span> <span class="operator">|</span> <span class="number">17799990</span><span class="variable">@139</span>.com       <span class="operator">|</span> 英语                        <span class="operator">|</span>   <span class="number">34</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">2002</span><span class="number">-03</span><span class="number">-02</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> 孙悟空    <span class="operator">|</span> <span class="number">17799990003</span> <span class="operator">|</span> <span class="number">17799990</span><span class="variable">@sina</span>.com      <span class="operator">|</span> 工程造价                    <span class="operator">|</span>   <span class="number">54</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-07</span><span class="number">-02</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> 花木兰    <span class="operator">|</span> <span class="number">17799990004</span> <span class="operator">|</span> <span class="number">19980729</span><span class="variable">@sina</span>.com      <span class="operator">|</span> 软件工程                    <span class="operator">|</span>   <span class="number">23</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-04</span><span class="number">-22</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">6</span> <span class="operator">|</span> 大桥      <span class="operator">|</span> <span class="number">17799990005</span> <span class="operator">|</span> daqiao666<span class="variable">@sina</span>.com     <span class="operator">|</span> 舞蹈                        <span class="operator">|</span>   <span class="number">22</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-02</span><span class="number">-07</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">7</span> <span class="operator">|</span> 露娜      <span class="operator">|</span> <span class="number">17799990006</span> <span class="operator">|</span> luna_love<span class="variable">@sina</span>.com     <span class="operator">|</span> 应用数学                    <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-02</span><span class="number">-08</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">8</span> <span class="operator">|</span> 程咬金    <span class="operator">|</span> <span class="number">17799990007</span> <span class="operator">|</span> chengyaojin<span class="variable">@163</span>.com    <span class="operator">|</span> 化工                        <span class="operator">|</span>   <span class="number">38</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">5</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-05</span><span class="number">-23</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">9</span> <span class="operator">|</span> 项羽      <span class="operator">|</span> <span class="number">17799990008</span> <span class="operator">|</span> xiaoyu666<span class="variable">@qq</span>.com       <span class="operator">|</span> 金属材料                    <span class="operator">|</span>   <span class="number">43</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-09</span><span class="number">-18</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">10</span> <span class="operator">|</span> 白起      <span class="operator">|</span> <span class="number">17799990009</span> <span class="operator">|</span> baiqi666<span class="variable">@sina</span>.com      <span class="operator">|</span> 机械工程及其自动化          <span class="operator">|</span>   <span class="number">27</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-08</span><span class="number">-16</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">11</span> <span class="operator">|</span> 韩信      <span class="operator">|</span> <span class="number">17799990010</span> <span class="operator">|</span> hanxin520<span class="variable">@163</span>.com      <span class="operator">|</span> 无机非金属材料工程          <span class="operator">|</span>   <span class="number">27</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-06</span><span class="number">-12</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">12</span> <span class="operator">|</span> 荆轲      <span class="operator">|</span> <span class="number">17799990011</span> <span class="operator">|</span> jingke123<span class="variable">@163</span>.com      <span class="operator">|</span> 会计                        <span class="operator">|</span>   <span class="number">29</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-05</span><span class="number">-11</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">13</span> <span class="operator">|</span> 兰陵王    <span class="operator">|</span> <span class="number">17799990012</span> <span class="operator">|</span> lanlingwang666<span class="variable">@126</span>.com <span class="operator">|</span> 工程造价                    <span class="operator">|</span>   <span class="number">44</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-04</span><span class="number">-09</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">14</span> <span class="operator">|</span> 狂铁      <span class="operator">|</span> <span class="number">17799990013</span> <span class="operator">|</span> kuangtie<span class="variable">@sina</span>.com      <span class="operator">|</span> 应用数学                    <span class="operator">|</span>   <span class="number">43</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-04</span><span class="number">-10</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">15</span> <span class="operator">|</span> 貂蝉      <span class="operator">|</span> <span class="number">17799990014</span> <span class="operator">|</span> <span class="number">84958948374</span><span class="variable">@qq</span>.com     <span class="operator">|</span> 软件工程                    <span class="operator">|</span>   <span class="number">40</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">3</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-02</span><span class="number">-12</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">16</span> <span class="operator">|</span> 妲己      <span class="operator">|</span> <span class="number">17799990015</span> <span class="operator">|</span> <span class="number">2783238293</span><span class="variable">@qq</span>.com      <span class="operator">|</span> 软件工程                    <span class="operator">|</span>   <span class="number">31</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-01</span><span class="number">-30</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">17</span> <span class="operator">|</span> 芈月      <span class="operator">|</span> <span class="number">17799990016</span> <span class="operator">|</span> xiaomi2001.com         <span class="operator">|</span> 工业经济                    <span class="operator">|</span>   <span class="number">35</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2000</span><span class="number">-05</span><span class="number">-03</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">18</span> <span class="operator">|</span> 嬴政      <span class="operator">|</span> <span class="number">17799990017</span> <span class="operator">|</span> <span class="number">8839434342</span><span class="variable">@qq</span>.com      <span class="operator">|</span> 化工                        <span class="operator">|</span>   <span class="number">38</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-08</span><span class="number">-08</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">19</span> <span class="operator">|</span> 狄仁杰    <span class="operator">|</span> <span class="number">17799990018</span> <span class="operator">|</span> jujiamlm8166u<span class="variable">@163</span>.com  <span class="operator">|</span> 国际贸易                    <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2007</span><span class="number">-03</span><span class="number">-12</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">20</span> <span class="operator">|</span> 安琪拉    <span class="operator">|</span> <span class="number">17799990019</span> <span class="operator">|</span> jdodm1h<span class="variable">@126</span>.com        <span class="operator">|</span> 城市规划                    <span class="operator">|</span>   <span class="number">51</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-08</span><span class="number">-15</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">21</span> <span class="operator">|</span> 典韦      <span class="operator">|</span> <span class="number">17799990020</span> <span class="operator">|</span> ycaunanjian<span class="variable">@163</span>.com    <span class="operator">|</span> 城市规划                    <span class="operator">|</span>   <span class="number">52</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">2000</span><span class="number">-04</span><span class="number">-12</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">22</span> <span class="operator">|</span> 廉颇      <span class="operator">|</span> <span class="number">17799990021</span> <span class="operator">|</span> lianpo321<span class="variable">@126</span>.com      <span class="operator">|</span> 土木工程                    <span class="operator">|</span>   <span class="number">19</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">3</span>      <span class="operator">|</span> <span class="number">2002</span><span class="number">-07</span><span class="number">-18</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">23</span> <span class="operator">|</span> 后裔      <span class="operator">|</span> <span class="number">17799990022</span> <span class="operator">|</span> altycj2000<span class="variable">@139</span>.com     <span class="operator">|</span> 城市园林                    <span class="operator">|</span>   <span class="number">20</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2002</span><span class="number">-03</span><span class="number">-10</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">24</span> <span class="operator">|</span> 姜子牙    <span class="operator">|</span> <span class="number">17799990023</span> <span class="operator">|</span> <span class="number">37483844</span><span class="variable">@qq</span>.com        <span class="operator">|</span> 工程造价                    <span class="operator">|</span>   <span class="number">29</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">4</span>      <span class="operator">|</span> <span class="number">2003</span><span class="number">-05</span><span class="number">-26</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">25</span> <span class="operator">|</span> 诸葛亮    <span class="operator">|</span> <span class="number">17799990024</span> <span class="operator">|</span> zhuge666<span class="variable">@sina</span>.com      <span class="operator">|</span> 会计                        <span class="operator">|</span>   <span class="number">22</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2025</span><span class="number">-11</span><span class="number">-26</span> <span class="number">19</span>:<span class="number">32</span>:<span class="number">30</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------------+------------------------+-----------------------------+------+--------+--------+---------------------+</span></span><br><span class="line"><span class="number">25</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">UPDATE</span> tb_user <span class="keyword">SET</span> profession <span class="operator">=</span> <span class="string">&#x27;会计&#x27;</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">25</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"><span class="keyword">Rows</span> matched: <span class="number">1</span>  Changed: <span class="number">0</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> UNLOCK TABLES;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h4 id="元数据锁"><a href="#元数据锁" class="headerlink" title="元数据锁"></a>元数据锁</h4><p>元数据锁（Meta Data Lock, MDL）：是系统自动控制的锁，无需显示的通过命令来加锁。当我们访问一张表时，系统会自动给这张表加一个元数据锁。当该表上存在事务时，不允许对元数据进行修改。</p>
<p>当对一张表进行增删改查的时候，会自动对该表添加 MDL 读锁，当对表结构进行修改的时候，会自动对该表添加 MDL 写锁。</p>
<table>
<thead>
<tr>
<th>SQL</th>
<th>锁类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>LOCK TABLES XXX READ &#x2F; WRITE</td>
<td>SHARED_READ_ONLY &#x2F; SHARED_NO_READ_WRITE</td>
<td></td>
</tr>
<tr>
<td>SELECT、SELECT … LOCK IN SHARE MODE</td>
<td>SHARED_READ</td>
<td>与 SHARED_READ 、SHARED_WRITE 兼容、与 EXCLUSIVE 互斥</td>
</tr>
<tr>
<td>INSERT、UPDATE、DELETE、SELECT … FOR UPDATE</td>
<td>SHARED_WRITE</td>
<td>与 SHARED_READ 、SHARED_WRITE 兼容、与 EXCLUSIVE 互斥</td>
</tr>
<tr>
<td>ALTER TABLE</td>
<td>EXCLUSIVE</td>
<td>与 SHARED_READ 、SHARED_WRITE 互斥</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 会话 1 中开启事务</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">BEGIN</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_user;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------------+------------------------+-----------------------------+------+--------+--------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name      <span class="operator">|</span> phone       <span class="operator">|</span> email                  <span class="operator">|</span> profession                  <span class="operator">|</span> age  <span class="operator">|</span> gender <span class="operator">|</span> status <span class="operator">|</span> create_time         <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------------+------------------------+-----------------------------+------+--------+--------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> 吕布      <span class="operator">|</span> <span class="number">17799990000</span> <span class="operator">|</span> lvbu666<span class="variable">@163</span>.com        <span class="operator">|</span> 化工                        <span class="operator">|</span>   <span class="number">23</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">6</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-02</span><span class="number">-02</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> 曹操      <span class="operator">|</span> <span class="number">17799990001</span> <span class="operator">|</span> caocao666<span class="variable">@qq</span>.com       <span class="operator">|</span> 化工                        <span class="operator">|</span>   <span class="number">33</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-03</span><span class="number">-05</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> 赵云      <span class="operator">|</span> <span class="number">17799990002</span> <span class="operator">|</span> <span class="number">17799990</span><span class="variable">@139</span>.com       <span class="operator">|</span> 英语                        <span class="operator">|</span>   <span class="number">34</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">2002</span><span class="number">-03</span><span class="number">-02</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> 孙悟空    <span class="operator">|</span> <span class="number">17799990003</span> <span class="operator">|</span> <span class="number">17799990</span><span class="variable">@sina</span>.com      <span class="operator">|</span> 工程造价                    <span class="operator">|</span>   <span class="number">54</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-07</span><span class="number">-02</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> 花木兰    <span class="operator">|</span> <span class="number">17799990004</span> <span class="operator">|</span> <span class="number">19980729</span><span class="variable">@sina</span>.com      <span class="operator">|</span> 软件工程                    <span class="operator">|</span>   <span class="number">23</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-04</span><span class="number">-22</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">6</span> <span class="operator">|</span> 大桥      <span class="operator">|</span> <span class="number">17799990005</span> <span class="operator">|</span> daqiao666<span class="variable">@sina</span>.com     <span class="operator">|</span> 舞蹈                        <span class="operator">|</span>   <span class="number">22</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-02</span><span class="number">-07</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">7</span> <span class="operator">|</span> 露娜      <span class="operator">|</span> <span class="number">17799990006</span> <span class="operator">|</span> luna_love<span class="variable">@sina</span>.com     <span class="operator">|</span> 应用数学                    <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-02</span><span class="number">-08</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">8</span> <span class="operator">|</span> 程咬金    <span class="operator">|</span> <span class="number">17799990007</span> <span class="operator">|</span> chengyaojin<span class="variable">@163</span>.com    <span class="operator">|</span> 化工                        <span class="operator">|</span>   <span class="number">38</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">5</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-05</span><span class="number">-23</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">9</span> <span class="operator">|</span> 项羽      <span class="operator">|</span> <span class="number">17799990008</span> <span class="operator">|</span> xiaoyu666<span class="variable">@qq</span>.com       <span class="operator">|</span> 金属材料                    <span class="operator">|</span>   <span class="number">43</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-09</span><span class="number">-18</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">10</span> <span class="operator">|</span> 白起      <span class="operator">|</span> <span class="number">17799990009</span> <span class="operator">|</span> baiqi666<span class="variable">@sina</span>.com      <span class="operator">|</span> 机械工程及其自动化          <span class="operator">|</span>   <span class="number">27</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-08</span><span class="number">-16</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">11</span> <span class="operator">|</span> 韩信      <span class="operator">|</span> <span class="number">17799990010</span> <span class="operator">|</span> hanxin520<span class="variable">@163</span>.com      <span class="operator">|</span> 无机非金属材料工程          <span class="operator">|</span>   <span class="number">27</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-06</span><span class="number">-12</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">12</span> <span class="operator">|</span> 荆轲      <span class="operator">|</span> <span class="number">17799990011</span> <span class="operator">|</span> jingke123<span class="variable">@163</span>.com      <span class="operator">|</span> 会计                        <span class="operator">|</span>   <span class="number">29</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-05</span><span class="number">-11</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">13</span> <span class="operator">|</span> 兰陵王    <span class="operator">|</span> <span class="number">17799990012</span> <span class="operator">|</span> lanlingwang666<span class="variable">@126</span>.com <span class="operator">|</span> 工程造价                    <span class="operator">|</span>   <span class="number">44</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-04</span><span class="number">-09</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">14</span> <span class="operator">|</span> 狂铁      <span class="operator">|</span> <span class="number">17799990013</span> <span class="operator">|</span> kuangtie<span class="variable">@sina</span>.com      <span class="operator">|</span> 应用数学                    <span class="operator">|</span>   <span class="number">43</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-04</span><span class="number">-10</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">15</span> <span class="operator">|</span> 貂蝉      <span class="operator">|</span> <span class="number">17799990014</span> <span class="operator">|</span> <span class="number">84958948374</span><span class="variable">@qq</span>.com     <span class="operator">|</span> 软件工程                    <span class="operator">|</span>   <span class="number">40</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">3</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-02</span><span class="number">-12</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">16</span> <span class="operator">|</span> 妲己      <span class="operator">|</span> <span class="number">17799990015</span> <span class="operator">|</span> <span class="number">2783238293</span><span class="variable">@qq</span>.com      <span class="operator">|</span> 软件工程                    <span class="operator">|</span>   <span class="number">31</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-01</span><span class="number">-30</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">17</span> <span class="operator">|</span> 芈月      <span class="operator">|</span> <span class="number">17799990016</span> <span class="operator">|</span> xiaomi2001.com         <span class="operator">|</span> 工业经济                    <span class="operator">|</span>   <span class="number">35</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2000</span><span class="number">-05</span><span class="number">-03</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">18</span> <span class="operator">|</span> 嬴政      <span class="operator">|</span> <span class="number">17799990017</span> <span class="operator">|</span> <span class="number">8839434342</span><span class="variable">@qq</span>.com      <span class="operator">|</span> 化工                        <span class="operator">|</span>   <span class="number">38</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-08</span><span class="number">-08</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">19</span> <span class="operator">|</span> 狄仁杰    <span class="operator">|</span> <span class="number">17799990018</span> <span class="operator">|</span> jujiamlm8166u<span class="variable">@163</span>.com  <span class="operator">|</span> 国际贸易                    <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2007</span><span class="number">-03</span><span class="number">-12</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">20</span> <span class="operator">|</span> 安琪拉    <span class="operator">|</span> <span class="number">17799990019</span> <span class="operator">|</span> jdodm1h<span class="variable">@126</span>.com        <span class="operator">|</span> 城市规划                    <span class="operator">|</span>   <span class="number">51</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-08</span><span class="number">-15</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">21</span> <span class="operator">|</span> 典韦      <span class="operator">|</span> <span class="number">17799990020</span> <span class="operator">|</span> ycaunanjian<span class="variable">@163</span>.com    <span class="operator">|</span> 城市规划                    <span class="operator">|</span>   <span class="number">52</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">2000</span><span class="number">-04</span><span class="number">-12</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">22</span> <span class="operator">|</span> 廉颇      <span class="operator">|</span> <span class="number">17799990021</span> <span class="operator">|</span> lianpo321<span class="variable">@126</span>.com      <span class="operator">|</span> 土木工程                    <span class="operator">|</span>   <span class="number">19</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">3</span>      <span class="operator">|</span> <span class="number">2002</span><span class="number">-07</span><span class="number">-18</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">23</span> <span class="operator">|</span> 后裔      <span class="operator">|</span> <span class="number">17799990022</span> <span class="operator">|</span> altycj2000<span class="variable">@139</span>.com     <span class="operator">|</span> 城市园林                    <span class="operator">|</span>   <span class="number">20</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2002</span><span class="number">-03</span><span class="number">-10</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">24</span> <span class="operator">|</span> 姜子牙    <span class="operator">|</span> <span class="number">17799990023</span> <span class="operator">|</span> <span class="number">37483844</span><span class="variable">@qq</span>.com        <span class="operator">|</span> 工程造价                    <span class="operator">|</span>   <span class="number">29</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">4</span>      <span class="operator">|</span> <span class="number">2003</span><span class="number">-05</span><span class="number">-26</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">25</span> <span class="operator">|</span> 诸葛亮    <span class="operator">|</span> <span class="number">17799990024</span> <span class="operator">|</span> zhuge666<span class="variable">@sina</span>.com      <span class="operator">|</span> 会计                        <span class="operator">|</span>   <span class="number">22</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2025</span><span class="number">-11</span><span class="number">-26</span> <span class="number">19</span>:<span class="number">32</span>:<span class="number">30</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------------+------------------------+-----------------------------+------+--------+--------+---------------------+</span></span><br><span class="line"><span class="number">25</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">COMMIT</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 当会话 1 开始事务时，会话 2 可以执行 DQL 和 DML 语句，因为 SHARED_READ 、SHARED_WRITE 兼容</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">BEGIN</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_user;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------------+------------------------+-----------------------------+------+--------+--------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name      <span class="operator">|</span> phone       <span class="operator">|</span> email                  <span class="operator">|</span> profession                  <span class="operator">|</span> age  <span class="operator">|</span> gender <span class="operator">|</span> status <span class="operator">|</span> create_time         <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------------+------------------------+-----------------------------+------+--------+--------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> 吕布      <span class="operator">|</span> <span class="number">17799990000</span> <span class="operator">|</span> lvbu666<span class="variable">@163</span>.com        <span class="operator">|</span> 化工                        <span class="operator">|</span>   <span class="number">23</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">6</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-02</span><span class="number">-02</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> 曹操      <span class="operator">|</span> <span class="number">17799990001</span> <span class="operator">|</span> caocao666<span class="variable">@qq</span>.com       <span class="operator">|</span> 化工                        <span class="operator">|</span>   <span class="number">33</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-03</span><span class="number">-05</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> 赵云      <span class="operator">|</span> <span class="number">17799990002</span> <span class="operator">|</span> <span class="number">17799990</span><span class="variable">@139</span>.com       <span class="operator">|</span> 英语                        <span class="operator">|</span>   <span class="number">34</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">2002</span><span class="number">-03</span><span class="number">-02</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> 孙悟空    <span class="operator">|</span> <span class="number">17799990003</span> <span class="operator">|</span> <span class="number">17799990</span><span class="variable">@sina</span>.com      <span class="operator">|</span> 工程造价                    <span class="operator">|</span>   <span class="number">54</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-07</span><span class="number">-02</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> 花木兰    <span class="operator">|</span> <span class="number">17799990004</span> <span class="operator">|</span> <span class="number">19980729</span><span class="variable">@sina</span>.com      <span class="operator">|</span> 软件工程                    <span class="operator">|</span>   <span class="number">23</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-04</span><span class="number">-22</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">6</span> <span class="operator">|</span> 大桥      <span class="operator">|</span> <span class="number">17799990005</span> <span class="operator">|</span> daqiao666<span class="variable">@sina</span>.com     <span class="operator">|</span> 舞蹈                        <span class="operator">|</span>   <span class="number">22</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-02</span><span class="number">-07</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">7</span> <span class="operator">|</span> 露娜      <span class="operator">|</span> <span class="number">17799990006</span> <span class="operator">|</span> luna_love<span class="variable">@sina</span>.com     <span class="operator">|</span> 应用数学                    <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-02</span><span class="number">-08</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">8</span> <span class="operator">|</span> 程咬金    <span class="operator">|</span> <span class="number">17799990007</span> <span class="operator">|</span> chengyaojin<span class="variable">@163</span>.com    <span class="operator">|</span> 化工                        <span class="operator">|</span>   <span class="number">38</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">5</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-05</span><span class="number">-23</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">9</span> <span class="operator">|</span> 项羽      <span class="operator">|</span> <span class="number">17799990008</span> <span class="operator">|</span> xiaoyu666<span class="variable">@qq</span>.com       <span class="operator">|</span> 金属材料                    <span class="operator">|</span>   <span class="number">43</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-09</span><span class="number">-18</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">10</span> <span class="operator">|</span> 白起      <span class="operator">|</span> <span class="number">17799990009</span> <span class="operator">|</span> baiqi666<span class="variable">@sina</span>.com      <span class="operator">|</span> 机械工程及其自动化          <span class="operator">|</span>   <span class="number">27</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-08</span><span class="number">-16</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">11</span> <span class="operator">|</span> 韩信      <span class="operator">|</span> <span class="number">17799990010</span> <span class="operator">|</span> hanxin520<span class="variable">@163</span>.com      <span class="operator">|</span> 无机非金属材料工程          <span class="operator">|</span>   <span class="number">27</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-06</span><span class="number">-12</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">12</span> <span class="operator">|</span> 荆轲      <span class="operator">|</span> <span class="number">17799990011</span> <span class="operator">|</span> jingke123<span class="variable">@163</span>.com      <span class="operator">|</span> 会计                        <span class="operator">|</span>   <span class="number">29</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-05</span><span class="number">-11</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">13</span> <span class="operator">|</span> 兰陵王    <span class="operator">|</span> <span class="number">17799990012</span> <span class="operator">|</span> lanlingwang666<span class="variable">@126</span>.com <span class="operator">|</span> 工程造价                    <span class="operator">|</span>   <span class="number">44</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-04</span><span class="number">-09</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">14</span> <span class="operator">|</span> 狂铁      <span class="operator">|</span> <span class="number">17799990013</span> <span class="operator">|</span> kuangtie<span class="variable">@sina</span>.com      <span class="operator">|</span> 应用数学                    <span class="operator">|</span>   <span class="number">43</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-04</span><span class="number">-10</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">15</span> <span class="operator">|</span> 貂蝉      <span class="operator">|</span> <span class="number">17799990014</span> <span class="operator">|</span> <span class="number">84958948374</span><span class="variable">@qq</span>.com     <span class="operator">|</span> 软件工程                    <span class="operator">|</span>   <span class="number">40</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">3</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-02</span><span class="number">-12</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">16</span> <span class="operator">|</span> 妲己      <span class="operator">|</span> <span class="number">17799990015</span> <span class="operator">|</span> <span class="number">2783238293</span><span class="variable">@qq</span>.com      <span class="operator">|</span> 软件工程                    <span class="operator">|</span>   <span class="number">31</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-01</span><span class="number">-30</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">17</span> <span class="operator">|</span> 芈月      <span class="operator">|</span> <span class="number">17799990016</span> <span class="operator">|</span> xiaomi2001.com         <span class="operator">|</span> 工业经济                    <span class="operator">|</span>   <span class="number">35</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2000</span><span class="number">-05</span><span class="number">-03</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">18</span> <span class="operator">|</span> 嬴政      <span class="operator">|</span> <span class="number">17799990017</span> <span class="operator">|</span> <span class="number">8839434342</span><span class="variable">@qq</span>.com      <span class="operator">|</span> 化工                        <span class="operator">|</span>   <span class="number">38</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-08</span><span class="number">-08</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">19</span> <span class="operator">|</span> 狄仁杰    <span class="operator">|</span> <span class="number">17799990018</span> <span class="operator">|</span> jujiamlm8166u<span class="variable">@163</span>.com  <span class="operator">|</span> 国际贸易                    <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2007</span><span class="number">-03</span><span class="number">-12</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">20</span> <span class="operator">|</span> 安琪拉    <span class="operator">|</span> <span class="number">17799990019</span> <span class="operator">|</span> jdodm1h<span class="variable">@126</span>.com        <span class="operator">|</span> 城市规划                    <span class="operator">|</span>   <span class="number">51</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-08</span><span class="number">-15</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">21</span> <span class="operator">|</span> 典韦      <span class="operator">|</span> <span class="number">17799990020</span> <span class="operator">|</span> ycaunanjian<span class="variable">@163</span>.com    <span class="operator">|</span> 城市规划                    <span class="operator">|</span>   <span class="number">52</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">2000</span><span class="number">-04</span><span class="number">-12</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">22</span> <span class="operator">|</span> 廉颇      <span class="operator">|</span> <span class="number">17799990021</span> <span class="operator">|</span> lianpo321<span class="variable">@126</span>.com      <span class="operator">|</span> 土木工程                    <span class="operator">|</span>   <span class="number">19</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">3</span>      <span class="operator">|</span> <span class="number">2002</span><span class="number">-07</span><span class="number">-18</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">23</span> <span class="operator">|</span> 后裔      <span class="operator">|</span> <span class="number">17799990022</span> <span class="operator">|</span> altycj2000<span class="variable">@139</span>.com     <span class="operator">|</span> 城市园林                    <span class="operator">|</span>   <span class="number">20</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2002</span><span class="number">-03</span><span class="number">-10</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">24</span> <span class="operator">|</span> 姜子牙    <span class="operator">|</span> <span class="number">17799990023</span> <span class="operator">|</span> <span class="number">37483844</span><span class="variable">@qq</span>.com        <span class="operator">|</span> 工程造价                    <span class="operator">|</span>   <span class="number">29</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">4</span>      <span class="operator">|</span> <span class="number">2003</span><span class="number">-05</span><span class="number">-26</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">25</span> <span class="operator">|</span> 诸葛亮    <span class="operator">|</span> <span class="number">17799990024</span> <span class="operator">|</span> zhuge666<span class="variable">@sina</span>.com      <span class="operator">|</span> 会计                        <span class="operator">|</span>   <span class="number">22</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2025</span><span class="number">-11</span><span class="number">-26</span> <span class="number">19</span>:<span class="number">32</span>:<span class="number">30</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------------+------------------------+-----------------------------+------+--------+--------+---------------------+</span></span><br><span class="line"><span class="number">25</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">UPDATE</span> tb_user <span class="keyword">SET</span> profession <span class="operator">=</span> <span class="string">&#x27;会计&#x27;</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">25</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"><span class="keyword">Rows</span> matched: <span class="number">1</span>  Changed: <span class="number">0</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">COMMIT</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 在会话 1 开始事务时，会话 2 不能执行 DDL 语句，因为 SHARED_READ 、SHARED_WRITE 和 EXCLUSIVE 互斥，会进入阻塞态，直到会话 1 事务结束</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">ALTER TABLE</span> tb_user <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> address <span class="type">VARCHAR</span>(<span class="number">50</span>);</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">18.24</span> sec)</span><br><span class="line">Records: <span class="number">0</span>  Duplicates: <span class="number">0</span>  Warnings: <span class="number">0</span></span><br></pre></td></tr></table></figure>

<h4 id="意向锁"><a href="#意向锁" class="headerlink" title="意向锁"></a>意向锁</h4><p>当一个事务在操作某条记录时，会给该记录添加一个行级锁，若此时另一个事务想给该表添加表级锁，会先遍历该表中的所有记录，查看是否存在行级锁，性能会有一定的影响。而后引入了<code>意向锁</code>，即在操作表时，献给表添加一个<code>意向锁</code>，再添加行级锁，此时若其他事务想给该表添加表级锁，则不会遍历该表，而是直接查看是否存在意向锁，从而提高性能。</p>
<p>意向锁分类：</p>
<ol>
<li>意向共享锁（IS）：由 <code>SELECT ... LOCK IN SHARE MODE</code> 创建，与<code>表共享读锁</code>兼容，与<code>表独占写锁（write lock）</code>排斥</li>
<li>意向排他锁（IX）：由 <code>INSERT</code>、<code>UPDATE</code>、<code>DELETE</code>、<code>SELECT ... FOR UPDATE</code> 创建，与<code>表独占读锁（read lock）</code>和<code>表独占写锁（write lock）</code>均排斥，但是意向锁之间不排斥</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 会话 1</span></span><br><span class="line"><span class="comment">-- 开启事务，并添加意向共享锁</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">BEGIN</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_user <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span> LOCK <span class="keyword">IN</span> SHARE MODE;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+-------------+-----------------+------------+------+--------+--------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name   <span class="operator">|</span> phone       <span class="operator">|</span> email           <span class="operator">|</span> profession <span class="operator">|</span> age  <span class="operator">|</span> gender <span class="operator">|</span> status <span class="operator">|</span> create_time         <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+-------------+-----------------+------------+------+--------+--------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> 吕布   <span class="operator">|</span> <span class="number">17799990000</span> <span class="operator">|</span> lvbu666<span class="variable">@163</span>.com <span class="operator">|</span> 化工       <span class="operator">|</span>   <span class="number">23</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">6</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-02</span><span class="number">-02</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+-------------+-----------------+------------+------+--------+--------+---------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 会话 2</span></span><br><span class="line"><span class="comment">-- 查看意向共享锁和行级锁</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> performance_schema.data_locks;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------+--------------------------------------------+-----------------------+-----------+----------+---------------+-------------+----------------+-------------------+------------+-----------------------+-----------+---------------+-------------+-----------+</span></span><br><span class="line"><span class="operator">|</span> ENGINE <span class="operator">|</span> ENGINE_LOCK_ID                             <span class="operator">|</span> ENGINE_TRANSACTION_ID <span class="operator">|</span> THREAD_ID <span class="operator">|</span> EVENT_ID <span class="operator">|</span> OBJECT_SCHEMA <span class="operator">|</span> OBJECT_NAME <span class="operator">|</span> PARTITION_NAME <span class="operator">|</span> SUBPARTITION_NAME <span class="operator">|</span> INDEX_NAME <span class="operator">|</span> OBJECT_INSTANCE_BEGIN <span class="operator">|</span> LOCK_TYPE <span class="operator">|</span> LOCK_MODE     <span class="operator">|</span> LOCK_STATUS <span class="operator">|</span> LOCK_DATA <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------+--------------------------------------------+-----------------------+-----------+----------+---------------+-------------+----------------+-------------------+------------+-----------------------+-----------+---------------+-------------+-----------+</span></span><br><span class="line"><span class="operator">|</span> INNODB <span class="operator">|</span> <span class="number">135808281734360</span>:<span class="number">696</span>:<span class="number">1167</span>:<span class="number">135808208130960</span>   <span class="operator">|</span>       <span class="number">417283258445016</span> <span class="operator">|</span>      <span class="number">9768</span> <span class="operator">|</span>       <span class="number">17</span> <span class="operator">|</span> mysql_study   <span class="operator">|</span> tb_user     <span class="operator">|</span> <span class="keyword">NULL</span>           <span class="operator">|</span> <span class="keyword">NULL</span>              <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span>       <span class="number">135808208130960</span> <span class="operator">|</span> <span class="keyword">TABLE</span>     <span class="operator">|</span> <span class="keyword">IS</span>            <span class="operator">|</span> GRANTED     <span class="operator">|</span> <span class="keyword">NULL</span>      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> INNODB <span class="operator">|</span> <span class="number">135808281734360</span>:<span class="number">696</span>:<span class="number">11</span>:<span class="number">4</span>:<span class="number">2</span>:<span class="number">135808208127968</span> <span class="operator">|</span>       <span class="number">417283258445016</span> <span class="operator">|</span>      <span class="number">9768</span> <span class="operator">|</span>       <span class="number">17</span> <span class="operator">|</span> mysql_study   <span class="operator">|</span> tb_user     <span class="operator">|</span> <span class="keyword">NULL</span>           <span class="operator">|</span> <span class="keyword">NULL</span>              <span class="operator">|</span> <span class="keyword">PRIMARY</span>    <span class="operator">|</span>       <span class="number">135808208127968</span> <span class="operator">|</span> RECORD    <span class="operator">|</span> S,REC_NOT_GAP <span class="operator">|</span> GRANTED     <span class="operator">|</span> <span class="number">1</span>         <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------+--------------------------------------------+-----------------------+-----------+----------+---------------+-------------+----------------+-------------------+------------+-----------------------+-----------+---------------+-------------+-----------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"><span class="comment">-- 添加表共享读锁，因为意向共享锁和表共享读锁兼容，所以不会阻塞，加锁成功</span></span><br><span class="line">mysql<span class="operator">&gt;</span> LOCK TABLES tb_user READ;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加表独占写锁，因为意向共享锁和表独占写锁排斥，所以会阻塞，加锁失败</span></span><br><span class="line">mysql<span class="operator">&gt;</span> LOCK TABLES tb_user WRITE;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 等待会话 1 事务提交后，加锁成功</span></span><br><span class="line"><span class="comment">-- Query OK, 0 rows affected (5.92 sec) </span></span><br></pre></td></tr></table></figure>

<h3 id="行级锁"><a href="#行级锁" class="headerlink" title="行级锁"></a>行级锁</h3><p>行级锁是针对单个行进行加锁，锁的颗粒度最小，发生冲突的概率最小，并发度最高。应用在 InnoDB 引擎中。</p>
<p>本质上行锁是基于索引来进行加锁的，因此只有 InnoDB 引擎支持行级锁。</p>
<ol>
<li>行锁（Record Lock）：锁定一行数据，其他会话不能对同一行数据进行 UPDATE、DELETE 操作。在 RC 和 RR 隔离级别下均支持。</li>
<li>间隙锁（Gap Lock）：锁定两个索引之间的间隙，防止其他会话在间隙内插入数据，产生幻读，只有 RR 隔离级别下支持。</li>
<li>临键锁（Next-Key Lock）：行锁 + 间隙锁，不仅锁定行数据，还锁定行数据之前的间隙，只有 RR 隔离级别下支持。</li>
</ol>
<h4 id="行锁"><a href="#行锁" class="headerlink" title="行锁"></a>行锁</h4><p>行锁分类：</p>
<ol>
<li>共享锁（Shared Lock）：允许一个会话对同一行数据进行读取，阻止其他会话获取排他锁。</li>
<li>排他锁（Exclusive Lock）：只要会话获取了排他锁，就可以更新数据，阻止其他会话获取共享锁和排他锁。</li>
</ol>
<p>锁升级：</p>
<ol>
<li>当执行 UPDATE 或者 DELETE 语句时，使用的字段没有索引时，MySQL 会对所有记录加锁，即行锁会升级为表锁。</li>
</ol>
<table>
<thead>
<tr>
<th>已存在锁</th>
<th>共享锁</th>
<th>排他锁</th>
</tr>
</thead>
<tbody><tr>
<td>已有共享锁</td>
<td>允许</td>
<td>拒绝</td>
</tr>
<tr>
<td>已有排他锁</td>
<td>拒绝</td>
<td>拒绝</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>SQL</th>
<th>锁类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>INSERT</td>
<td>排他锁</td>
<td>插入数据时，会获取排他锁</td>
</tr>
<tr>
<td>UPDATE</td>
<td>排他锁</td>
<td>更新数据时，会获取排他锁</td>
</tr>
<tr>
<td>DELETE</td>
<td>排他锁</td>
<td>删除数据时，会获取排他锁</td>
</tr>
<tr>
<td>SELECT</td>
<td></td>
<td></td>
</tr>
<tr>
<td>SELECT … LOCK IN SHARE MODE</td>
<td>共享锁</td>
<td>手动获取共享锁</td>
</tr>
<tr>
<td>SELECT … FOR UPDATE</td>
<td>排他锁</td>
<td>手动获取排他锁</td>
</tr>
</tbody></table>
<h4 id="间隙锁-临键锁"><a href="#间隙锁-临键锁" class="headerlink" title="间隙锁&#x2F;临键锁"></a>间隙锁&#x2F;临键锁</h4><ol>
<li>在唯一索引上使用等值查询(&#x3D;)且记录不存在时，Next-Key Lock会退化为Gap Lock，仅锁定相应间隙位置（如在id&#x3D;99和id&#x3D;101之间锁定id&#x3D;100的间隙）</li>
<li>在普通索引上使用等值查询时，InnoDB会使用完整的Next-Key Lock（记录锁+间隙锁），不仅锁定匹配的记录，还锁定该记录之后的间隙，以防止幻读</li>
<li>在任何索引上使用范围查询(&gt;、&lt;、BETWEEN等)时，InnoDB会使用Next-Key Lock，锁定从查询开始到不满足条件的第一个值之间的范围，包含该范围内的所有记录及其间隙</li>
</ol>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li>概述：锁的作用是防止并发访问，保证数据一致性，主要分为：全局锁、表级锁和行级锁</li>
<li>全局锁：对数据库实例进行加锁，颗粒度最大、冲突发生率最高，并发性最差</li>
<li>表级锁：对表进行加锁，颗粒度中，冲突发生率中，并发性一般，主要分为：表锁、元数据锁和意向锁</li>
<li>行级锁：对行进行加锁，颗粒度最小，冲突发生率最低，并发性最好，主要分为：行锁、间隙锁和临键锁</li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://codedog1024.github.io">Code Dog</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://codedog1024.github.io/2025/12/08/MySQL11/">https://codedog1024.github.io/2025/12/08/MySQL11/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://codedog1024.github.io" target="_blank">代码狗的小屋</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/MySQL/">MySQL</a></div><div class="post-share"><div class="social-share" data-image="/img/01.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/11/25/MySQL10/" title="MySQL 视图/存储过程/触发器"><img class="cover" src="/img/05.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">MySQL 视图/存储过程/触发器</div></div><div class="info-2"><div class="info-item-1">视图视图介绍视图（View）是一种虚拟存在的表，它是基于 SQL 查询结果集创建的。视图本身不存储数据，而是动态地从基础表中获取数据。视图可以简化复杂的查询，提高数据的安全性，并提供数据的抽象层。 视图基本使用 创建视图  CREATE [OR REPLACE] VIEW 视图名 AS 查询语句 [WITH [CASCADED | LOCAL] CHECK OPTION];   查看全部视图  SHOW FULL TABLES WHERE Table_type &#x3D; ‘VIEW’;   查看指定视图的定义  SHOW CREATE VIEW 视图名;   查看视图数据  SELECT * FROM 视图名;   修改视图  CREATE OR REPLACE VIEW 视图名 AS 新的查询语句 [WITH [CASCADED | LOCAL] CHECK OPTION];   ALTER VIEW 视图名 AS 新的查询语句 [WITH [CASCADED | LOCAL] CHECK OPTION];   删除视图  DROP VIEW [IF EXISTS]...</div></div></div></a><a class="pagination-related" href="/2025/12/09/MySQL12/" title="MySQL InnoDB 引擎"><img class="cover" src="/img/04.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">MySQL InnoDB 引擎</div></div><div class="info-2"><div class="info-item-1">逻辑存储结构 表空间（Tablespace）：一个 MySQL 实例可以对应多个表空间，用于存储记录、索引等数据，一个表空间内含有多个段（Segment）。 段（Segment）：分为数据段（Leaf node segment）、索引段（Non-leaf node segment）、回滚段（Rollback segment），InnoDB 是索引组织表，数据段就是 B+ 树的叶子节点，索引段就是 B+ 数据非叶子阶段。一个段内含有多个区（Extent）。 区（Extent）：每个区的大小为 1M，默认情况下，一个区中含有 64 个页（Page），即每个页的大小为 16 K. 页（Page）：InnoDB 引擎最小的存储单元，每个页大小为 16K，为了保证页的连续性，InnoDB 引擎每次会从磁盘申请 4 ~ 5 个区。 行（Row）：即每一条记录。包含两个隐藏字段：Trx_id 和 Roll_pointer，Trx_id 用于保存事务 id，Roll_pointer 用于保存记录的旧值记录。  架构MySQL 5.5 之后，InndDB...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/10/29/MySQL1/" title="MySQL 概述"><img class="cover" src="/img/09.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-29</div><div class="info-item-2">MySQL 概述</div></div><div class="info-2"><div class="info-item-1">概述数据库：数据库就是一个仓库，将数据进行有组织的存储管理。 MySQL: 是一个关系型数据库管理系统（Relational Database Management System，RDBMS），MySQL 并不是数据库。 SQL：SQL是Structured Query Language的缩写，是一种数据库查询和程序设计语言。我们需要通过编写 SQL 语句来操作数据库。 数据库分类   数据库 类型    Oracle 关系型数据库   MySQL 关系型数据库   SQL Server 关系型数据库   PostgreSQL 关系型数据库   IBM DB2 关系型数据库   SQLite 关系型数据库   MongoDB 非关系型数据库   Microsoft Azure SQL Database 关系型数据库   Hive 关系型数据库   下载安装 MySQL社区版 下载地址 启动、停止 启动命令：net start 服务名 停止命令：net stop 服务名  连接 使用 MySQL 提供的命令行工具 使用 windows 终端，执行 MySQL [-h...</div></div></div></a><a class="pagination-related" href="/2025/10/29/MySQL2/" title="MySQL SQL"><img class="cover" src="/img/07.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-29</div><div class="info-item-2">MySQL SQL</div></div><div class="info-2"><div class="info-item-1">SQL 通用语法 SQL 语句可以单行或多行编写，以分号结尾。 SQL 中应使用空格来格式化语句，提高可读性。 SQL 语句大小写不敏感，但建议使用大写。 注释： 单行注释：--、# 多行注释：/* */    SQL 分类   分类 全称 描述    DDL Data Definition Language 数据定义语言，用于定义数据库对象，如表、索引、视图、存储过程、函数等   DML Data Manipulation Language 数据操作语言，用于对数据库中的数据进行增删改   DQL Data Query Language 数据查询语言，用于查询数据库中的数据   DCL Data Control Language 数据控制语言，用于控制数据库的访问权限   DDL操作数据库   功能 SQL 语法 描述    查询 SHOW DATABASES; 查询全部数据库   查询 SELECT DATABASE(); 查询当前数据库   创建 CREATE DATABASE [IF NOT EXISTS] 数据库名 [DEFAULT CHARACTER SET...</div></div></div></a><a class="pagination-related" href="/2025/11/06/MySQL4/" title="MySQL 约束"><img class="cover" src="/img/08.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-06</div><div class="info-item-2">MySQL 约束</div></div><div class="info-2"><div class="info-item-1">约束约束：作用在表中的字段上，保证字段的数据满足要求，用于保证数据的正确型、有效性、安全性。 分类   约束 作用 关键字    主键 该值必须唯一、不重复、不能为 NULL PRIMARY KEY   外键 该值必须在指定表中存在 FOREIGN KEY   唯一 该值必须唯一、不重复 UNIQUE   非空 该值不能为空 NOT NULL   默认值 若为指定该值，则使用默认值 DEFAULT   检查 检查字段的值 CHECK   约束代码示例123456789101112CREATE TABLE users (    -- 主键，并且自增    id INT PRIMARY KEY AUTO_INCREMENT COMMENT &#x27;ID&#x27;,    -- 唯一，并且不能为空    name VARCHAR(10) NOT NULL UNIQUE COMMENT &#x27;姓名&#x27;,    -- 检查，年龄必须大于 0 且小于 120    age INT CHECK ( age &gt; 0 AND age &lt; 120) COMMENT...</div></div></div></a><a class="pagination-related" href="/2025/11/07/MySQL5/" title="MySQL 多表查询"><img class="cover" src="/img/06.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-07</div><div class="info-item-2">MySQL 多表查询</div></div><div class="info-2"><div class="info-item-1">多表关系在实际开发中，每个表之间都存在一些关系，基本上分为三种：一对一、一对多(多对一)、多对多。 一对一一对一关系，比如：学生表和档案表，对于学生来说，一个学生只能拥有一份档案，而档案只能属于一个学生，这就是一对一。 12345678910111213CREATE TABLE student (    id   INT PRIMARY KEY AUTO_INCREMENT COMMENT &#x27;ID&#x27;,    name VARCHAR(10) UNIQUE NOT NULL COMMENT &#x27;姓名&#x27;) COMMENT &#x27;学生表&#x27;;CREATE TABLE profile (    id   INT PRIMARY KEY AUTO_INCREMENT COMMENT &#x27;ID&#x27;,    phone CHAR(11) UNIQUE COMMENT &#x27;电话号&#x27;,    address VARCHAR(100) COMMENT &#x27;家庭住址&#x27;,    --...</div></div></div></a><a class="pagination-related" href="/2025/11/06/MySQL3/" title="MySQL 函数"><img class="cover" src="/img/13.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-06</div><div class="info-item-2">MySQL 函数</div></div><div class="info-2"><div class="info-item-1">函数函数是一段已经被编写好，可以直接使用的代码片段。MySQL 中内置了很多的函数，我们可以使用这些函数来完成一些简单的任务。 字符串函数常用字符串函数   函数 描述    CONCAT(str1, str2, …) 连接字符串   LOWER(str) 将字符串转换为小写   UPPER(str) 将字符串转换为大写   LPAD(str, len, pad_str) 左填充字符串   RPAD(str, len, pad_str) 右填充字符串   TRIM(str) 去掉字符串两侧的空格   SUBSTRING(str, start, len) 截取字符串   REPLACE(str, old_str, new_str) 替换字符串   LENGTH(str) 返回字符串的长度   LOCATE(substr, str) 返回子字符串在字符串中的位置   INSTR(str,...</div></div></div></a><a class="pagination-related" href="/2025/11/09/MySQL7/" title="MySQL 存储引擎"><img class="cover" src="/img/10.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-09</div><div class="info-item-2">MySQL 存储引擎</div></div><div class="info-2"><div class="info-item-1">MySQL 体系结构图 客户端连接器：Native C API、JDBC、ODBC、.NET、PHP、Python、Ruby、Cobol 等 MySQL 服务端： 连接层：连接池 服务层：SQL 接口、解析器、查询优化器、缓存 引擎层：可插拔存储引擎 存储层：数据文件、索引文件、数据结构、数据结构描述文件    存储引擎简介存储引擎是 MySQL 数据库管理系统中的核心部分，负责处理数据存储和检索。存储引擎提供了一种机制，将数据存储在数据库管理系统中，并允许用户使用各种查询语句来检索数据。存储引擎是基于表的，而不是库，所以同一个库中的不同表可以有不同的存储引擎。  查看数据库支持的存储引擎  SHOW ENGINES;   设置存储引擎  CREATE TABLE table_name (……) ENGINE&#x3D;[存储引擎名];    123456789101112131415161718192021-- 查看建表语句-- ENGINE=InnoDB 默认存储引擎为 InnoDBSHOW CREATE TABLE account;--...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Code Dog</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">40</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%94%81"><span class="toc-number">1.</span> <span class="toc-text">锁</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%B1%BB"><span class="toc-number">1.2.</span> <span class="toc-text">分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E9%94%81"><span class="toc-number">1.3.</span> <span class="toc-text">全局锁</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E7%BA%A7%E9%94%81"><span class="toc-number">1.4.</span> <span class="toc-text">表级锁</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A1%A8%E9%94%81"><span class="toc-number">1.4.1.</span> <span class="toc-text">表锁</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%83%E6%95%B0%E6%8D%AE%E9%94%81"><span class="toc-number">1.4.2.</span> <span class="toc-text">元数据锁</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%84%8F%E5%90%91%E9%94%81"><span class="toc-number">1.4.3.</span> <span class="toc-text">意向锁</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%8C%E7%BA%A7%E9%94%81"><span class="toc-number">1.5.</span> <span class="toc-text">行级锁</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A1%8C%E9%94%81"><span class="toc-number">1.5.1.</span> <span class="toc-text">行锁</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%B4%E9%9A%99%E9%94%81-%E4%B8%B4%E9%94%AE%E9%94%81"><span class="toc-number">1.5.2.</span> <span class="toc-text">间隙锁&#x2F;临键锁</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">2.</span> <span class="toc-text">总结</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/12/09/MySQL12/" title="MySQL InnoDB 引擎"><img src="/img/04.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL InnoDB 引擎"/></a><div class="content"><a class="title" href="/2025/12/09/MySQL12/" title="MySQL InnoDB 引擎">MySQL InnoDB 引擎</a><time datetime="2025-12-09T13:41:17.000Z" title="发表于 2025-12-09 21:41:17">2025-12-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/12/08/MySQL11/" title="MySQL 锁"><img src="/img/01.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL 锁"/></a><div class="content"><a class="title" href="/2025/12/08/MySQL11/" title="MySQL 锁">MySQL 锁</a><time datetime="2025-12-08T12:14:44.000Z" title="发表于 2025-12-08 20:14:44">2025-12-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/11/25/MySQL10/" title="MySQL 视图/存储过程/触发器"><img src="/img/05.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL 视图/存储过程/触发器"/></a><div class="content"><a class="title" href="/2025/11/25/MySQL10/" title="MySQL 视图/存储过程/触发器">MySQL 视图/存储过程/触发器</a><time datetime="2025-11-25T14:32:08.000Z" title="发表于 2025-11-25 22:32:08">2025-11-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/11/24/MySQL9/" title="MySQL SQL 优化"><img src="/img/03.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL SQL 优化"/></a><div class="content"><a class="title" href="/2025/11/24/MySQL9/" title="MySQL SQL 优化">MySQL SQL 优化</a><time datetime="2025-11-24T12:40:22.000Z" title="发表于 2025-11-24 20:40:22">2025-11-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/11/11/MySQL8/" title="MySQL 索引"><img src="/img/13.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL 索引"/></a><div class="content"><a class="title" href="/2025/11/11/MySQL8/" title="MySQL 索引">MySQL 索引</a><time datetime="2025-11-11T15:37:21.000Z" title="发表于 2025-11-11 23:37:21">2025-11-11</time></div></div></div></div></div></div></main><footer id="footer" style="background: ture;"><div id="footer-wrap"><div class="copyright">&copy;2025 By Code Dog</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script>(() => {
  const destroyAplayer = () => {
    if (window.aplayers) {
      for (let i = 0; i < window.aplayers.length; i++) {
        if (!window.aplayers[i].options.fixed) {
          window.aplayers[i].destroy()
        }
      }
    }
  }

  const runMetingJS = () => {
    typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()
  }

  btf.addGlobalFn('pjaxSend', destroyAplayer, 'destroyAplayer')
  btf.addGlobalFn('pjaxComplete', loadMeting, 'runMetingJS')
})()</script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>(() => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => fn())
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      const usePjax = true
      false 
        ? (usePjax ? pjax.loadUrl('/404.html') : window.location.href = '/404.html')
        : window.location.href = e.request.responseURL
    }
  })
})()</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>