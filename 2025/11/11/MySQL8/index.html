<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>MySQL 索引 | 代码狗的小屋</title><meta name="author" content="Code Dog"><meta name="copyright" content="Code Dog"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="索引前置准备Linux 服务器 云服务 虚拟机  Linux 安装 Mysql 使用终端工具连接云服务器，并安装 MySQL apt update apt install mysql-server   MySQL 默认启动，如果未启动，请执行以下命令 systemctl start mysql systemctl status mysql   修改 MySQL 密码，默认情况下，root 用户可能">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL 索引">
<meta property="og:url" content="https://codedog1024.github.io/2025/11/11/MySQL8/index.html">
<meta property="og:site_name" content="代码狗的小屋">
<meta property="og:description" content="索引前置准备Linux 服务器 云服务 虚拟机  Linux 安装 Mysql 使用终端工具连接云服务器，并安装 MySQL apt update apt install mysql-server   MySQL 默认启动，如果未启动，请执行以下命令 systemctl start mysql systemctl status mysql   修改 MySQL 密码，默认情况下，root 用户可能">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://codedog1024.github.io/img/10.jpg">
<meta property="article:published_time" content="2025-11-11T15:37:21.000Z">
<meta property="article:modified_time" content="2025-11-26T11:25:41.705Z">
<meta property="article:author" content="Code Dog">
<meta property="article:tag" content="MySQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://codedog1024.github.io/img/10.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "MySQL 索引",
  "url": "https://codedog1024.github.io/2025/11/11/MySQL8/",
  "image": "https://codedog1024.github.io/img/10.jpg",
  "datePublished": "2025-11-11T15:37:21.000Z",
  "dateModified": "2025-11-26T11:25:41.705Z",
  "author": [
    {
      "@type": "Person",
      "name": "Code Dog",
      "url": "https://codedog1024.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://codedog1024.github.io/2025/11/11/MySQL8/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const hour = new Date().getHours()
          const isNight = hour <= 6 || hour >= 1
          if (theme === undefined) isNight ? activateDarkMode() : activateLightMode()
          else theme === 'light' ? activateLightMode() : activateDarkMode()
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'MySQL 索引',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">38</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/10.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">代码狗的小屋</span></a><a class="nav-page-title" href="/"><span class="site-name">MySQL 索引</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">MySQL 索引</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-11-11T15:37:21.000Z" title="发表于 2025-11-11 23:37:21">2025-11-11</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-11-26T11:25:41.705Z" title="更新于 2025-11-26 19:25:41">2025-11-26</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h2 id="索引前置准备"><a href="#索引前置准备" class="headerlink" title="索引前置准备"></a>索引前置准备</h2><h3 id="Linux-服务器"><a href="#Linux-服务器" class="headerlink" title="Linux 服务器"></a>Linux 服务器</h3><ol>
<li>云服务</li>
<li>虚拟机</li>
</ol>
<h3 id="Linux-安装-Mysql"><a href="#Linux-安装-Mysql" class="headerlink" title="Linux 安装 Mysql"></a>Linux 安装 Mysql</h3><ol>
<li>使用终端工具连接云服务器，并安装 MySQL<ul>
<li>apt update</li>
<li>apt install mysql-server</li>
</ul>
</li>
<li>MySQL 默认启动，如果未启动，请执行以下命令<ul>
<li>systemctl start mysql</li>
<li>systemctl status mysql</li>
</ul>
</li>
<li>修改 MySQL 密码，默认情况下，root 用户可能使用了一种叫做 <code>auth_socket</code> 的插件进行认证。这种认证方式不要求密码，而是检查当前系统用户是否与MySQL用户匹配。如果系统用户是root，那么就可以无需密码直接登录。<ul>
<li>mysql -u root -p</li>
<li>ALTER USER ‘root‘@’localhost’ IDENTIFIED WITH mysql_native_password BY ‘xxxxxx’;</li>
</ul>
</li>
<li>创建用户，并授权<ul>
<li>CREATE USER ‘root‘@’xxx.xxx.xxx.xxx’ IDENTIFIED BY ‘xxxxxx’;</li>
<li>GRANT ALL ON xxx.xxx TO ‘root‘@’xxx.xxx.xxx.xxx’;</li>
</ul>
</li>
</ol>
<h3 id="连接不上原因"><a href="#连接不上原因" class="headerlink" title="连接不上原因"></a>连接不上原因</h3><ol>
<li>查看 MySQL 服务器的状态，是否启动了</li>
<li>MySQL 密码是否正确</li>
<li>查看服务器的网络安全组，是否开通了 3306 端口，是否允许本机 IP 访问</li>
<li>查看 MySQL 服务器的配置文件 <code>/etc/mysql/mysql.conf.d/mysqld.cnf</code>，查看 <code>bind-address</code> 是否是 <code>0.0.0.0</code></li>
</ol>
<h2 id="索引概述"><a href="#索引概述" class="headerlink" title="索引概述"></a>索引概述</h2><p>索引是一种数据库结构，它可以提高数据库的查询效率。除了保存原始数据之外，数据库还需要维护<code>索引</code>，索引指向原始数据，通过查找索引，可以快速找到原始数据。</p>
<h3 id="有无索引"><a href="#有无索引" class="headerlink" title="有无索引"></a>有无索引</h3><ol>
<li>全表扫描：当查询的字段不在索引中时，数据库会全表扫描，即从表中的第一行开始，顺序地读取每一行，直到找到匹配的行。</li>
<li>索引扫描：当查询的字段在索引中时，数据库会通过索引来查找匹配的行。索引扫描比全表扫描更快，因为它可以跳过一些行。</li>
</ol>
<h3 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h3><ol>
<li>通过索引可以提高查询效率，且通过索引进行排序可以减少排序的开销。</li>
<li>但是索引需要占用额外的存储空间，且数据库需要维护索引，因此在更新表时，更新索引也会有额外的开销。</li>
</ol>
<h2 id="索引结构"><a href="#索引结构" class="headerlink" title="索引结构"></a>索引结构</h2><p>索引实在存储引擎层实现的，因此，根据不同的存储引擎，索引结构也不同。</p>
<table>
<thead>
<tr>
<th>索引结构</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>B+树索引</td>
<td>最常见的索引，大部分引擎都支持 B+树 索引</td>
</tr>
<tr>
<td>Hash索引</td>
<td>底层使用 Hash 表实现，只有精确匹配索引列时才有效，不支持范围查询</td>
</tr>
<tr>
<td>R-树索引</td>
<td>空间索引，是 MyISAM 引擎的一个特殊索引类型，用于地理空间数据类型</td>
</tr>
<tr>
<td>Full Text索引</td>
<td>全文索引是一种通过倒排索引，快速匹配文档的方式。类似于 Lucene、Solr、ES 等全文检索引擎</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>索引结构</th>
<th>InnoDB</th>
<th>MyISAM</th>
<th>Memory</th>
</tr>
</thead>
<tbody><tr>
<td>B+树索引</td>
<td>√</td>
<td>√</td>
<td>√</td>
</tr>
<tr>
<td>Hash索引</td>
<td></td>
<td></td>
<td>√</td>
</tr>
<tr>
<td>R-树索引</td>
<td></td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>Full Text索引</td>
<td>√</td>
<td>√</td>
<td></td>
</tr>
</tbody></table>
<h3 id="B-树索引"><a href="#B-树索引" class="headerlink" title="B+树索引"></a>B+树索引</h3><p>B 树：多路平衡查找树，每一个节点最多有 m 个 key, 有 m + 1 个指针，每个指针都对应一个子树。当添加元素时，会按照 B 树 的规则进行添加，当添加的元素个数超过 m 个时，会进行分裂，即节点会将中间元素存入父节点中，左边的元素为左子节点，右边的元素为右子节点。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 假如有以下节点，向其中添加元素 500</span></span><br><span class="line"><span class="comment">-- [100, 200, 300, 400]</span></span><br><span class="line"><span class="comment">-- 1. 添加元素 500 → [100, 200, 300, 400，500]</span></span><br><span class="line"><span class="comment">-- 2. 分裂，中间元素 300 添加到父节点，左边的元素为左子节点，右边的元素为右子节点。</span></span><br><span class="line"><span class="comment">-- 3.        [300]</span></span><br><span class="line"><span class="comment">--         /       \</span></span><br><span class="line"><span class="comment">--   [100, 200] [400, 500]  </span></span><br></pre></td></tr></table></figure>

<p>B+树：B+树，是在 B树基础上进行的优化，在 B+树中，<code>除叶子节点以外的其他节点，均不保存数据，只是作为索引节点</code>，保存索引数据。因此，所有的索引节点也都会有一个与之对应的叶子节点。在所有的叶子节点中，也存在一个<code>单向链表连接所有的叶子节点</code>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 假如有以下节点，向其中添加元素 500</span></span><br><span class="line"><span class="comment">-- [100, 200, 300, 400]</span></span><br><span class="line"><span class="comment">-- 1. 添加元素 500 → [100, 200, 300, 400，500]</span></span><br><span class="line"><span class="comment">-- 2. 分裂，中间元素 300 添加到父节点，左边的元素为左子节点，右边的元素为右子节点。</span></span><br><span class="line"><span class="comment">-- 3.        [300]</span></span><br><span class="line"><span class="comment">--         /       \</span></span><br><span class="line"><span class="comment">--   [100, 200] → [300，400, 500]  </span></span><br></pre></td></tr></table></figure>

<p>MySQL 中的 B+树 在原 B+树 基础上又添加了一个链表指针，即让每个叶子节点都指向自己相邻的叶子节点。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--             [300]</span></span><br><span class="line"><span class="comment">--          /         \</span></span><br><span class="line"><span class="comment">--   [100, 200] ←→ [300，400, 500]  </span></span><br></pre></td></tr></table></figure>

<h3 id="Hash-索引"><a href="#Hash-索引" class="headerlink" title="Hash 索引"></a>Hash 索引</h3><p>Hash 索引是一种基于哈希函数的数据结构，先将索引字段的值作为键值，计算出每个键值的哈希值，存入哈希表中，并且在哈希表中保存原始数据的位置。</p>
<p>特点：</p>
<ol>
<li>只支持等值比较，如：<code>=</code>、<code>in</code>，不支持范围查询，如：<code>&gt;</code>、<code>&lt;</code>、<code>between</code>等。</li>
<li>无法利用索引进行排序</li>
<li>查询效率高于 B+树索引</li>
</ol>
<p>在 MySQL 中，只有 Memory 存储引擎支持 Hash 索引。但是 InnoDB 存储引擎具有自适应 Hash 功能，可以根据 B+树索引在指定条件下自动构建。</p>
<h3 id="为什么-InnoDB-存储引擎使用-B-树索引"><a href="#为什么-InnoDB-存储引擎使用-B-树索引" class="headerlink" title="为什么 InnoDB 存储引擎使用 B+树索引"></a>为什么 InnoDB 存储引擎使用 B+树索引</h3><ol>
<li>B+树相比于 二叉树、红黑树等结构，在相同数据量的情况下，层级更少，查询效率更高。</li>
<li>非叶子节点保存在<code>页</code>中，而页的大小较小，B树的非叶子节点也要保存原始数据，那么在同等存储空间下，B+树存储的索引数量比B树要多。</li>
</ol>
<h2 id="索引的分类"><a href="#索引的分类" class="headerlink" title="索引的分类"></a>索引的分类</h2><h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><table>
<thead>
<tr>
<th>类型</th>
<th>描述</th>
<th>个数</th>
<th>关键字</th>
</tr>
</thead>
<tbody><tr>
<td>主键索引</td>
<td>针对于表中主键所创建的索引</td>
<td>主键会自动创建索引，只能有一个</td>
<td>PRIMARY</td>
</tr>
<tr>
<td>唯一索引</td>
<td>索引中不允许有重复的值</td>
<td>可以有多个</td>
<td>UNIQUE</td>
</tr>
<tr>
<td>普通索引</td>
<td>快速定位指定数据</td>
<td>可以有多个</td>
<td></td>
</tr>
<tr>
<td>全文索引</td>
<td>全文索引匹配的是文本中的关键字</td>
<td>可以有多个</td>
<td>FULLTEXT</td>
</tr>
</tbody></table>
<h3 id="聚集索引和非聚集索引"><a href="#聚集索引和非聚集索引" class="headerlink" title="聚集索引和非聚集索引"></a>聚集索引和非聚集索引</h3><p>在 InnoDB 中，根据索引的存储形式，又可以分为两类：</p>
<table>
<thead>
<tr>
<th>索引存储形式</th>
<th>索引类型</th>
<th>特点</th>
</tr>
</thead>
<tbody><tr>
<td>聚集索引</td>
<td>索引和数据<code>一起存储</code>，索引中存储的是<code>数据本身</code></td>
<td>有且只能一个</td>
</tr>
<tr>
<td>二级索引(非聚集索引)</td>
<td>索引和数据<code>分开存储</code>，索引中存储的是数据的<code>主键值</code></td>
<td>可以有多个</td>
</tr>
</tbody></table>
<p>聚集索引有且只有一个，所以不需要我们自己创建，默认的规则为：</p>
<ol>
<li>如果存在主键，主键索引就是聚集索引</li>
<li>如果不存在主键，则使用第一个唯一索引作为聚集索引</li>
<li>如果以上均不存在，则会自动生成一个 rowid 列作为聚集索引</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 现在有一个 users 表，其中包含 id, name, age, email 四个字段，id 为主键</span></span><br><span class="line"><span class="comment">-- 1. 存在主键，那么 id 就是聚集索引，此时该索引结构中，每个叶子节点都会保存原始数据</span></span><br><span class="line"><span class="comment">-- 2. 给字段 name 添加普通索引，则 name 就是二级索引，该索引结构中，每个叶子节点都会保存原始数据的主键值</span></span><br><span class="line"><span class="comment">-- 3. 执行 select * from users where name = &#x27;张三&#x27;; 语句，查询条件为 name 列，会通过二级索引中的 name 列找到原始数据的主键值，然后通过主键值，在聚集索引中查找原始数据</span></span><br></pre></td></tr></table></figure>

<h3 id="回表"><a href="#回表" class="headerlink" title="回表"></a>回表</h3><ul>
<li>通过非聚集索引查询数据，得到原始数据主键值，然后通过主键值，在聚集索引中查找原始数据的操作称为：<code>索引回表</code></li>
</ul>
<h3 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h3><p>以下两个 SQL 语句，执行效率哪个更高？</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t_user <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t_user <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;张三&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 第一个语句执行效率更高，因为使用了聚集索引，可以直接获取数据</span></span><br><span class="line"><span class="comment">-- 第二个语句执行效率较低，因为使用了非聚集索引，需要通过索引回表获取数据</span></span><br></pre></td></tr></table></figure>

<p>InnoDB 主键索引的 B+树 高度是多少？</p>
<p>主键索引为聚集索引，索引保存的是主键值，除叶子节点外，非叶子节点不保存数据，只保存主键值和指针，且指针个数 &#x3D; 主键值个数 + 1，<br>假设主键值的数据类型为 int，那么一个主键值所占用的内存为 4bit，一个指针占用 6bit, 而每个节点存储在<code>页</code>中，一个页大小为 16KB，那么根据公式 m * 4 + (m + 1) * 6 &#x3D; 16 * 1024，可以得到 m &#x3D; 1637，那么一个节点可以存储 1637 个主键值和 1638 个指针。如果每条数据大小为 1KB，那么一页可以存储 16 个数据。如果该 B+树有两层，则可以存储 16 * 1637 &#x3D; 26192 条数据。</p>
<h2 id="索引语法"><a href="#索引语法" class="headerlink" title="索引语法"></a>索引语法</h2><h3 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h3><blockquote>
<p>CREATE [UNIQUE | FULLTEXT] INDEX index_name ON table_name (column_name1, column_name2, …);</p>
</blockquote>
<h3 id="查看索引"><a href="#查看索引" class="headerlink" title="查看索引"></a>查看索引</h3><blockquote>
<p>SHOW INDEX FROM table_name;</p>
</blockquote>
<h3 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h3><blockquote>
<p>DROP INDEX index_name ON table_name;</p>
</blockquote>
<h3 id="索引练习"><a href="#索引练习" class="headerlink" title="索引练习"></a>索引练习</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE mysql_study;</span><br><span class="line">USE mysql_study;</span><br><span class="line"><span class="keyword">CREATE TABLE</span> tb_user</span><br><span class="line">(</span><br><span class="line">    id          <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;ID&#x27;</span>,</span><br><span class="line">    name        <span class="type">VARCHAR</span>(<span class="number">16</span>) COMMENT <span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line">    phone       <span class="type">VARCHAR</span>(<span class="number">11</span>) COMMENT <span class="string">&#x27;电话&#x27;</span>,</span><br><span class="line">    email       <span class="type">VARCHAR</span>(<span class="number">32</span>) COMMENT <span class="string">&#x27;邮箱&#x27;</span>,</span><br><span class="line">    profession  <span class="type">VARCHAR</span>(<span class="number">16</span>) COMMENT <span class="string">&#x27;专业&#x27;</span>,</span><br><span class="line">    age         <span class="type">INT</span> COMMENT <span class="string">&#x27;年龄&#x27;</span>,</span><br><span class="line">    gender      <span class="type">CHAR</span>(<span class="number">1</span>) COMMENT <span class="string">&#x27;性别&#x27;</span>,</span><br><span class="line">    status      <span class="type">CHAR</span>(<span class="number">1</span>) COMMENT <span class="string">&#x27;状态&#x27;</span>,</span><br><span class="line">    create_time DATETIME COMMENT <span class="string">&#x27;创建时间&#x27;</span></span><br><span class="line">) COMMENT <span class="string">&#x27;用户表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> tb_user(name, phone, email, profession, age, gender, status, create_time)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="string">&#x27;吕布&#x27;</span>, <span class="number">17799990000</span>, <span class="string">&#x27;lvbu666@163.com&#x27;</span>, <span class="string">&#x27;软件工程&#x27;</span>, <span class="number">23</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;2001-02-02 00:00:00&#x27;</span>),</span><br><span class="line">       (<span class="string">&#x27;曹操&#x27;</span>, <span class="number">17799990001</span>, <span class="string">&#x27;caocao666@qq.com&#x27;</span>, <span class="string">&#x27;通讯工程&#x27;</span>, <span class="number">33</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;2001-03-05 00:00:00&#x27;</span>),</span><br><span class="line">       (<span class="string">&#x27;赵云&#x27;</span>, <span class="number">17799990002</span>, <span class="string">&#x27;17799990@139.com&#x27;</span>, <span class="string">&#x27;英语&#x27;</span>, <span class="number">34</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;2002-03-02 00:00:00&#x27;</span>),</span><br><span class="line">       (<span class="string">&#x27;孙悟空&#x27;</span>, <span class="number">17799990003</span>, <span class="string">&#x27;17799990@sina.com&#x27;</span>, <span class="string">&#x27;工程造价&#x27;</span>, <span class="number">54</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;2001-07-02 00:00:00&#x27;</span>),</span><br><span class="line">       (<span class="string">&#x27;花木兰&#x27;</span>, <span class="number">17799990004</span>, <span class="string">&#x27;19980729@sina.com&#x27;</span>, <span class="string">&#x27;软件工程&#x27;</span>, <span class="number">23</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2001-04-22 00:00:00&#x27;</span>),</span><br><span class="line">       (<span class="string">&#x27;大桥&#x27;</span>, <span class="number">17799990005</span>, <span class="string">&#x27;daqiao666@sina.com&#x27;</span>, <span class="string">&#x27;舞蹈&#x27;</span>, <span class="number">22</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;2001-02-07 00:00:00&#x27;</span>),</span><br><span class="line">       (<span class="string">&#x27;露娜&#x27;</span>, <span class="number">17799990006</span>, <span class="string">&#x27;luna_love@sina.com&#x27;</span>, <span class="string">&#x27;应用数学&#x27;</span>, <span class="number">24</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;2001-02-08 00:00:00&#x27;</span>),</span><br><span class="line">       (<span class="string">&#x27;程咬金&#x27;</span>, <span class="number">17799990007</span>, <span class="string">&#x27;chengyaojin@163.com&#x27;</span>, <span class="string">&#x27;化工&#x27;</span>, <span class="number">38</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;2001-05-23 00:00:00&#x27;</span>),</span><br><span class="line">       (<span class="string">&#x27;项羽&#x27;</span>, <span class="number">17799990008</span>, <span class="string">&#x27;xiaoyu666@qq.com&#x27;</span>, <span class="string">&#x27;金属材料&#x27;</span>, <span class="number">43</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;2001-09-18 00:00:00&#x27;</span>),</span><br><span class="line">       (<span class="string">&#x27;白起&#x27;</span>, <span class="number">17799990009</span>, <span class="string">&#x27;baiqi666@sina.com&#x27;</span>, <span class="string">&#x27;机械工程及其自动化&#x27;</span>, <span class="number">27</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;2001-08-16 00:00:00&#x27;</span>),</span><br><span class="line">       (<span class="string">&#x27;韩信&#x27;</span>, <span class="number">17799990010</span>, <span class="string">&#x27;hanxin520@163.com&#x27;</span>, <span class="string">&#x27;无机非金属材料工程&#x27;</span>, <span class="number">27</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;2001-06-12 00:00:00&#x27;</span>),</span><br><span class="line">       (<span class="string">&#x27;荆轲&#x27;</span>, <span class="number">17799990011</span>, <span class="string">&#x27;jingke123@163.com&#x27;</span>, <span class="string">&#x27;会计&#x27;</span>, <span class="number">29</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;2001-05-11 00:00:00&#x27;</span>),</span><br><span class="line">       (<span class="string">&#x27;兰陵王&#x27;</span>, <span class="number">17799990012</span>, <span class="string">&#x27;lanlingwang666@126.com&#x27;</span>, <span class="string">&#x27;工程造价&#x27;</span>, <span class="number">44</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2001-04-09 00:00:00&#x27;</span>),</span><br><span class="line">       (<span class="string">&#x27;狂铁&#x27;</span>, <span class="number">17799990013</span>, <span class="string">&#x27;kuangtie@sina.com&#x27;</span>, <span class="string">&#x27;应用数学&#x27;</span>, <span class="number">43</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;2001-04-10 00:00:00&#x27;</span>),</span><br><span class="line">       (<span class="string">&#x27;貂蝉&#x27;</span>, <span class="number">17799990014</span>, <span class="string">&#x27;84958948374@qq.com&#x27;</span>, <span class="string">&#x27;软件工程&#x27;</span>, <span class="number">40</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;2001-02-12 00:00:00&#x27;</span>),</span><br><span class="line">       (<span class="string">&#x27;妲己&#x27;</span>, <span class="number">17799990015</span>, <span class="string">&#x27;2783238293@qq.com&#x27;</span>, <span class="string">&#x27;软件工程&#x27;</span>, <span class="number">31</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;2001-01-30 00:00:00&#x27;</span>),</span><br><span class="line">       (<span class="string">&#x27;芈月&#x27;</span>, <span class="number">17799990016</span>, <span class="string">&#x27;xiaomi2001.com&#x27;</span>, <span class="string">&#x27;工业经济&#x27;</span>, <span class="number">35</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;2000-05-03 00:00:00&#x27;</span>),</span><br><span class="line">       (<span class="string">&#x27;嬴政&#x27;</span>, <span class="number">17799990017</span>, <span class="string">&#x27;8839434342@qq.com&#x27;</span>, <span class="string">&#x27;化工&#x27;</span>, <span class="number">38</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2001-08-08 00:00:00&#x27;</span>),</span><br><span class="line">       (<span class="string">&#x27;狄仁杰&#x27;</span>, <span class="number">17799990018</span>, <span class="string">&#x27;jujiamlm8166u@163.com&#x27;</span>, <span class="string">&#x27;国际贸易&#x27;</span>, <span class="number">30</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;2007-03-12 00:00:00&#x27;</span>),</span><br><span class="line">       (<span class="string">&#x27;安琪拉&#x27;</span>, <span class="number">17799990019</span>, <span class="string">&#x27;jdodm1h@126.com&#x27;</span>, <span class="string">&#x27;城市规划&#x27;</span>, <span class="number">51</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;2001-08-15 00:00:00&#x27;</span>),</span><br><span class="line">       (<span class="string">&#x27;典韦&#x27;</span>, <span class="number">17799990020</span>, <span class="string">&#x27;ycaunanjian@163.com&#x27;</span>, <span class="string">&#x27;城市规划&#x27;</span>, <span class="number">52</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;2000-04-12 00:00:00&#x27;</span>),</span><br><span class="line">       (<span class="string">&#x27;廉颇&#x27;</span>, <span class="number">17799990021</span>, <span class="string">&#x27;lianpo321@126.com&#x27;</span>, <span class="string">&#x27;土木工程&#x27;</span>, <span class="number">19</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;2002-07-18 00:00:00&#x27;</span>),</span><br><span class="line">       (<span class="string">&#x27;后裔&#x27;</span>, <span class="number">17799990022</span>, <span class="string">&#x27;altycj2000@139.com&#x27;</span>, <span class="string">&#x27;城市园林&#x27;</span>, <span class="number">20</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;2002-03-10 00:00:00&#x27;</span>),</span><br><span class="line">       (<span class="string">&#x27;姜子牙&#x27;</span>, <span class="number">17799990023</span>, <span class="string">&#x27;37483844@qq.com&#x27;</span>, <span class="string">&#x27;工程造价&#x27;</span>, <span class="number">29</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;2003-05-26 00:00:00&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--  查看当前已经存在的索引</span></span><br><span class="line"><span class="keyword">SHOW</span> INDEX <span class="keyword">FROM</span> tb_user;</span><br><span class="line"><span class="comment">-- tb_user,0,PRIMARY,1,id,A,24,,,&quot;&quot;,BTREE,&quot;&quot;,&quot;&quot;,YES,</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 1. 为 name 字段创建索引</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_user_name <span class="keyword">ON</span> tb_user (name);</span><br><span class="line"><span class="comment">-- tb_user,0,PRIMARY,1,id,A,24,,,&quot;&quot;,BTREE,&quot;&quot;,&quot;&quot;,YES,</span></span><br><span class="line"><span class="comment">-- tb_user,1,idx_user_name,1,name,A,24,,,YES,BTREE,&quot;&quot;,&quot;&quot;,YES,</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. 为 phone 创建索引</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> INDEX idx_user_phone <span class="keyword">ON</span> tb_user (phone);</span><br><span class="line"><span class="comment">-- tb_user,0,PRIMARY,1,id,A,24,,,&quot;&quot;,BTREE,&quot;&quot;,&quot;&quot;,YES,</span></span><br><span class="line"><span class="comment">-- tb_user,0,idx_user_phone,1,phone,A,24,,,YES,BTREE,&quot;&quot;,&quot;&quot;,YES,</span></span><br><span class="line"><span class="comment">-- tb_user,1,idx_user_name,1,name,A,24,,,YES,BTREE,&quot;&quot;,&quot;&quot;,YES,</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3. 为 profession、age、status 创建索引</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_user_profession_age_status <span class="keyword">ON</span> tb_user (profession, age, status);</span><br><span class="line"><span class="comment">-- tb_user,0,PRIMARY,1,id,A,24,,,&quot;&quot;,BTREE,&quot;&quot;,&quot;&quot;,YES,</span></span><br><span class="line"><span class="comment">-- tb_user,0,idx_user_phone,1,phone,A,24,,,YES,BTREE,&quot;&quot;,&quot;&quot;,YES,</span></span><br><span class="line"><span class="comment">-- tb_user,1,idx_user_name,1,name,A,24,,,YES,BTREE,&quot;&quot;,&quot;&quot;,YES,</span></span><br><span class="line"><span class="comment">-- tb_user,1,idx_user_profession_age_status,1,profession,A,16,,,YES,BTREE,&quot;&quot;,&quot;&quot;,YES,</span></span><br><span class="line"><span class="comment">-- tb_user,1,idx_user_profession_age_status,2,age,A,22,,,YES,BTREE,&quot;&quot;,&quot;&quot;,YES,</span></span><br><span class="line"><span class="comment">-- tb_user,1,idx_user_profession_age_status,3,status,A,24,,,YES,BTREE,&quot;&quot;,&quot;&quot;,YES,</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 4. 为 email 创建索引</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_user_email <span class="keyword">ON</span> tb_user (email);</span><br><span class="line"><span class="comment">-- tb_user,0,PRIMARY,1,id,A,24,,,&quot;&quot;,BTREE,&quot;&quot;,&quot;&quot;,YES,</span></span><br><span class="line"><span class="comment">-- tb_user,0,idx_user_phone,1,phone,A,24,,,YES,BTREE,&quot;&quot;,&quot;&quot;,YES,</span></span><br><span class="line"><span class="comment">-- tb_user,1,idx_user_name,1,name,A,24,,,YES,BTREE,&quot;&quot;,&quot;&quot;,YES,</span></span><br><span class="line"><span class="comment">-- tb_user,1,idx_user_profession_age_status,1,profession,A,16,,,YES,BTREE,&quot;&quot;,&quot;&quot;,YES,</span></span><br><span class="line"><span class="comment">-- tb_user,1,idx_user_profession_age_status,2,age,A,22,,,YES,BTREE,&quot;&quot;,&quot;&quot;,YES,</span></span><br><span class="line"><span class="comment">-- tb_user,1,idx_user_profession_age_status,3,status,A,24,,,YES,BTREE,&quot;&quot;,&quot;&quot;,YES,</span></span><br><span class="line"><span class="comment">-- tb_user,1,idx_user_email,1,email,A,24,,,YES,BTREE,&quot;&quot;,&quot;&quot;,YES,</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 5. 删除 email 索引</span></span><br><span class="line"><span class="keyword">DROP</span> INDEX idx_user_email <span class="keyword">ON</span> tb_user;</span><br><span class="line"><span class="comment">-- tb_user,0,PRIMARY,1,id,A,24,,,&quot;&quot;,BTREE,&quot;&quot;,&quot;&quot;,YES,</span></span><br><span class="line"><span class="comment">-- tb_user,0,idx_user_phone,1,phone,A,24,,,YES,BTREE,&quot;&quot;,&quot;&quot;,YES,</span></span><br><span class="line"><span class="comment">-- tb_user,1,idx_user_name,1,name,A,24,,,YES,BTREE,&quot;&quot;,&quot;&quot;,YES,</span></span><br><span class="line"><span class="comment">-- tb_user,1,idx_user_profession_age_status,1,profession,A,16,,,YES,BTREE,&quot;&quot;,&quot;&quot;,YES,</span></span><br><span class="line"><span class="comment">-- tb_user,1,idx_user_profession_age_status,2,age,A,22,,,YES,BTREE,&quot;&quot;,&quot;&quot;,YES,</span></span><br><span class="line"><span class="comment">-- tb_user,1,idx_user_profession_age_status,3,status,A,24,,,YES,BTREE,&quot;&quot;,&quot;&quot;,YES,</span></span><br></pre></td></tr></table></figure>

<h2 id="SQL-性能分析"><a href="#SQL-性能分析" class="headerlink" title="SQL 性能分析"></a>SQL 性能分析</h2><p>SQL 性能分析，是指通过分析 SQL 语句，了解 SQL 语句在数据库中的执行情况，从而了解 SQL 语句的效率。然后根据分析结果，对 SQL 语句进行优化。</p>
<h3 id="SQL-执行频率"><a href="#SQL-执行频率" class="headerlink" title="SQL 执行频率"></a>SQL 执行频率</h3><blockquote>
<p>SHOW [SESSION|GLOBAL] STATUS LIKE ‘Com______’;</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询 SQL 执行频率</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;Com_______&#x27;</span>;</span><br><span class="line"><span class="comment">-- Com_binlog,0</span></span><br><span class="line"><span class="comment">-- Com_commit,0</span></span><br><span class="line"><span class="comment">-- Com_delete,0</span></span><br><span class="line"><span class="comment">-- Com_import,0</span></span><br><span class="line"><span class="comment">-- Com_insert,1</span></span><br><span class="line"><span class="comment">-- Com_repair,0</span></span><br><span class="line"><span class="comment">-- Com_revoke,0</span></span><br><span class="line"><span class="comment">-- Com_select,390</span></span><br><span class="line"><span class="comment">-- Com_signal,0</span></span><br><span class="line"><span class="comment">-- Com_update,0</span></span><br><span class="line"><span class="comment">-- Com_xa_end,0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_user;</span><br><span class="line"><span class="comment">-- Com_select 对应的 Value 值加 1</span></span><br></pre></td></tr></table></figure>

<h3 id="慢查询日志"><a href="#慢查询日志" class="headerlink" title="慢查询日志"></a>慢查询日志</h3><p>在慢查询日志中，记录了所有执行时间超过了执行阈值的 SQL 查询语句</p>
<ol>
<li><p>查看慢查询日志开关状态</p>
<blockquote>
<p>SHOW VARIABLES LIKE ‘slow_query_log’;</p>
</blockquote>
</li>
<li><p>开启慢查询日志(临时)</p>
<blockquote>
<p>SET [SESSOPM|GLOBAL] slow_query_log &#x3D; ON;</p>
</blockquote>
</li>
<li><p>开启慢查询日志(持久)</p>
<blockquote>
<p>修改配置文件 <code>/etc/my.cnf</code> 或者 <code>/etc/mysql/my.cnf</code>，添加参数：<code>slow_query_log=1</code> 和 <code>long_query_time=2</code>，然后重启 MySQL 服务器</p>
</blockquote>
</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 睡眠 5 秒，模拟慢查询</span></span><br><span class="line"><span class="keyword">SELECT</span> SLEEP(<span class="number">5</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看慢查询日志文件所在位置</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;%slow_query_log%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------+-------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name       <span class="operator">|</span> <span class="keyword">Value</span>                                           <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------+-------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> slow_query_log      <span class="operator">|</span> <span class="keyword">ON</span>                                              <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> slow_query_log_file <span class="operator">|</span> <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>iZ2zeckoeb761cyuvcssaqZ<span class="operator">-</span>slow.log <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------+-------------------------------------------------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看慢查询日志</span></span><br><span class="line">root@iZ2zeckoeb761cyuvcssaqZ:~# cat /var/lib/mysql/iZ2zeckoeb761cyuvcssaqZ-slow.log</span><br><span class="line">/usr/sbin/mysqld, Version: 8.0.43-0ubuntu0.24.04.2 ((Ubuntu)). started with:</span><br><span class="line">Tcp port: 3306  Unix socket: /var/run/mysqld/mysqld.sock</span><br><span class="line">Time                 Id Command    Argument</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Time: 2025-11-17T15:26:44.091252Z</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">User@Host: root[root] @ localhost []  Id:    20</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Query_time: 5.001319  Lock_time: 0.000000 Rows_sent: 1  Rows_examined: 1</span></span><br><span class="line"></span><br><span class="line">SET timestamp=1763393199;</span><br><span class="line">SELECT SLEEP(5);</span><br></pre></td></tr></table></figure>

<h3 id="profile-详情"><a href="#profile-详情" class="headerlink" title="profile 详情"></a>profile 详情</h3><p>虽然慢查询日志可以查看慢查询日志，但是如果一些查询语句明明很简单，但是却执行时间过长且没有达到慢日志的阈值，那么慢查询日志就无法查看到这些查询语句。</p>
<ol>
<li><p>查看当前数据库是否支持 profile</p>
<blockquote>
<p>SELECT @@have_profiling;</p>
</blockquote>
</li>
<li><p>查看 profile 是否开启</p>
<blockquote>
<p>SELECT @@profiling;</p>
</blockquote>
</li>
<li><p>开启 profile</p>
<blockquote>
<p>SET profiling &#x3D; 1;</p>
</blockquote>
</li>
<li><p>查看 profile 详情</p>
<blockquote>
<p>SHOW PROFILES;</p>
</blockquote>
</li>
<li><p>查看指定 profile 详情</p>
<blockquote>
<p>SHOW PROFILE FOR QUERY [QUEUE_ID];</p>
</blockquote>
</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> @<span class="variable">@have_profiling</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+</span></span><br><span class="line"><span class="operator">|</span> @<span class="variable">@have_profiling</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+</span></span><br><span class="line"><span class="operator">|</span> YES              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> @<span class="variable">@profiling</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+</span></span><br><span class="line"><span class="operator">|</span> @<span class="variable">@profiling</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+</span></span><br><span class="line"><span class="operator">|</span>           <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SET</span> profiling <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> @<span class="variable">@profiling</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+</span></span><br><span class="line"><span class="operator">|</span> @<span class="variable">@profiling</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+</span></span><br><span class="line"><span class="operator">|</span>           <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看 profile 详情</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> tb_user;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------+</span></span><br><span class="line"><span class="operator">|</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">219042</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.06</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> PROFILES;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------+------------+------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> Query_ID <span class="operator">|</span> Duration   <span class="operator">|</span> Query                              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+------------+------------------------------------+</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">1</span> <span class="operator">|</span> <span class="number">0.00085300</span> <span class="operator">|</span> <span class="keyword">SELECT</span> @<span class="variable">@profiling</span>                 <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">2</span> <span class="operator">|</span> <span class="number">0.00087800</span> <span class="operator">|</span> <span class="keyword">SHOW</span> PROFILE <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_user <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">3</span> <span class="operator">|</span> <span class="number">0.00021200</span> <span class="operator">|</span> <span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> tb_user       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">4</span> <span class="operator">|</span> <span class="number">0.00037775</span> <span class="operator">|</span> <span class="keyword">SELECT</span> DATABASE()                  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">5</span> <span class="operator">|</span> <span class="number">0.00246550</span> <span class="operator">|</span> <span class="keyword">show</span> databases                     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">6</span> <span class="operator">|</span> <span class="number">0.00458425</span> <span class="operator">|</span> <span class="keyword">show</span> tables                        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">7</span> <span class="operator">|</span> <span class="number">0.05751475</span> <span class="operator">|</span> <span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> tb_user       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+------------+------------------------------------+</span></span><br><span class="line"><span class="number">7</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看指定 SQL 详情</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> PROFILE <span class="keyword">FOR</span> QUERY <span class="number">7</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------+----------+</span></span><br><span class="line"><span class="operator">|</span> Status                         <span class="operator">|</span> Duration <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------+----------+</span></span><br><span class="line"><span class="operator">|</span> starting                       <span class="operator">|</span> <span class="number">0.000165</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Executing hook <span class="keyword">on</span> transaction  <span class="operator">|</span> <span class="number">0.000011</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> starting                       <span class="operator">|</span> <span class="number">0.000016</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> checking permissions           <span class="operator">|</span> <span class="number">0.000015</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Opening tables                 <span class="operator">|</span> <span class="number">0.000374</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> init                           <span class="operator">|</span> <span class="number">0.000037</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">System</span> lock                    <span class="operator">|</span> <span class="number">0.000011</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> optimizing                     <span class="operator">|</span> <span class="number">0.000006</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> statistics                     <span class="operator">|</span> <span class="number">0.000017</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> preparing                      <span class="operator">|</span> <span class="number">0.000176</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> executing                      <span class="operator">|</span> <span class="number">0.056476</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">end</span>                            <span class="operator">|</span> <span class="number">0.000017</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> query <span class="keyword">end</span>                      <span class="operator">|</span> <span class="number">0.000005</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> waiting <span class="keyword">for</span> handler <span class="keyword">commit</span>     <span class="operator">|</span> <span class="number">0.000010</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> closing tables                 <span class="operator">|</span> <span class="number">0.000009</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> freeing items                  <span class="operator">|</span> <span class="number">0.000112</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> cleaning up                    <span class="operator">|</span> <span class="number">0.000061</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------+----------+</span></span><br><span class="line"><span class="number">17</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h3 id="性能分析-explain"><a href="#性能分析-explain" class="headerlink" title="性能分析 explain"></a>性能分析 explain</h3><p>explain 命令可以查看 SQL 语句的执行计划，根据执行计划可以判断 SQL 语句的性能</p>
<blockquote>
<p>EXPLAIN 查询语句;</p>
</blockquote>
<p>查询结果</p>
<ul>
<li>id：SQL 语句中 SELECT 语句或者操作表的顺序，id 越大越先执行，大小一样，从上到下依次执行</li>
<li>select_type：SQL 语句的类型，常见的有：SIMPLE：简单查询，PRIMARY：主查询，SUBQUERY：子查询等</li>
<li>type：执行计划类型，常见的有：null：没有执行计划，system：系统表，const：常量，eq_ref：等值引用，ref：引用，range：范围，index：索引，ALL：表示全表扫描，性能依次递减</li>
<li>possible_keys：可能使用的索引</li>
<li>key：实际使用的索引</li>
<li>key_len：索引长度，字节数，字节数越小，索引性能越好</li>
<li>rows：预估返回的行数，不是实际返回的行数</li>
<li>filtered：过滤的百分比，预估返回的行数 &#x2F; 实际返回的行数，100% 表示性能最佳</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_user <span class="keyword">WHERE</span> profession <span class="operator">=</span> (<span class="keyword">SELECT</span> profession <span class="keyword">FROM</span> tb_user <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;吕布&#x27;</span>);</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+--------------------------------+--------------------------------+---------+-------+------+----------+-------------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> select_type <span class="operator">|</span> <span class="keyword">table</span>   <span class="operator">|</span> partitions <span class="operator">|</span> type <span class="operator">|</span> possible_keys                  <span class="operator">|</span> key                            <span class="operator">|</span> key_len <span class="operator">|</span> <span class="keyword">ref</span>   <span class="operator">|</span> <span class="keyword">rows</span> <span class="operator">|</span> filtered <span class="operator">|</span> Extra       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+--------------------------------+--------------------------------+---------+-------+------+----------+-------------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> <span class="keyword">PRIMARY</span>     <span class="operator">|</span> tb_user <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span> <span class="keyword">ref</span>  <span class="operator">|</span> idx_user_profession_age_status <span class="operator">|</span> idx_user_profession_age_status <span class="operator">|</span> <span class="number">67</span>      <span class="operator">|</span> const <span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span>   <span class="number">100.00</span> <span class="operator">|</span> <span class="keyword">Using</span> <span class="keyword">where</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> SUBQUERY    <span class="operator">|</span> tb_user <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span> <span class="keyword">ref</span>  <span class="operator">|</span> idx_user_name                  <span class="operator">|</span> idx_user_name                  <span class="operator">|</span> <span class="number">67</span>      <span class="operator">|</span> const <span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span>   <span class="number">100.00</span> <span class="operator">|</span> <span class="keyword">NULL</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+--------------------------------+--------------------------------+---------+-------+------+----------+-------------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h3 id="性能分析总结"><a href="#性能分析总结" class="headerlink" title="性能分析总结"></a>性能分析总结</h3><ol>
<li>查看 SQL 语句的执行频次：<code>SHOW [SESSION|GLOBAL] STATUS LIKE &#39;Com______&#39;;</code></li>
<li>查看慢查询日志：<code>SHOW VARIABLES LIKE &#39;%slow_query_log%&#39;;</code>、<code>cat /var/log/mysql/mysql-slow.log</code></li>
<li>查看 Profile 详情：<code>SHOW PROFILES;</code>、<code>SHOW PROFILE FOR QUERY [QUEUE_ID];</code></li>
<li>查看 SQL 语句的执行计划：<code>EXPLAIN 查询语句;</code></li>
</ol>
<h2 id="使用索引"><a href="#使用索引" class="headerlink" title="使用索引"></a>使用索引</h2><h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建存储过程</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> auto_insert()</span><br><span class="line"><span class="comment">-- 循环插入 100 万条数据</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> i <span class="type">INT</span>;</span><br><span class="line">    <span class="keyword">DECLARE</span> num <span class="type">INT</span>;</span><br><span class="line">    <span class="keyword">SET</span> i <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    WHILE i <span class="operator">&lt;</span> <span class="number">10000000</span></span><br><span class="line">        DO</span><br><span class="line">            <span class="keyword">SET</span> num <span class="operator">=</span> RAND();</span><br><span class="line">            <span class="keyword">INSERT INTO</span> tb_user(name, phone, email, profession, age, gender, status, create_time)</span><br><span class="line">            <span class="keyword">VALUES</span> (CONCAT(<span class="string">&#x27;name&#x27;</span>, LPAD(i, <span class="number">8</span>, <span class="string">&#x27;0&#x27;</span>)),</span><br><span class="line">                    CONCAT(<span class="string">&#x27;138&#x27;</span>, LPAD(i, <span class="number">8</span>, <span class="string">&#x27;0&#x27;</span>)),</span><br><span class="line">                    CONCAT(<span class="string">&#x27;name&#x27;</span>, LPAD(i, <span class="number">8</span>, <span class="string">&#x27;0&#x27;</span>), <span class="string">&#x27;@163.com&#x27;</span>),</span><br><span class="line">                    <span class="keyword">CASE</span></span><br><span class="line">                        <span class="keyword">WHEN</span> num <span class="keyword">BETWEEN</span> <span class="number">0.0</span> <span class="keyword">AND</span> <span class="number">0.1</span> <span class="keyword">THEN</span> <span class="string">&#x27;软件工程&#x27;</span></span><br><span class="line">                        <span class="keyword">WHEN</span> num <span class="keyword">BETWEEN</span> <span class="number">0.1</span> <span class="keyword">AND</span> <span class="number">0.2</span> <span class="keyword">THEN</span> <span class="string">&#x27;英语&#x27;</span></span><br><span class="line">                        <span class="keyword">WHEN</span> num <span class="keyword">BETWEEN</span> <span class="number">0.2</span> <span class="keyword">AND</span> <span class="number">0.3</span> <span class="keyword">THEN</span> <span class="string">&#x27;通讯工程&#x27;</span></span><br><span class="line">                        <span class="keyword">WHEN</span> num <span class="keyword">BETWEEN</span> <span class="number">0.3</span> <span class="keyword">AND</span> <span class="number">0.4</span> <span class="keyword">THEN</span> <span class="string">&#x27;工程造价&#x27;</span></span><br><span class="line">                        <span class="keyword">WHEN</span> num <span class="keyword">BETWEEN</span> <span class="number">0.4</span> <span class="keyword">AND</span> <span class="number">0.5</span> <span class="keyword">THEN</span> <span class="string">&#x27;舞蹈&#x27;</span></span><br><span class="line">                        <span class="keyword">WHEN</span> num <span class="keyword">BETWEEN</span> <span class="number">0.5</span> <span class="keyword">AND</span> <span class="number">0.6</span> <span class="keyword">THEN</span> <span class="string">&#x27;应用数学&#x27;</span></span><br><span class="line">                        <span class="keyword">WHEN</span> num <span class="keyword">BETWEEN</span> <span class="number">0.6</span> <span class="keyword">AND</span> <span class="number">0.7</span> <span class="keyword">THEN</span> <span class="string">&#x27;化工&#x27;</span></span><br><span class="line">                        <span class="keyword">WHEN</span> num <span class="keyword">BETWEEN</span> <span class="number">0.7</span> <span class="keyword">AND</span> <span class="number">0.8</span> <span class="keyword">THEN</span> <span class="string">&#x27;金属材料&#x27;</span></span><br><span class="line">                        <span class="keyword">WHEN</span> num <span class="keyword">BETWEEN</span> <span class="number">0.8</span> <span class="keyword">AND</span> <span class="number">0.9</span> <span class="keyword">THEN</span> <span class="string">&#x27;机械工程及其自动化&#x27;</span></span><br><span class="line">                        <span class="keyword">WHEN</span> num <span class="keyword">BETWEEN</span> <span class="number">0.9</span> <span class="keyword">AND</span> <span class="number">1.0</span> <span class="keyword">THEN</span> <span class="string">&#x27;无机非金属材料工程&#x27;</span></span><br><span class="line">                        <span class="keyword">ELSE</span> <span class="string">&#x27;会计&#x27;</span> <span class="keyword">END</span>,</span><br><span class="line">                    i <span class="operator">%</span> <span class="number">80</span> <span class="operator">+</span> <span class="number">1</span>,</span><br><span class="line">                    IF(num <span class="operator">&gt;</span> <span class="number">0.5</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>), <span class="built_in">MOD</span>(i, <span class="number">10</span>), DATE_ADD(<span class="built_in">CURRENT_TIME</span>, <span class="type">INTERVAL</span> i <span class="keyword">DAY</span>));</span><br><span class="line">            <span class="keyword">SET</span> i <span class="operator">=</span> i <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">end</span> while;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> auto_insert();</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用主键索引查询</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_user <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">5800000</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------+--------------+-------------+----------------------+--------------+------+--------+--------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id      <span class="operator">|</span> name         <span class="operator">|</span> phone       <span class="operator">|</span> email                <span class="operator">|</span> profession   <span class="operator">|</span> age  <span class="operator">|</span> gender <span class="operator">|</span> status <span class="operator">|</span> create_time         <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+--------------+-------------+----------------------+--------------+------+--------+--------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">5800000</span> <span class="operator">|</span> name02887515 <span class="operator">|</span> <span class="number">13802887515</span> <span class="operator">|</span> name02887515<span class="variable">@163</span>.com <span class="operator">|</span> 软件工程     <span class="operator">|</span>   <span class="number">76</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">5</span>      <span class="operator">|</span> <span class="number">9931</span><span class="number">-08</span><span class="number">-20</span> <span class="number">12</span>:<span class="number">41</span>:<span class="number">33</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+--------------+-------------+----------------------+--------------+------+--------+--------+---------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 无索引查询，花费了5.27秒</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_user <span class="keyword">WHERE</span> name <span class="operator">=</span>  <span class="string">&#x27;name02887515&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------+--------------+-------------+----------------------+-----------------------------+------+--------+--------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id      <span class="operator">|</span> name         <span class="operator">|</span> phone       <span class="operator">|</span> email                <span class="operator">|</span> profession                  <span class="operator">|</span> age  <span class="operator">|</span> gender <span class="operator">|</span> status <span class="operator">|</span> create_time         <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+--------------+-------------+----------------------+-----------------------------+------+--------+--------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2887515</span> <span class="operator">|</span> name02887515 <span class="operator">|</span> <span class="number">13802887515</span> <span class="operator">|</span> name02887515<span class="variable">@163</span>.com <span class="operator">|</span> 无机非金属材料工程          <span class="operator">|</span>   <span class="number">76</span> <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">5</span>      <span class="operator">|</span> <span class="number">9931</span><span class="number">-08</span><span class="number">-20</span> <span class="number">02</span>:<span class="number">42</span>:<span class="number">48</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">5800000</span> <span class="operator">|</span> name02887515 <span class="operator">|</span> <span class="number">13802887515</span> <span class="operator">|</span> name02887515<span class="variable">@163</span>.com <span class="operator">|</span> 软件工程                    <span class="operator">|</span>   <span class="number">76</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">5</span>      <span class="operator">|</span> <span class="number">9931</span><span class="number">-08</span><span class="number">-20</span> <span class="number">12</span>:<span class="number">41</span>:<span class="number">33</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+--------------+-------------+----------------------+-----------------------------+------+--------+--------+---------------------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">5.27</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 给 name 列创建索引，此时会给 name 列创建一个 B+树 索引，非常耗时</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">CREATE</span> INDEX idx_name <span class="keyword">ON</span> tb_user(name);</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">41.71</span> sec)</span><br><span class="line">Records: <span class="number">0</span>  Duplicates: <span class="number">0</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建索引后，查询耗时变成了 0.00 秒</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_user <span class="keyword">WHERE</span> name <span class="operator">=</span>  <span class="string">&#x27;name02887515&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------+--------------+-------------+----------------------+-----------------------------+------+--------+--------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id      <span class="operator">|</span> name         <span class="operator">|</span> phone       <span class="operator">|</span> email                <span class="operator">|</span> profession                  <span class="operator">|</span> age  <span class="operator">|</span> gender <span class="operator">|</span> status <span class="operator">|</span> create_time         <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+--------------+-------------+----------------------+-----------------------------+------+--------+--------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2887515</span> <span class="operator">|</span> name02887515 <span class="operator">|</span> <span class="number">13802887515</span> <span class="operator">|</span> name02887515<span class="variable">@163</span>.com <span class="operator">|</span> 无机非金属材料工程          <span class="operator">|</span>   <span class="number">76</span> <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">5</span>      <span class="operator">|</span> <span class="number">9931</span><span class="number">-08</span><span class="number">-20</span> <span class="number">02</span>:<span class="number">42</span>:<span class="number">48</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">5800000</span> <span class="operator">|</span> name02887515 <span class="operator">|</span> <span class="number">13802887515</span> <span class="operator">|</span> name02887515<span class="variable">@163</span>.com <span class="operator">|</span> 软件工程                    <span class="operator">|</span>   <span class="number">76</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">5</span>      <span class="operator">|</span> <span class="number">9931</span><span class="number">-08</span><span class="number">-20</span> <span class="number">12</span>:<span class="number">41</span>:<span class="number">33</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+--------------+-------------+----------------------+-----------------------------+------+--------+--------+---------------------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用 explain 查看执行计划，可以看到使用了 idx_name 索引</span></span><br><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_user <span class="keyword">WHERE</span> name <span class="operator">=</span>  <span class="string">&#x27;name02887515&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+---------------+----------+---------+-------+------+----------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> select_type <span class="operator">|</span> <span class="keyword">table</span>   <span class="operator">|</span> partitions <span class="operator">|</span> type <span class="operator">|</span> possible_keys <span class="operator">|</span> key      <span class="operator">|</span> key_len <span class="operator">|</span> <span class="keyword">ref</span>   <span class="operator">|</span> <span class="keyword">rows</span> <span class="operator">|</span> filtered <span class="operator">|</span> Extra <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+---------------+----------+---------+-------+------+----------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> SIMPLE      <span class="operator">|</span> tb_user <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span> <span class="keyword">ref</span>  <span class="operator">|</span> idx_name      <span class="operator">|</span> idx_name <span class="operator">|</span> <span class="number">67</span>      <span class="operator">|</span> const <span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span>   <span class="number">100.00</span> <span class="operator">|</span> <span class="keyword">NULL</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+---------------+----------+---------+-------+------+----------+-------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h3 id="最左前缀法则"><a href="#最左前缀法则" class="headerlink" title="最左前缀法则"></a>最左前缀法则</h3><p>如果一个索引是由多个列组成的复合索引，那么在查询中，若想使用该索引，则必须满足最左前缀法则，即索引中最左侧的列必须存在。</p>
<ol>
<li>若索引中最左侧的列不存在，则该索引失效。</li>
<li>若索引中最左侧的列存在，但后续列不存在，则该索引及后续索引均失效。</li>
</ol>
<p>举例：若存在索引（A, B, C, D）</p>
<ol>
<li>(A, B, C, D) 存在，使用该索引</li>
<li>(A, B, C) 存在，使用该索引</li>
<li>(A, B) 存在，使用该索引</li>
<li>(A) 存在，使用该索引</li>
<li>(B, C, D) 存在，但是没有 A ，不满足最左前缀法则，索引失效</li>
<li>(A, C, D) 存在，虽然索引中存在 A ，但跳过了 B，因此只有 A 索引有效，同 (A) 一致</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_user;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------------+------------------------+-----------------------------+------+--------+--------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name      <span class="operator">|</span> phone       <span class="operator">|</span> email                  <span class="operator">|</span> profession                  <span class="operator">|</span> age  <span class="operator">|</span> gender <span class="operator">|</span> status <span class="operator">|</span> create_time         <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------------+------------------------+-----------------------------+------+--------+--------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> 吕布      <span class="operator">|</span> <span class="number">17799990000</span> <span class="operator">|</span> lvbu666<span class="variable">@163</span>.com        <span class="operator">|</span> 软件工程                    <span class="operator">|</span>   <span class="number">23</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">6</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-02</span><span class="number">-02</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> 曹操      <span class="operator">|</span> <span class="number">17799990001</span> <span class="operator">|</span> caocao666<span class="variable">@qq</span>.com       <span class="operator">|</span> 通讯工程                    <span class="operator">|</span>   <span class="number">33</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-03</span><span class="number">-05</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> 赵云      <span class="operator">|</span> <span class="number">17799990002</span> <span class="operator">|</span> <span class="number">17799990</span><span class="variable">@139</span>.com       <span class="operator">|</span> 英语                        <span class="operator">|</span>   <span class="number">34</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">2002</span><span class="number">-03</span><span class="number">-02</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> 孙悟空    <span class="operator">|</span> <span class="number">17799990003</span> <span class="operator">|</span> <span class="number">17799990</span><span class="variable">@sina</span>.com      <span class="operator">|</span> 工程造价                    <span class="operator">|</span>   <span class="number">54</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-07</span><span class="number">-02</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> 花木兰    <span class="operator">|</span> <span class="number">17799990004</span> <span class="operator">|</span> <span class="number">19980729</span><span class="variable">@sina</span>.com      <span class="operator">|</span> 软件工程                    <span class="operator">|</span>   <span class="number">23</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-04</span><span class="number">-22</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">6</span> <span class="operator">|</span> 大桥      <span class="operator">|</span> <span class="number">17799990005</span> <span class="operator">|</span> daqiao666<span class="variable">@sina</span>.com     <span class="operator">|</span> 舞蹈                        <span class="operator">|</span>   <span class="number">22</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-02</span><span class="number">-07</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">7</span> <span class="operator">|</span> 露娜      <span class="operator">|</span> <span class="number">17799990006</span> <span class="operator">|</span> luna_love<span class="variable">@sina</span>.com     <span class="operator">|</span> 应用数学                    <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-02</span><span class="number">-08</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">8</span> <span class="operator">|</span> 程咬金    <span class="operator">|</span> <span class="number">17799990007</span> <span class="operator">|</span> chengyaojin<span class="variable">@163</span>.com    <span class="operator">|</span> 化工                        <span class="operator">|</span>   <span class="number">38</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">5</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-05</span><span class="number">-23</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">9</span> <span class="operator">|</span> 项羽      <span class="operator">|</span> <span class="number">17799990008</span> <span class="operator">|</span> xiaoyu666<span class="variable">@qq</span>.com       <span class="operator">|</span> 金属材料                    <span class="operator">|</span>   <span class="number">43</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-09</span><span class="number">-18</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">10</span> <span class="operator">|</span> 白起      <span class="operator">|</span> <span class="number">17799990009</span> <span class="operator">|</span> baiqi666<span class="variable">@sina</span>.com      <span class="operator">|</span> 机械工程及其自动化          <span class="operator">|</span>   <span class="number">27</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-08</span><span class="number">-16</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">11</span> <span class="operator">|</span> 韩信      <span class="operator">|</span> <span class="number">17799990010</span> <span class="operator">|</span> hanxin520<span class="variable">@163</span>.com      <span class="operator">|</span> 无机非金属材料工程          <span class="operator">|</span>   <span class="number">27</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-06</span><span class="number">-12</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">12</span> <span class="operator">|</span> 荆轲      <span class="operator">|</span> <span class="number">17799990011</span> <span class="operator">|</span> jingke123<span class="variable">@163</span>.com      <span class="operator">|</span> 会计                        <span class="operator">|</span>   <span class="number">29</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-05</span><span class="number">-11</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">13</span> <span class="operator">|</span> 兰陵王    <span class="operator">|</span> <span class="number">17799990012</span> <span class="operator">|</span> lanlingwang666<span class="variable">@126</span>.com <span class="operator">|</span> 工程造价                    <span class="operator">|</span>   <span class="number">44</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-04</span><span class="number">-09</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">14</span> <span class="operator">|</span> 狂铁      <span class="operator">|</span> <span class="number">17799990013</span> <span class="operator">|</span> kuangtie<span class="variable">@sina</span>.com      <span class="operator">|</span> 应用数学                    <span class="operator">|</span>   <span class="number">43</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-04</span><span class="number">-10</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">15</span> <span class="operator">|</span> 貂蝉      <span class="operator">|</span> <span class="number">17799990014</span> <span class="operator">|</span> <span class="number">84958948374</span><span class="variable">@qq</span>.com     <span class="operator">|</span> 软件工程                    <span class="operator">|</span>   <span class="number">40</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">3</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-02</span><span class="number">-12</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">16</span> <span class="operator">|</span> 妲己      <span class="operator">|</span> <span class="number">17799990015</span> <span class="operator">|</span> <span class="number">2783238293</span><span class="variable">@qq</span>.com      <span class="operator">|</span> 软件工程                    <span class="operator">|</span>   <span class="number">31</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-01</span><span class="number">-30</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">17</span> <span class="operator">|</span> 芈月      <span class="operator">|</span> <span class="number">17799990016</span> <span class="operator">|</span> xiaomi2001.com         <span class="operator">|</span> 工业经济                    <span class="operator">|</span>   <span class="number">35</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2000</span><span class="number">-05</span><span class="number">-03</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">18</span> <span class="operator">|</span> 嬴政      <span class="operator">|</span> <span class="number">17799990017</span> <span class="operator">|</span> <span class="number">8839434342</span><span class="variable">@qq</span>.com      <span class="operator">|</span> 化工                        <span class="operator">|</span>   <span class="number">38</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-08</span><span class="number">-08</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">19</span> <span class="operator">|</span> 狄仁杰    <span class="operator">|</span> <span class="number">17799990018</span> <span class="operator">|</span> jujiamlm8166u<span class="variable">@163</span>.com  <span class="operator">|</span> 国际贸易                    <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2007</span><span class="number">-03</span><span class="number">-12</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">20</span> <span class="operator">|</span> 安琪拉    <span class="operator">|</span> <span class="number">17799990019</span> <span class="operator">|</span> jdodm1h<span class="variable">@126</span>.com        <span class="operator">|</span> 城市规划                    <span class="operator">|</span>   <span class="number">51</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-08</span><span class="number">-15</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">21</span> <span class="operator">|</span> 典韦      <span class="operator">|</span> <span class="number">17799990020</span> <span class="operator">|</span> ycaunanjian<span class="variable">@163</span>.com    <span class="operator">|</span> 城市规划                    <span class="operator">|</span>   <span class="number">52</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">2000</span><span class="number">-04</span><span class="number">-12</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">22</span> <span class="operator">|</span> 廉颇      <span class="operator">|</span> <span class="number">17799990021</span> <span class="operator">|</span> lianpo321<span class="variable">@126</span>.com      <span class="operator">|</span> 土木工程                    <span class="operator">|</span>   <span class="number">19</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">3</span>      <span class="operator">|</span> <span class="number">2002</span><span class="number">-07</span><span class="number">-18</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">23</span> <span class="operator">|</span> 后裔      <span class="operator">|</span> <span class="number">17799990022</span> <span class="operator">|</span> altycj2000<span class="variable">@139</span>.com     <span class="operator">|</span> 城市园林                    <span class="operator">|</span>   <span class="number">20</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2002</span><span class="number">-03</span><span class="number">-10</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">24</span> <span class="operator">|</span> 姜子牙    <span class="operator">|</span> <span class="number">17799990023</span> <span class="operator">|</span> <span class="number">37483844</span><span class="variable">@qq</span>.com        <span class="operator">|</span> 工程造价                    <span class="operator">|</span>   <span class="number">29</span> <span class="operator">|</span> <span class="number">1</span>      <span class="operator">|</span> <span class="number">4</span>      <span class="operator">|</span> <span class="number">2003</span><span class="number">-05</span><span class="number">-26</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------------+------------------------+-----------------------------+------+--------+--------+---------------------+</span></span><br><span class="line"><span class="number">24</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> INDEX <span class="keyword">FROM</span> tb_user;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------+------------+--------------------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">Table</span>   <span class="operator">|</span> Non_unique <span class="operator">|</span> Key_name                       <span class="operator">|</span> Seq_in_index <span class="operator">|</span> Column_name <span class="operator">|</span> <span class="keyword">Collation</span> <span class="operator">|</span> <span class="keyword">Cardinality</span> <span class="operator">|</span> Sub_part <span class="operator">|</span> Packed <span class="operator">|</span> <span class="keyword">Null</span> <span class="operator">|</span> Index_type <span class="operator">|</span> Comment <span class="operator">|</span> Index_comment <span class="operator">|</span> Visible <span class="operator">|</span> Expression <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+------------+--------------------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+</span></span><br><span class="line"><span class="operator">|</span> tb_user <span class="operator">|</span>          <span class="number">0</span> <span class="operator">|</span> <span class="keyword">PRIMARY</span>                        <span class="operator">|</span>            <span class="number">1</span> <span class="operator">|</span> id          <span class="operator">|</span> A         <span class="operator">|</span>          <span class="number">24</span> <span class="operator">|</span>     <span class="keyword">NULL</span> <span class="operator">|</span>   <span class="keyword">NULL</span> <span class="operator">|</span>      <span class="operator">|</span> BTREE      <span class="operator">|</span>         <span class="operator">|</span>               <span class="operator">|</span> YES     <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> tb_user <span class="operator">|</span>          <span class="number">0</span> <span class="operator">|</span> idx_user_phone                 <span class="operator">|</span>            <span class="number">1</span> <span class="operator">|</span> phone       <span class="operator">|</span> A         <span class="operator">|</span>          <span class="number">24</span> <span class="operator">|</span>     <span class="keyword">NULL</span> <span class="operator">|</span>   <span class="keyword">NULL</span> <span class="operator">|</span> YES  <span class="operator">|</span> BTREE      <span class="operator">|</span>         <span class="operator">|</span>               <span class="operator">|</span> YES     <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> tb_user <span class="operator">|</span>          <span class="number">1</span> <span class="operator">|</span> idx_user_name                  <span class="operator">|</span>            <span class="number">1</span> <span class="operator">|</span> name        <span class="operator">|</span> A         <span class="operator">|</span>          <span class="number">24</span> <span class="operator">|</span>     <span class="keyword">NULL</span> <span class="operator">|</span>   <span class="keyword">NULL</span> <span class="operator">|</span> YES  <span class="operator">|</span> BTREE      <span class="operator">|</span>         <span class="operator">|</span>               <span class="operator">|</span> YES     <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> tb_user <span class="operator">|</span>          <span class="number">1</span> <span class="operator">|</span> idx_user_profession_age_status <span class="operator">|</span>            <span class="number">1</span> <span class="operator">|</span> profession  <span class="operator">|</span> A         <span class="operator">|</span>          <span class="number">16</span> <span class="operator">|</span>     <span class="keyword">NULL</span> <span class="operator">|</span>   <span class="keyword">NULL</span> <span class="operator">|</span> YES  <span class="operator">|</span> BTREE      <span class="operator">|</span>         <span class="operator">|</span>               <span class="operator">|</span> YES     <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> tb_user <span class="operator">|</span>          <span class="number">1</span> <span class="operator">|</span> idx_user_profession_age_status <span class="operator">|</span>            <span class="number">2</span> <span class="operator">|</span> age         <span class="operator">|</span> A         <span class="operator">|</span>          <span class="number">22</span> <span class="operator">|</span>     <span class="keyword">NULL</span> <span class="operator">|</span>   <span class="keyword">NULL</span> <span class="operator">|</span> YES  <span class="operator">|</span> BTREE      <span class="operator">|</span>         <span class="operator">|</span>               <span class="operator">|</span> YES     <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> tb_user <span class="operator">|</span>          <span class="number">1</span> <span class="operator">|</span> idx_user_profession_age_status <span class="operator">|</span>            <span class="number">3</span> <span class="operator">|</span> status      <span class="operator">|</span> A         <span class="operator">|</span>          <span class="number">24</span> <span class="operator">|</span>     <span class="keyword">NULL</span> <span class="operator">|</span>   <span class="keyword">NULL</span> <span class="operator">|</span> YES  <span class="operator">|</span> BTREE      <span class="operator">|</span>         <span class="operator">|</span>               <span class="operator">|</span> YES     <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+------------+--------------------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+</span></span><br><span class="line"><span class="number">6</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_user <span class="keyword">WHERE</span> profession <span class="operator">=</span> <span class="string">&#x27;软件工程&#x27;</span> <span class="keyword">AND</span> age <span class="operator">=</span> <span class="number">31</span> <span class="keyword">AND</span> status <span class="operator">=</span> <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+-------------+-------------------+--------------+------+--------+--------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name   <span class="operator">|</span> phone       <span class="operator">|</span> email             <span class="operator">|</span> profession   <span class="operator">|</span> age  <span class="operator">|</span> gender <span class="operator">|</span> status <span class="operator">|</span> create_time         <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+-------------+-------------------+--------------+------+--------+--------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">16</span> <span class="operator">|</span> 妲己   <span class="operator">|</span> <span class="number">17799990015</span> <span class="operator">|</span> <span class="number">2783238293</span><span class="variable">@qq</span>.com <span class="operator">|</span> 软件工程     <span class="operator">|</span>   <span class="number">31</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-01</span><span class="number">-30</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+-------------+-------------------+--------------+------+--------+--------+---------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 索引中所有列均存在，使用了复合索引，索引长度为 77 字节</span></span><br><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_user <span class="keyword">WHERE</span> profession <span class="operator">=</span> <span class="string">&#x27;软件工程&#x27;</span> <span class="keyword">AND</span> age <span class="operator">=</span> <span class="number">31</span> <span class="keyword">AND</span> status <span class="operator">=</span> <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+--------------------------------+--------------------------------+---------+-------------------+------+----------+-----------------------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> select_type <span class="operator">|</span> <span class="keyword">table</span>   <span class="operator">|</span> partitions <span class="operator">|</span> type <span class="operator">|</span> possible_keys                  <span class="operator">|</span> key                            <span class="operator">|</span> key_len <span class="operator">|</span> <span class="keyword">ref</span>               <span class="operator">|</span> <span class="keyword">rows</span> <span class="operator">|</span> filtered <span class="operator">|</span> Extra                 <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+--------------------------------+--------------------------------+---------+-------------------+------+----------+-----------------------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> SIMPLE      <span class="operator">|</span> tb_user <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span> <span class="keyword">ref</span>  <span class="operator">|</span> idx_user_profession_age_status <span class="operator">|</span> idx_user_profession_age_status <span class="operator">|</span> <span class="number">77</span>      <span class="operator">|</span> const,const,const <span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span>   <span class="number">100.00</span> <span class="operator">|</span> <span class="keyword">Using</span> index <span class="keyword">condition</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+--------------------------------+--------------------------------+---------+-------------------+------+----------+-----------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 索引中只使用了 profession 和 age 列，满足最左前缀法则，可以使用索引，索引长度为 72 字节，可以推出 status 列索引长度为 5 字节</span></span><br><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_user <span class="keyword">WHERE</span> profession <span class="operator">=</span> <span class="string">&#x27;软件工程&#x27;</span> <span class="keyword">AND</span> age <span class="operator">=</span> <span class="number">31</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+--------------------------------+--------------------------------+---------+-------------+------+----------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> select_type <span class="operator">|</span> <span class="keyword">table</span>   <span class="operator">|</span> partitions <span class="operator">|</span> type <span class="operator">|</span> possible_keys                  <span class="operator">|</span> key                            <span class="operator">|</span> key_len <span class="operator">|</span> <span class="keyword">ref</span>         <span class="operator">|</span> <span class="keyword">rows</span> <span class="operator">|</span> filtered <span class="operator">|</span> Extra <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+--------------------------------+--------------------------------+---------+-------------+------+----------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> SIMPLE      <span class="operator">|</span> tb_user <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span> <span class="keyword">ref</span>  <span class="operator">|</span> idx_user_profession_age_status <span class="operator">|</span> idx_user_profession_age_status <span class="operator">|</span> <span class="number">72</span>      <span class="operator">|</span> const,const <span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span>   <span class="number">100.00</span> <span class="operator">|</span> <span class="keyword">NULL</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+--------------------------------+--------------------------------+---------+-------------+------+----------+-------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 仅使用 profession 列，仍满足最左前缀法则，仍可以使用索引，且索引长度为 67 字节，可以推出 age 列索引长度为 5 字节</span></span><br><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_user <span class="keyword">WHERE</span> profession <span class="operator">=</span> <span class="string">&#x27;软件工程&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+--------------------------------+--------------------------------+---------+-------+------+----------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> select_type <span class="operator">|</span> <span class="keyword">table</span>   <span class="operator">|</span> partitions <span class="operator">|</span> type <span class="operator">|</span> possible_keys                  <span class="operator">|</span> key                            <span class="operator">|</span> key_len <span class="operator">|</span> <span class="keyword">ref</span>   <span class="operator">|</span> <span class="keyword">rows</span> <span class="operator">|</span> filtered <span class="operator">|</span> Extra <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+--------------------------------+--------------------------------+---------+-------+------+----------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> SIMPLE      <span class="operator">|</span> tb_user <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span> <span class="keyword">ref</span>  <span class="operator">|</span> idx_user_profession_age_status <span class="operator">|</span> idx_user_profession_age_status <span class="operator">|</span> <span class="number">67</span>      <span class="operator">|</span> const <span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span>   <span class="number">100.00</span> <span class="operator">|</span> <span class="keyword">NULL</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+--------------------------------+--------------------------------+---------+-------+------+----------+-------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 虽然使用了 age 和 status 列，但未使用 profession 列，不满足最左前缀法则，不能使用索引</span></span><br><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_user <span class="keyword">WHERE</span> age <span class="operator">=</span> <span class="number">31</span> <span class="keyword">AND</span> status <span class="operator">=</span> <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> select_type <span class="operator">|</span> <span class="keyword">table</span>   <span class="operator">|</span> partitions <span class="operator">|</span> type <span class="operator">|</span> possible_keys <span class="operator">|</span> key  <span class="operator">|</span> key_len <span class="operator">|</span> <span class="keyword">ref</span>  <span class="operator">|</span> <span class="keyword">rows</span> <span class="operator">|</span> filtered <span class="operator">|</span> Extra       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> SIMPLE      <span class="operator">|</span> tb_user <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span> <span class="keyword">ALL</span>  <span class="operator">|</span> <span class="keyword">NULL</span>          <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span>     <span class="number">4.17</span> <span class="operator">|</span> <span class="keyword">Using</span> <span class="keyword">where</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 虽然使用了 profession 和 status 列，但跳过 age 列，因此 age 列及其后续列都无法使用索引，只有 profession 列可以使用索引，因此 索引长度 同上述 SQL 相同，均为 67 字节</span></span><br><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_user <span class="keyword">WHERE</span> profession <span class="operator">=</span> <span class="string">&#x27;软件工程&#x27;</span> <span class="keyword">AND</span> status <span class="operator">=</span> <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+--------------------------------+--------------------------------+---------+-------+------+----------+-----------------------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> select_type <span class="operator">|</span> <span class="keyword">table</span>   <span class="operator">|</span> partitions <span class="operator">|</span> type <span class="operator">|</span> possible_keys                  <span class="operator">|</span> key                            <span class="operator">|</span> key_len <span class="operator">|</span> <span class="keyword">ref</span>   <span class="operator">|</span> <span class="keyword">rows</span> <span class="operator">|</span> filtered <span class="operator">|</span> Extra                 <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+--------------------------------+--------------------------------+---------+-------+------+----------+-----------------------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> SIMPLE      <span class="operator">|</span> tb_user <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span> <span class="keyword">ref</span>  <span class="operator">|</span> idx_user_profession_age_status <span class="operator">|</span> idx_user_profession_age_status <span class="operator">|</span> <span class="number">67</span>      <span class="operator">|</span> const <span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span>    <span class="number">10.00</span> <span class="operator">|</span> <span class="keyword">Using</span> index <span class="keyword">condition</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+--------------------------------+--------------------------------+---------+-------+------+----------+-----------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h3 id="范围查询"><a href="#范围查询" class="headerlink" title="范围查询"></a>范围查询</h3><p>在联合索引中，如果使用了范围查询，如：<code>&gt;、&lt;</code>，范围查询右侧的列不能使用索引。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用了范围查询 age &gt; 30，因此 status 列无法使用索引，索引长度为 72 字节</span></span><br><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_user <span class="keyword">WHERE</span> profession <span class="operator">=</span> <span class="string">&#x27;软件工程&#x27;</span> <span class="keyword">AND</span> age <span class="operator">&gt;</span> <span class="number">30</span> <span class="keyword">AND</span> status <span class="operator">=</span> <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+-------+--------------------------------+--------------------------------+---------+------+------+----------+-----------------------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> select_type <span class="operator">|</span> <span class="keyword">table</span>   <span class="operator">|</span> partitions <span class="operator">|</span> type  <span class="operator">|</span> possible_keys                  <span class="operator">|</span> key                            <span class="operator">|</span> key_len <span class="operator">|</span> <span class="keyword">ref</span>  <span class="operator">|</span> <span class="keyword">rows</span> <span class="operator">|</span> filtered <span class="operator">|</span> Extra                 <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+-------+--------------------------------+--------------------------------+---------+------+------+----------+-----------------------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> SIMPLE      <span class="operator">|</span> tb_user <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span> <span class="keyword">range</span> <span class="operator">|</span> idx_user_profession_age_status <span class="operator">|</span> idx_user_profession_age_status <span class="operator">|</span> <span class="number">72</span>      <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span>    <span class="number">10.00</span> <span class="operator">|</span> <span class="keyword">Using</span> index <span class="keyword">condition</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+-------+--------------------------------+--------------------------------+---------+------+------+----------+-----------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用了范围查询 age &gt;= 30，因此 status 列可以使用索引，索引长度为 77 字节</span></span><br><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_user <span class="keyword">WHERE</span> profession <span class="operator">=</span> <span class="string">&#x27;软件工程&#x27;</span> <span class="keyword">AND</span> age <span class="operator">&gt;=</span> <span class="number">30</span> <span class="keyword">AND</span> status <span class="operator">=</span> <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+-------+--------------------------------+--------------------------------+---------+------+------+----------+-----------------------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> select_type <span class="operator">|</span> <span class="keyword">table</span>   <span class="operator">|</span> partitions <span class="operator">|</span> type  <span class="operator">|</span> possible_keys                  <span class="operator">|</span> key                            <span class="operator">|</span> key_len <span class="operator">|</span> <span class="keyword">ref</span>  <span class="operator">|</span> <span class="keyword">rows</span> <span class="operator">|</span> filtered <span class="operator">|</span> Extra                 <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+-------+--------------------------------+--------------------------------+---------+------+------+----------+-----------------------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> SIMPLE      <span class="operator">|</span> tb_user <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span> <span class="keyword">range</span> <span class="operator">|</span> idx_user_profession_age_status <span class="operator">|</span> idx_user_profession_age_status <span class="operator">|</span> <span class="number">77</span>      <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span>    <span class="number">10.00</span> <span class="operator">|</span> <span class="keyword">Using</span> index <span class="keyword">condition</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+-------+--------------------------------+--------------------------------+---------+------+------+----------+-----------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure>

<h3 id="索引列运算"><a href="#索引列运算" class="headerlink" title="索引列运算"></a>索引列运算</h3><p>不要在索引列上进行运算，否则会导致索引失效。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_user <span class="keyword">WHERE</span> phone <span class="operator">=</span> <span class="string">&#x27;17799990015&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+-------+----------------+----------------+---------+-------+------+----------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> select_type <span class="operator">|</span> <span class="keyword">table</span>   <span class="operator">|</span> partitions <span class="operator">|</span> type  <span class="operator">|</span> possible_keys  <span class="operator">|</span> key            <span class="operator">|</span> key_len <span class="operator">|</span> <span class="keyword">ref</span>   <span class="operator">|</span> <span class="keyword">rows</span> <span class="operator">|</span> filtered <span class="operator">|</span> Extra <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+-------+----------------+----------------+---------+-------+------+----------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> SIMPLE      <span class="operator">|</span> tb_user <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span> const <span class="operator">|</span> idx_user_phone <span class="operator">|</span> idx_user_phone <span class="operator">|</span> <span class="number">47</span>      <span class="operator">|</span> const <span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span>   <span class="number">100.00</span> <span class="operator">|</span> <span class="keyword">NULL</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+-------+----------------+----------------+---------+-------+------+----------+-------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 索引失效</span></span><br><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_user <span class="keyword">WHERE</span> <span class="built_in">SUBSTRING</span>(phone, <span class="number">10</span>, <span class="number">2</span>) <span class="operator">=</span> <span class="string">&#x27;15&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> select_type <span class="operator">|</span> <span class="keyword">table</span>   <span class="operator">|</span> partitions <span class="operator">|</span> type <span class="operator">|</span> possible_keys <span class="operator">|</span> key  <span class="operator">|</span> key_len <span class="operator">|</span> <span class="keyword">ref</span>  <span class="operator">|</span> <span class="keyword">rows</span> <span class="operator">|</span> filtered <span class="operator">|</span> Extra       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> SIMPLE      <span class="operator">|</span> tb_user <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span> <span class="keyword">ALL</span>  <span class="operator">|</span> <span class="keyword">NULL</span>          <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span>   <span class="number">100.00</span> <span class="operator">|</span> <span class="keyword">Using</span> <span class="keyword">where</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h3 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h3><p>字符串类型字段不加单引号，索引失效。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 可能使用 idx_user_phone 索引，但实际未使用，索引失效</span></span><br><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_user <span class="keyword">WHERE</span> phone <span class="operator">=</span> <span class="number">17799990015</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+----------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> select_type <span class="operator">|</span> <span class="keyword">table</span>   <span class="operator">|</span> partitions <span class="operator">|</span> type <span class="operator">|</span> possible_keys  <span class="operator">|</span> key  <span class="operator">|</span> key_len <span class="operator">|</span> <span class="keyword">ref</span>  <span class="operator">|</span> <span class="keyword">rows</span> <span class="operator">|</span> filtered <span class="operator">|</span> Extra       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+----------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> SIMPLE      <span class="operator">|</span> tb_user <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span> <span class="keyword">ALL</span>  <span class="operator">|</span> idx_user_phone <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span>    <span class="number">10.00</span> <span class="operator">|</span> <span class="keyword">Using</span> <span class="keyword">where</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+----------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">3</span> warnings (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h3 id="前缀模糊查询"><a href="#前缀模糊查询" class="headerlink" title="前缀模糊查询"></a>前缀模糊查询</h3><p>模糊查询时，若通配符 <code>%</code> 出现在字符串开头，则索引失效。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 后缀匹配，可以使用索引</span></span><br><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_user <span class="keyword">WHERE</span> phone <span class="keyword">LIKE</span> <span class="string">&#x27;1779999000%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+-------+----------------+----------------+---------+------+------+----------+-----------------------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> select_type <span class="operator">|</span> <span class="keyword">table</span>   <span class="operator">|</span> partitions <span class="operator">|</span> type  <span class="operator">|</span> possible_keys  <span class="operator">|</span> key            <span class="operator">|</span> key_len <span class="operator">|</span> <span class="keyword">ref</span>  <span class="operator">|</span> <span class="keyword">rows</span> <span class="operator">|</span> filtered <span class="operator">|</span> Extra                 <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+-------+----------------+----------------+---------+------+------+----------+-----------------------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> SIMPLE      <span class="operator">|</span> tb_user <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span> <span class="keyword">range</span> <span class="operator">|</span> idx_user_phone <span class="operator">|</span> idx_user_phone <span class="operator">|</span> <span class="number">47</span>      <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span>   <span class="number">10</span> <span class="operator">|</span>   <span class="number">100.00</span> <span class="operator">|</span> <span class="keyword">Using</span> index <span class="keyword">condition</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+-------+----------------+----------------+---------+------+------+----------+-----------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 前缀匹配，索引失效</span></span><br><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_user <span class="keyword">WHERE</span> phone <span class="keyword">LIKE</span> <span class="string">&#x27;%7799990009&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> select_type <span class="operator">|</span> <span class="keyword">table</span>   <span class="operator">|</span> partitions <span class="operator">|</span> type <span class="operator">|</span> possible_keys <span class="operator">|</span> key  <span class="operator">|</span> key_len <span class="operator">|</span> <span class="keyword">ref</span>  <span class="operator">|</span> <span class="keyword">rows</span> <span class="operator">|</span> filtered <span class="operator">|</span> Extra       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> SIMPLE      <span class="operator">|</span> tb_user <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span> <span class="keyword">ALL</span>  <span class="operator">|</span> <span class="keyword">NULL</span>          <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span>    <span class="number">11.11</span> <span class="operator">|</span> <span class="keyword">Using</span> <span class="keyword">where</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h3 id="OR-查询"><a href="#OR-查询" class="headerlink" title="OR 查询"></a>OR 查询</h3><p>使用 <code>OR</code> 连接多个条件时，若其中一个条件未使用索引，则整个查询无法使用索引。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 虽然 id 列使用了主键索引，但 age 列未使用索引，导致整个查询未使用索引</span></span><br><span class="line"><span class="comment">-- age 列虽然有联合索引，但不符合最左前缀法则，索引失效</span></span><br><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_user <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">10</span> <span class="keyword">OR</span> age <span class="operator">=</span> <span class="number">23</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> select_type <span class="operator">|</span> <span class="keyword">table</span>   <span class="operator">|</span> partitions <span class="operator">|</span> type <span class="operator">|</span> possible_keys <span class="operator">|</span> key  <span class="operator">|</span> key_len <span class="operator">|</span> <span class="keyword">ref</span>  <span class="operator">|</span> <span class="keyword">rows</span> <span class="operator">|</span> filtered <span class="operator">|</span> Extra       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> SIMPLE      <span class="operator">|</span> tb_user <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span> <span class="keyword">ALL</span>  <span class="operator">|</span> <span class="keyword">PRIMARY</span>       <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span>    <span class="number">13.75</span> <span class="operator">|</span> <span class="keyword">Using</span> <span class="keyword">where</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 未使用索引，phone 列有索引，但 age 列没有使用索引，导致整个查询未使用索引</span></span><br><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_user <span class="keyword">WHERE</span> phone <span class="operator">=</span> <span class="string">&#x27;17799990000&#x27;</span> <span class="keyword">OR</span> age <span class="operator">=</span> <span class="number">23</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+----------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> select_type <span class="operator">|</span> <span class="keyword">table</span>   <span class="operator">|</span> partitions <span class="operator">|</span> type <span class="operator">|</span> possible_keys  <span class="operator">|</span> key  <span class="operator">|</span> key_len <span class="operator">|</span> <span class="keyword">ref</span>  <span class="operator">|</span> <span class="keyword">rows</span> <span class="operator">|</span> filtered <span class="operator">|</span> Extra       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+----------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> SIMPLE      <span class="operator">|</span> tb_user <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span> <span class="keyword">ALL</span>  <span class="operator">|</span> idx_user_phone <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span>    <span class="number">13.75</span> <span class="operator">|</span> <span class="keyword">Using</span> <span class="keyword">where</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+----------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 为 age 列创建单列索引</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">CREATE</span> INDEX idx_age <span class="keyword">ON</span> tb_user(age);</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.04</span> sec)</span><br><span class="line">Records: <span class="number">0</span>  Duplicates: <span class="number">0</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 因为 id 和 age 列均有索引，所以索引生效</span></span><br><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_user <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">10</span> <span class="keyword">OR</span> age <span class="operator">=</span> <span class="number">23</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+-------------+-----------------+-----------------+---------+------+------+----------+-------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> select_type <span class="operator">|</span> <span class="keyword">table</span>   <span class="operator">|</span> partitions <span class="operator">|</span> type        <span class="operator">|</span> possible_keys   <span class="operator">|</span> key             <span class="operator">|</span> key_len <span class="operator">|</span> <span class="keyword">ref</span>  <span class="operator">|</span> <span class="keyword">rows</span> <span class="operator">|</span> filtered <span class="operator">|</span> Extra                                     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+-------------+-----------------+-----------------+---------+------+------+----------+-------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> SIMPLE      <span class="operator">|</span> tb_user <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span> index_merge <span class="operator">|</span> <span class="keyword">PRIMARY</span>,idx_age <span class="operator">|</span> <span class="keyword">PRIMARY</span>,idx_age <span class="operator">|</span> <span class="number">4</span>,<span class="number">5</span>     <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span>   <span class="number">100.00</span> <span class="operator">|</span> <span class="keyword">Using</span> <span class="keyword">union</span>(<span class="keyword">PRIMARY</span>,idx_age); <span class="keyword">Using</span> <span class="keyword">where</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+-------------+-----------------+-----------------+---------+------+------+----------+-------------------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 因为 phone 列有索引，但 age 列没有索引，所以索引生效</span></span><br><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_user <span class="keyword">WHERE</span> phone <span class="operator">=</span> <span class="string">&#x27;17799990000&#x27;</span> <span class="keyword">OR</span> age <span class="operator">=</span> <span class="number">23</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+-------------+------------------------+------------------------+---------+------+------+----------+--------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> select_type <span class="operator">|</span> <span class="keyword">table</span>   <span class="operator">|</span> partitions <span class="operator">|</span> type        <span class="operator">|</span> possible_keys          <span class="operator">|</span> key                    <span class="operator">|</span> key_len <span class="operator">|</span> <span class="keyword">ref</span>  <span class="operator">|</span> <span class="keyword">rows</span> <span class="operator">|</span> filtered <span class="operator">|</span> Extra                                            <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+-------------+------------------------+------------------------+---------+------+------+----------+--------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> SIMPLE      <span class="operator">|</span> tb_user <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span> index_merge <span class="operator">|</span> idx_user_phone,idx_age <span class="operator">|</span> idx_user_phone,idx_age <span class="operator">|</span> <span class="number">47</span>,<span class="number">5</span>    <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span>   <span class="number">100.00</span> <span class="operator">|</span> <span class="keyword">Using</span> <span class="keyword">union</span>(idx_user_phone,idx_age); <span class="keyword">Using</span> <span class="keyword">where</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+-------------+------------------------+------------------------+---------+------+------+----------+--------------------------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h3 id="数据分布影响"><a href="#数据分布影响" class="headerlink" title="数据分布影响"></a>数据分布影响</h3><p>当使用索引时，MySQL 会根据数据的分布情况来决定是否使用索引。如果某个条件过滤掉的数据量很小，MySQL 可能会选择全表扫描而不是使用索引，因为全表扫描可能更高效。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 绝大部分数据满足条件，使用索引不如全表扫描效率高，索引失效</span></span><br><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_user <span class="keyword">WHERE</span> phone <span class="operator">&gt;=</span> <span class="string">&#x27;17799990011&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+----------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> select_type <span class="operator">|</span> <span class="keyword">table</span>   <span class="operator">|</span> partitions <span class="operator">|</span> type <span class="operator">|</span> possible_keys  <span class="operator">|</span> key  <span class="operator">|</span> key_len <span class="operator">|</span> <span class="keyword">ref</span>  <span class="operator">|</span> <span class="keyword">rows</span> <span class="operator">|</span> filtered <span class="operator">|</span> Extra       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+----------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> SIMPLE      <span class="operator">|</span> tb_user <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span> <span class="keyword">ALL</span>  <span class="operator">|</span> idx_user_phone <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span>    <span class="number">54.17</span> <span class="operator">|</span> <span class="keyword">Using</span> <span class="keyword">where</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+----------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 只有一部分数据满足条件，使用索引比全表扫描更高效，索引生效</span></span><br><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_user <span class="keyword">WHERE</span> phone <span class="operator">&gt;=</span> <span class="string">&#x27;17799990012&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+-------+----------------+----------------+---------+------+------+----------+-----------------------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> select_type <span class="operator">|</span> <span class="keyword">table</span>   <span class="operator">|</span> partitions <span class="operator">|</span> type  <span class="operator">|</span> possible_keys  <span class="operator">|</span> key            <span class="operator">|</span> key_len <span class="operator">|</span> <span class="keyword">ref</span>  <span class="operator">|</span> <span class="keyword">rows</span> <span class="operator">|</span> filtered <span class="operator">|</span> Extra                 <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+-------+----------------+----------------+---------+------+------+----------+-----------------------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> SIMPLE      <span class="operator">|</span> tb_user <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span> <span class="keyword">range</span> <span class="operator">|</span> idx_user_phone <span class="operator">|</span> idx_user_phone <span class="operator">|</span> <span class="number">47</span>      <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span>   <span class="number">12</span> <span class="operator">|</span>   <span class="number">100.00</span> <span class="operator">|</span> <span class="keyword">Using</span> index <span class="keyword">condition</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+-------+----------------+----------------+---------+------+------+----------+-----------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h3 id="SQL-提示"><a href="#SQL-提示" class="headerlink" title="SQL 提示"></a>SQL 提示</h3><p>在 MySQL 中，可以使用 SQL 提示来强制使用索引或避免使用索引</p>
<table>
<thead>
<tr>
<th>语法</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>USE INDEX (index_list)</code></td>
<td>提示优化器在查询时使用指定的<code>（建议）</code></td>
</tr>
<tr>
<td><code>IGNORE INDEX (index_list)</code></td>
<td>提示优化器在查询时忽略指定的索引<code>（建议）</code></td>
</tr>
<tr>
<td><code>FORCE INDEX (index_list)</code></td>
<td>强制优化器在查询时使用指定的索引<code>（强制）</code></td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- profession 列有联合索引，所以查询时会使用联合索引</span></span><br><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_user <span class="keyword">WHERE</span> profession <span class="operator">=</span> <span class="string">&#x27;软件工程&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+--------------------------------+--------------------------------+---------+-------+------+----------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> select_type <span class="operator">|</span> <span class="keyword">table</span>   <span class="operator">|</span> partitions <span class="operator">|</span> type <span class="operator">|</span> possible_keys                  <span class="operator">|</span> key                            <span class="operator">|</span> key_len <span class="operator">|</span> <span class="keyword">ref</span>   <span class="operator">|</span> <span class="keyword">rows</span> <span class="operator">|</span> filtered <span class="operator">|</span> Extra <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+--------------------------------+--------------------------------+---------+-------+------+----------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> SIMPLE      <span class="operator">|</span> tb_user <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span> <span class="keyword">ref</span>  <span class="operator">|</span> idx_user_profession_age_status <span class="operator">|</span> idx_user_profession_age_status <span class="operator">|</span> <span class="number">67</span>      <span class="operator">|</span> const <span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span>   <span class="number">100.00</span> <span class="operator">|</span> <span class="keyword">NULL</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+--------------------------------+--------------------------------+---------+-------+------+----------+-------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 再给 profession 列创建单列索引</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">CREATE</span> INDEX idx_profession <span class="keyword">ON</span> tb_user(profession);</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.04</span> sec)</span><br><span class="line">Records: <span class="number">0</span>  Duplicates: <span class="number">0</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询时仍使用联合索引</span></span><br><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_user <span class="keyword">WHERE</span> profession <span class="operator">=</span> <span class="string">&#x27;软件工程&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+-----------------------------------------------+--------------------------------+---------+-------+------+----------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> select_type <span class="operator">|</span> <span class="keyword">table</span>   <span class="operator">|</span> partitions <span class="operator">|</span> type <span class="operator">|</span> possible_keys                                 <span class="operator">|</span> key                            <span class="operator">|</span> key_len <span class="operator">|</span> <span class="keyword">ref</span>   <span class="operator">|</span> <span class="keyword">rows</span> <span class="operator">|</span> filtered <span class="operator">|</span> Extra <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+-----------------------------------------------+--------------------------------+---------+-------+------+----------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> SIMPLE      <span class="operator">|</span> tb_user <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span> <span class="keyword">ref</span>  <span class="operator">|</span> idx_user_profession_age_status,idx_profession <span class="operator">|</span> idx_user_profession_age_status <span class="operator">|</span> <span class="number">67</span>      <span class="operator">|</span> const <span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span>   <span class="number">100.00</span> <span class="operator">|</span> <span class="keyword">NULL</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+-----------------------------------------------+--------------------------------+---------+-------+------+----------+-------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用 SQL 提示使用 USE INDEX 来建议使用 idx_profession 索引</span></span><br><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_user USE INDEX(idx_profession) <span class="keyword">WHERE</span> profession <span class="operator">=</span> <span class="string">&#x27;软件工程&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+----------------+----------------+---------+-------+------+----------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> select_type <span class="operator">|</span> <span class="keyword">table</span>   <span class="operator">|</span> partitions <span class="operator">|</span> type <span class="operator">|</span> possible_keys  <span class="operator">|</span> key            <span class="operator">|</span> key_len <span class="operator">|</span> <span class="keyword">ref</span>   <span class="operator">|</span> <span class="keyword">rows</span> <span class="operator">|</span> filtered <span class="operator">|</span> Extra <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+----------------+----------------+---------+-------+------+----------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> SIMPLE      <span class="operator">|</span> tb_user <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span> <span class="keyword">ref</span>  <span class="operator">|</span> idx_profession <span class="operator">|</span> idx_profession <span class="operator">|</span> <span class="number">67</span>      <span class="operator">|</span> const <span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span>   <span class="number">100.00</span> <span class="operator">|</span> <span class="keyword">NULL</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+----------------+----------------+---------+-------+------+----------+-------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用 SQL 提示 IGNORE INDEX 来建议忽略使用联合索引 idx_user_profession_age_status</span></span><br><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_user IGNORE INDEX(idx_user_profession_age_status) <span class="keyword">WHERE</span> profession <span class="operator">=</span> <span class="string">&#x27;软件工程&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+----------------+----------------+---------+-------+------+----------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> select_type <span class="operator">|</span> <span class="keyword">table</span>   <span class="operator">|</span> partitions <span class="operator">|</span> type <span class="operator">|</span> possible_keys  <span class="operator">|</span> key            <span class="operator">|</span> key_len <span class="operator">|</span> <span class="keyword">ref</span>   <span class="operator">|</span> <span class="keyword">rows</span> <span class="operator">|</span> filtered <span class="operator">|</span> Extra <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+----------------+----------------+---------+-------+------+----------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> SIMPLE      <span class="operator">|</span> tb_user <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span> <span class="keyword">ref</span>  <span class="operator">|</span> idx_profession <span class="operator">|</span> idx_profession <span class="operator">|</span> <span class="number">67</span>      <span class="operator">|</span> const <span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span>   <span class="number">100.00</span> <span class="operator">|</span> <span class="keyword">NULL</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+----------------+----------------+---------+-------+------+----------+-------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用 SQL 提示 FORCE INDEX 来强制使用 idx_profession 索引</span></span><br><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_user FORCE INDEX(idx_profession) <span class="keyword">WHERE</span> profession <span class="operator">=</span> <span class="string">&#x27;软件工程&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+----------------+----------------+---------+-------+------+----------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> select_type <span class="operator">|</span> <span class="keyword">table</span>   <span class="operator">|</span> partitions <span class="operator">|</span> type <span class="operator">|</span> possible_keys  <span class="operator">|</span> key            <span class="operator">|</span> key_len <span class="operator">|</span> <span class="keyword">ref</span>   <span class="operator">|</span> <span class="keyword">rows</span> <span class="operator">|</span> filtered <span class="operator">|</span> Extra <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+----------------+----------------+---------+-------+------+----------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> SIMPLE      <span class="operator">|</span> tb_user <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span> <span class="keyword">ref</span>  <span class="operator">|</span> idx_profession <span class="operator">|</span> idx_profession <span class="operator">|</span> <span class="number">67</span>      <span class="operator">|</span> const <span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span>   <span class="number">100.00</span> <span class="operator">|</span> <span class="keyword">NULL</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+----------------+----------------+---------+-------+------+----------+-------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h3 id="覆盖索引"><a href="#覆盖索引" class="headerlink" title="覆盖索引"></a>覆盖索引</h3><p>覆盖索引指索引包含查询所使用的列，避免<code>回表</code>。</p>
<ol>
<li>Using index condition：表示使用了索引条件下推（Index Condition Pushdown，ICP），即在索引扫描阶段就过滤掉不符合条件的行，减少回表的行数，从而提高查询效率。</li>
<li>Using where; Using index：表示查询使用了索引，并且索引包含了查询所需的所有列，因此不需要回表，直接从索引中获取数据。</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询的列均存在于联合索引中，避免了回表，使用覆盖索引</span></span><br><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> profession, age, status <span class="keyword">FROM</span> tb_user <span class="keyword">WHERE</span> profession <span class="operator">=</span> <span class="string">&#x27;软件工程&#x27;</span> <span class="keyword">AND</span> age <span class="operator">=</span> <span class="number">31</span> <span class="keyword">AND</span> status <span class="operator">=</span> <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+--------------------------------+--------------------------------+---------+-------------------+------+----------+--------------------------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> select_type <span class="operator">|</span> <span class="keyword">table</span>   <span class="operator">|</span> partitions <span class="operator">|</span> type <span class="operator">|</span> possible_keys                  <span class="operator">|</span> key                            <span class="operator">|</span> key_len <span class="operator">|</span> <span class="keyword">ref</span>               <span class="operator">|</span> <span class="keyword">rows</span> <span class="operator">|</span> filtered <span class="operator">|</span> Extra                    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+--------------------------------+--------------------------------+---------+-------------------+------+----------+--------------------------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> SIMPLE      <span class="operator">|</span> tb_user <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span> <span class="keyword">ref</span>  <span class="operator">|</span> idx_user_profession_age_status <span class="operator">|</span> idx_user_profession_age_status <span class="operator">|</span> <span class="number">77</span>      <span class="operator">|</span> const,const,const <span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span>   <span class="number">100.00</span> <span class="operator">|</span> <span class="keyword">Using</span> <span class="keyword">where</span>; <span class="keyword">Using</span> index <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+--------------------------------+--------------------------------+---------+-------------------+------+----------+--------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- name 列不在联合索引中，导致回表，未使用覆盖索引</span></span><br><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> profession, age, status, name <span class="keyword">FROM</span> tb_user <span class="keyword">WHERE</span> profession <span class="operator">=</span> <span class="string">&#x27;软件工程&#x27;</span> <span class="keyword">AND</span> age <span class="operator">=</span> <span class="number">31</span> <span class="keyword">AND</span> status <span class="operator">=</span> <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+--------------------------------+--------------------------------+---------+-------------------+------+----------+-----------------------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> select_type <span class="operator">|</span> <span class="keyword">table</span>   <span class="operator">|</span> partitions <span class="operator">|</span> type <span class="operator">|</span> possible_keys                  <span class="operator">|</span> key                            <span class="operator">|</span> key_len <span class="operator">|</span> <span class="keyword">ref</span>               <span class="operator">|</span> <span class="keyword">rows</span> <span class="operator">|</span> filtered <span class="operator">|</span> Extra                 <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+--------------------------------+--------------------------------+---------+-------------------+------+----------+-----------------------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> SIMPLE      <span class="operator">|</span> tb_user <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span> <span class="keyword">ref</span>  <span class="operator">|</span> idx_user_profession_age_status <span class="operator">|</span> idx_user_profession_age_status <span class="operator">|</span> <span class="number">77</span>      <span class="operator">|</span> const,const,const <span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span>   <span class="number">100.00</span> <span class="operator">|</span> <span class="keyword">Using</span> index <span class="keyword">condition</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+--------------------------------+--------------------------------+---------+-------------------+------+----------+-----------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="前缀索引"><a href="#前缀索引" class="headerlink" title="前缀索引"></a>前缀索引</h3><p>当数据库中某个字段保存的内容过长，比如一篇文章，在这种情况下，若对该字段建立索引，开销会很大，因此可以使用前缀索引，只对字段的前几个字符建立索引，从而减少索引的大小，提高查询效率。</p>
<blockquote>
<p>CREATE INDEX idx_xxx ON tb_xxx(column(n));</p>
</blockquote>
<p>前缀长度：</p>
<p>根据索引的选择性来决定，即该字段<code>所有值的个数（不重复）</code>与<code>总行数</code>的比值，选择性越高，索引效果越好。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用 email 全部内容作为索引的话，选择性为 1.0000</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> email)<span class="operator">/</span><span class="built_in">COUNT</span>(email) <span class="keyword">FROM</span> tb_user;</span><br><span class="line"><span class="operator">+</span><span class="comment">------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> email)<span class="operator">/</span><span class="built_in">COUNT</span>(email) <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------------------------+</span></span><br><span class="line"><span class="operator">|</span>                             <span class="number">1.0000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用 email 前 10 个字符作为索引的话，选择性仍为 1.0000，所以相比于使用全部内容作为索引，使用前 10 个字符作为索引，效率不变但节约了索引空间</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="built_in">SUBSTRING</span>(email, <span class="number">1</span>, <span class="number">10</span>))<span class="operator">/</span><span class="built_in">COUNT</span>(email) <span class="keyword">FROM</span> tb_user;</span><br><span class="line"><span class="operator">+</span><span class="comment">------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="built_in">SUBSTRING</span>(email, <span class="number">1</span>, <span class="number">10</span>))<span class="operator">/</span><span class="built_in">COUNT</span>(email) <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span>                                               <span class="number">1.0000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------------------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用 email 前 9 个字符作为索引的话，选择性为 0.9583</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="built_in">SUBSTRING</span>(email, <span class="number">1</span>, <span class="number">9</span>))<span class="operator">/</span><span class="built_in">COUNT</span>(email) <span class="keyword">FROM</span> tb_user;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="built_in">SUBSTRING</span>(email, <span class="number">1</span>, <span class="number">9</span>))<span class="operator">/</span><span class="built_in">COUNT</span>(email) <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span>                                              <span class="number">0.9583</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------------------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用 email 前 5 个字符作为索引的话，选择性仍为 0.9583，说明前 5 个字符已经包含了前 9 个字符的大部分信息，因此使用前 5 个字符作为索引，效率更高</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="built_in">SUBSTRING</span>(email, <span class="number">1</span>, <span class="number">5</span>))<span class="operator">/</span><span class="built_in">COUNT</span>(email) <span class="keyword">FROM</span> tb_user;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="built_in">SUBSTRING</span>(email, <span class="number">1</span>, <span class="number">5</span>))<span class="operator">/</span><span class="built_in">COUNT</span>(email) <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span>                                              <span class="number">0.9583</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------------------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用 email 前 4 个字符作为索引的话，选择性为 0.9167</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="built_in">SUBSTRING</span>(email, <span class="number">1</span>, <span class="number">4</span>))<span class="operator">/</span><span class="built_in">COUNT</span>(email) <span class="keyword">FROM</span> tb_user;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="built_in">SUBSTRING</span>(email, <span class="number">1</span>, <span class="number">4</span>))<span class="operator">/</span><span class="built_in">COUNT</span>(email) <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span>                                              <span class="number">0.9167</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------------------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用 email 前 2 个字符作为索引的话，选择性为 0.9167</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="built_in">SUBSTRING</span>(email, <span class="number">1</span>, <span class="number">2</span>))<span class="operator">/</span><span class="built_in">COUNT</span>(email) <span class="keyword">FROM</span> tb_user;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="built_in">SUBSTRING</span>(email, <span class="number">1</span>, <span class="number">2</span>))<span class="operator">/</span><span class="built_in">COUNT</span>(email) <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span>                                              <span class="number">0.9167</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------------------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 为 email 列创建前缀长度为 5 的前缀索引</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">CREATE</span> INDEX idx_user_email_5 <span class="keyword">ON</span> tb_user(email(<span class="number">5</span>));</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.04</span> sec)</span><br><span class="line">Records: <span class="number">0</span>  Duplicates: <span class="number">0</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> INDEX <span class="keyword">FROM</span> tb_user;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------+------------+--------------------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">Table</span>   <span class="operator">|</span> Non_unique <span class="operator">|</span> Key_name                       <span class="operator">|</span> Seq_in_index <span class="operator">|</span> Column_name <span class="operator">|</span> <span class="keyword">Collation</span> <span class="operator">|</span> <span class="keyword">Cardinality</span> <span class="operator">|</span> Sub_part <span class="operator">|</span> Packed <span class="operator">|</span> <span class="keyword">Null</span> <span class="operator">|</span> Index_type <span class="operator">|</span> Comment <span class="operator">|</span> Index_comment <span class="operator">|</span> Visible <span class="operator">|</span> Expression <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+------------+--------------------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+</span></span><br><span class="line"><span class="operator">|</span> tb_user <span class="operator">|</span>          <span class="number">0</span> <span class="operator">|</span> <span class="keyword">PRIMARY</span>                        <span class="operator">|</span>            <span class="number">1</span> <span class="operator">|</span> id          <span class="operator">|</span> A         <span class="operator">|</span>          <span class="number">24</span> <span class="operator">|</span>     <span class="keyword">NULL</span> <span class="operator">|</span>   <span class="keyword">NULL</span> <span class="operator">|</span>      <span class="operator">|</span> BTREE      <span class="operator">|</span>         <span class="operator">|</span>               <span class="operator">|</span> YES     <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> tb_user <span class="operator">|</span>          <span class="number">0</span> <span class="operator">|</span> idx_user_phone                 <span class="operator">|</span>            <span class="number">1</span> <span class="operator">|</span> phone       <span class="operator">|</span> A         <span class="operator">|</span>          <span class="number">24</span> <span class="operator">|</span>     <span class="keyword">NULL</span> <span class="operator">|</span>   <span class="keyword">NULL</span> <span class="operator">|</span> YES  <span class="operator">|</span> BTREE      <span class="operator">|</span>         <span class="operator">|</span>               <span class="operator">|</span> YES     <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> tb_user <span class="operator">|</span>          <span class="number">1</span> <span class="operator">|</span> idx_user_name                  <span class="operator">|</span>            <span class="number">1</span> <span class="operator">|</span> name        <span class="operator">|</span> A         <span class="operator">|</span>          <span class="number">24</span> <span class="operator">|</span>     <span class="keyword">NULL</span> <span class="operator">|</span>   <span class="keyword">NULL</span> <span class="operator">|</span> YES  <span class="operator">|</span> BTREE      <span class="operator">|</span>         <span class="operator">|</span>               <span class="operator">|</span> YES     <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> tb_user <span class="operator">|</span>          <span class="number">1</span> <span class="operator">|</span> idx_user_profession_age_status <span class="operator">|</span>            <span class="number">1</span> <span class="operator">|</span> profession  <span class="operator">|</span> A         <span class="operator">|</span>          <span class="number">16</span> <span class="operator">|</span>     <span class="keyword">NULL</span> <span class="operator">|</span>   <span class="keyword">NULL</span> <span class="operator">|</span> YES  <span class="operator">|</span> BTREE      <span class="operator">|</span>         <span class="operator">|</span>               <span class="operator">|</span> YES     <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> tb_user <span class="operator">|</span>          <span class="number">1</span> <span class="operator">|</span> idx_user_profession_age_status <span class="operator">|</span>            <span class="number">2</span> <span class="operator">|</span> age         <span class="operator">|</span> A         <span class="operator">|</span>          <span class="number">22</span> <span class="operator">|</span>     <span class="keyword">NULL</span> <span class="operator">|</span>   <span class="keyword">NULL</span> <span class="operator">|</span> YES  <span class="operator">|</span> BTREE      <span class="operator">|</span>         <span class="operator">|</span>               <span class="operator">|</span> YES     <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> tb_user <span class="operator">|</span>          <span class="number">1</span> <span class="operator">|</span> idx_user_profession_age_status <span class="operator">|</span>            <span class="number">3</span> <span class="operator">|</span> status      <span class="operator">|</span> A         <span class="operator">|</span>          <span class="number">24</span> <span class="operator">|</span>     <span class="keyword">NULL</span> <span class="operator">|</span>   <span class="keyword">NULL</span> <span class="operator">|</span> YES  <span class="operator">|</span> BTREE      <span class="operator">|</span>         <span class="operator">|</span>               <span class="operator">|</span> YES     <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> tb_user <span class="operator">|</span>          <span class="number">1</span> <span class="operator">|</span> idx_user_email_5               <span class="operator">|</span>            <span class="number">1</span> <span class="operator">|</span> email       <span class="operator">|</span> A         <span class="operator">|</span>          <span class="number">23</span> <span class="operator">|</span>        <span class="number">5</span> <span class="operator">|</span>   <span class="keyword">NULL</span> <span class="operator">|</span> YES  <span class="operator">|</span> BTREE      <span class="operator">|</span>         <span class="operator">|</span>               <span class="operator">|</span> YES     <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+------------+--------------------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+</span></span><br><span class="line"><span class="number">7</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_user <span class="keyword">WHERE</span> email <span class="operator">=</span> <span class="string">&#x27;daqiao666@sina.com&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+-------------+--------------------+------------+------+--------+--------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name   <span class="operator">|</span> phone       <span class="operator">|</span> email              <span class="operator">|</span> profession <span class="operator">|</span> age  <span class="operator">|</span> gender <span class="operator">|</span> status <span class="operator">|</span> create_time         <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+-------------+--------------------+------------+------+--------+--------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">6</span> <span class="operator">|</span> 大桥   <span class="operator">|</span> <span class="number">17799990005</span> <span class="operator">|</span> daqiao666<span class="variable">@sina</span>.com <span class="operator">|</span> 舞蹈       <span class="operator">|</span>   <span class="number">22</span> <span class="operator">|</span> <span class="number">2</span>      <span class="operator">|</span> <span class="number">0</span>      <span class="operator">|</span> <span class="number">2001</span><span class="number">-02</span><span class="number">-07</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+-------------+--------------------+------------+------+--------+--------+---------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_user <span class="keyword">WHERE</span> email <span class="operator">=</span> <span class="string">&#x27;daqiao666@sina.com&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+------------------+------------------+---------+-------+------+----------+-------------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> select_type <span class="operator">|</span> <span class="keyword">table</span>   <span class="operator">|</span> partitions <span class="operator">|</span> type <span class="operator">|</span> possible_keys    <span class="operator">|</span> key              <span class="operator">|</span> key_len <span class="operator">|</span> <span class="keyword">ref</span>   <span class="operator">|</span> <span class="keyword">rows</span> <span class="operator">|</span> filtered <span class="operator">|</span> Extra       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+------------------+------------------+---------+-------+------+----------+-------------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> SIMPLE      <span class="operator">|</span> tb_user <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span> <span class="keyword">ref</span>  <span class="operator">|</span> idx_user_email_5 <span class="operator">|</span> idx_user_email_5 <span class="operator">|</span> <span class="number">23</span>      <span class="operator">|</span> const <span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span>   <span class="number">100.00</span> <span class="operator">|</span> <span class="keyword">Using</span> <span class="keyword">where</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+------------------+------------------+---------+-------+------+----------+-------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h3 id="索引选择"><a href="#索引选择" class="headerlink" title="索引选择"></a>索引选择</h3><p>索引的选择，应该遵循以下原则：</p>
<ol>
<li>索引应该尽可能地小，因为索引本身也需要存储空间。</li>
<li>索引应该尽可能地覆盖查询条件，因为索引本身也需要存储空间。</li>
<li>索引应该尽可能地选择性高，因为选择性高的索引能够更有效地过滤数据。</li>
<li>查询条件过多时，应该考虑使用联合索引，而不是多个单列索引。</li>
</ol>
<h2 id="索引设计"><a href="#索引设计" class="headerlink" title="索引设计"></a>索引设计</h2><ol>
<li>当表的数据量较大时，且查询频繁时，应该考虑创建索引。</li>
<li>对于经常作为查询、排序、分组条件的列，应该考虑创建索引。</li>
<li>尽量使用区分度高的列作为索引列。</li>
<li>若字段中的值过长，可以考虑使用前缀索引。</li>
<li>尽量使用联合索引，而不是多个单列索引。避免回表。</li>
<li>索引不是越多越好，应该平衡索引和查询性能。</li>
</ol>
<h2 id="索引总结"><a href="#索引总结" class="headerlink" title="索引总结"></a>索引总结</h2><ol>
<li>索引概述：索引是一种数据结构，用于加速数据查询。</li>
<li>索引结构：B+树索引、哈希索引等。</li>
<li>索引分类：<ul>
<li>唯一索引、普通索引、组合索引、全文索引。</li>
<li>聚集索引、非聚集索引。</li>
</ul>
</li>
<li>索引语法：<ul>
<li>创建索引：CREATE INDEX index_name ON table_name (column_name);</li>
<li>删除索引：DROP INDEX index_name ON table_name;</li>
<li>查看索引：SHOW INDEX FROM table_name;</li>
</ul>
</li>
<li>SQL 性能分析：<ul>
<li>执行频次、慢查询日志、profile、explain</li>
</ul>
</li>
<li>索引使用：<ul>
<li>最左前缀法则，不满则不使用索引</li>
<li>范围查询，使用等值查询，而不是范围查询，范围查询后续列索引失效</li>
<li>索引列运算，不使用索引</li>
<li>类型转换，不使用索引</li>
<li>前缀模糊查询，不使用索引</li>
<li>OR 查询，若 OR 语句两侧的查询条件中有一个没有索引，则 OR 语句将无法使用索引</li>
<li>数据分布影响，若数据量过小，或者查询条件筛选过少，则放弃索引，扫描全表</li>
<li>SQL 提示，当某个字段拥有多个索引时，可以指定使用哪一个索引</li>
<li>覆盖索引，尽量让索引包含查询返回字段，避免回表</li>
<li>前缀索引，当字段值过长时，可以创建前缀索引，取前 N 个字符作为索引</li>
</ul>
</li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://codedog1024.github.io">Code Dog</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://codedog1024.github.io/2025/11/11/MySQL8/">https://codedog1024.github.io/2025/11/11/MySQL8/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://codedog1024.github.io" target="_blank">代码狗的小屋</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/MySQL/">MySQL</a></div><div class="post-share"><div class="social-share" data-image="/img/10.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/11/09/MySQL7/" title="MySQL 存储引擎"><img class="cover" src="/img/13.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">MySQL 存储引擎</div></div><div class="info-2"><div class="info-item-1">MySQL 体系结构图 客户端连接器：Native C API、JDBC、ODBC、.NET、PHP、Python、Ruby、Cobol 等 MySQL 服务端： 连接层：连接池 服务层：SQL 接口、解析器、查询优化器、缓存 引擎层：可插拔存储引擎 存储层：数据文件、索引文件、数据结构、数据结构描述文件    存储引擎简介存储引擎是 MySQL 数据库管理系统中的核心部分，负责处理数据存储和检索。存储引擎提供了一种机制，将数据存储在数据库管理系统中，并允许用户使用各种查询语句来检索数据。存储引擎是基于表的，而不是库，所以同一个库中的不同表可以有不同的存储引擎。  查看数据库支持的存储引擎  SHOW ENGINES;   设置存储引擎  CREATE TABLE table_name (……) ENGINE&#x3D;[存储引擎名];    123456789101112131415161718192021-- 查看建表语句-- ENGINE=InnoDB 默认存储引擎为 InnoDBSHOW CREATE TABLE account;--...</div></div></div></a><a class="pagination-related" href="/2025/11/24/MySQL9/" title="MySQL SQL 优化"><img class="cover" src="/img/11.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">MySQL SQL 优化</div></div><div class="info-2"><div class="info-item-1">插入优化普通插入插入一条数据 12INSERT INTO tb_user(name, phone, email, profession, age, gender, status, create_time)VALUES (&#x27;吕布&#x27;, 17799990000, &#x27;lvbu666@163,com&#x27;, &#x27;软件工程&#x27;, 23, &#x27;1&#x27;, &#x27;6&#x27;, &#x27;2001-02-02 00:00:00&#x27;);  批量插入当需要插入多条数据时，不建议使用多个插入语句，而是使用批量插入语句，将多个数据放在一个 INSERT 语句中。 但是尽管批量插入可以插入多条数据，但是不建议超过 1000 条，若超过 1000 条数据，可以将数据以 1000 条为一组分批插入。 12345-- 不建议超过 1000 条INSERT INTO tb_user(name, phone, email, profession, age, gender, status, create_time)VALUES...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/10/29/MySQL1/" title="MySQL 概述"><img class="cover" src="/img/03.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-29</div><div class="info-item-2">MySQL 概述</div></div><div class="info-2"><div class="info-item-1">概述数据库：数据库就是一个仓库，将数据进行有组织的存储管理。 MySQL: 是一个关系型数据库管理系统（Relational Database Management System，RDBMS），MySQL 并不是数据库。 SQL：SQL是Structured Query Language的缩写，是一种数据库查询和程序设计语言。我们需要通过编写 SQL 语句来操作数据库。 数据库分类   数据库 类型    Oracle 关系型数据库   MySQL 关系型数据库   SQL Server 关系型数据库   PostgreSQL 关系型数据库   IBM DB2 关系型数据库   SQLite 关系型数据库   MongoDB 非关系型数据库   Microsoft Azure SQL Database 关系型数据库   Hive 关系型数据库   下载安装 MySQL社区版 下载地址 启动、停止 启动命令：net start 服务名 停止命令：net stop 服务名  连接 使用 MySQL 提供的命令行工具 使用 windows 终端，执行 MySQL [-h...</div></div></div></a><a class="pagination-related" href="/2025/10/29/MySQL2/" title="MySQL SQL"><img class="cover" src="/img/13.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-29</div><div class="info-item-2">MySQL SQL</div></div><div class="info-2"><div class="info-item-1">SQL 通用语法 SQL 语句可以单行或多行编写，以分号结尾。 SQL 中应使用空格来格式化语句，提高可读性。 SQL 语句大小写不敏感，但建议使用大写。 注释： 单行注释：--、# 多行注释：/* */    SQL 分类   分类 全称 描述    DDL Data Definition Language 数据定义语言，用于定义数据库对象，如表、索引、视图、存储过程、函数等   DML Data Manipulation Language 数据操作语言，用于对数据库中的数据进行增删改   DQL Data Query Language 数据查询语言，用于查询数据库中的数据   DCL Data Control Language 数据控制语言，用于控制数据库的访问权限   DDL操作数据库   功能 SQL 语法 描述    查询 SHOW DATABASES; 查询全部数据库   查询 SELECT DATABASE(); 查询当前数据库   创建 CREATE DATABASE [IF NOT EXISTS] 数据库名 [DEFAULT CHARACTER SET...</div></div></div></a><a class="pagination-related" href="/2025/11/06/MySQL4/" title="MySQL 约束"><img class="cover" src="/img/09.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-06</div><div class="info-item-2">MySQL 约束</div></div><div class="info-2"><div class="info-item-1">约束约束：作用在表中的字段上，保证字段的数据满足要求，用于保证数据的正确型、有效性、安全性。 分类   约束 作用 关键字    主键 该值必须唯一、不重复、不能为 NULL PRIMARY KEY   外键 该值必须在指定表中存在 FOREIGN KEY   唯一 该值必须唯一、不重复 UNIQUE   非空 该值不能为空 NOT NULL   默认值 若为指定该值，则使用默认值 DEFAULT   检查 检查字段的值 CHECK   约束代码示例123456789101112CREATE TABLE users (    -- 主键，并且自增    id INT PRIMARY KEY AUTO_INCREMENT COMMENT &#x27;ID&#x27;,    -- 唯一，并且不能为空    name VARCHAR(10) NOT NULL UNIQUE COMMENT &#x27;姓名&#x27;,    -- 检查，年龄必须大于 0 且小于 120    age INT CHECK ( age &gt; 0 AND age &lt; 120) COMMENT...</div></div></div></a><a class="pagination-related" href="/2025/11/07/MySQL5/" title="MySQL 多表查询"><img class="cover" src="/img/03.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-07</div><div class="info-item-2">MySQL 多表查询</div></div><div class="info-2"><div class="info-item-1">多表关系在实际开发中，每个表之间都存在一些关系，基本上分为三种：一对一、一对多(多对一)、多对多。 一对一一对一关系，比如：学生表和档案表，对于学生来说，一个学生只能拥有一份档案，而档案只能属于一个学生，这就是一对一。 12345678910111213CREATE TABLE student (    id   INT PRIMARY KEY AUTO_INCREMENT COMMENT &#x27;ID&#x27;,    name VARCHAR(10) UNIQUE NOT NULL COMMENT &#x27;姓名&#x27;) COMMENT &#x27;学生表&#x27;;CREATE TABLE profile (    id   INT PRIMARY KEY AUTO_INCREMENT COMMENT &#x27;ID&#x27;,    phone CHAR(11) UNIQUE COMMENT &#x27;电话号&#x27;,    address VARCHAR(100) COMMENT &#x27;家庭住址&#x27;,    --...</div></div></div></a><a class="pagination-related" href="/2025/11/06/MySQL3/" title="MySQL 函数"><img class="cover" src="/img/10.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-06</div><div class="info-item-2">MySQL 函数</div></div><div class="info-2"><div class="info-item-1">函数函数是一段已经被编写好，可以直接使用的代码片段。MySQL 中内置了很多的函数，我们可以使用这些函数来完成一些简单的任务。 字符串函数常用字符串函数   函数 描述    CONCAT(str1, str2, …) 连接字符串   LOWER(str) 将字符串转换为小写   UPPER(str) 将字符串转换为大写   LPAD(str, len, pad_str) 左填充字符串   RPAD(str, len, pad_str) 右填充字符串   TRIM(str) 去掉字符串两侧的空格   SUBSTRING(str, start, len) 截取字符串   REPLACE(str, old_str, new_str) 替换字符串   LENGTH(str) 返回字符串的长度   LOCATE(substr, str) 返回子字符串在字符串中的位置   INSTR(str,...</div></div></div></a><a class="pagination-related" href="/2025/11/09/MySQL7/" title="MySQL 存储引擎"><img class="cover" src="/img/13.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-09</div><div class="info-item-2">MySQL 存储引擎</div></div><div class="info-2"><div class="info-item-1">MySQL 体系结构图 客户端连接器：Native C API、JDBC、ODBC、.NET、PHP、Python、Ruby、Cobol 等 MySQL 服务端： 连接层：连接池 服务层：SQL 接口、解析器、查询优化器、缓存 引擎层：可插拔存储引擎 存储层：数据文件、索引文件、数据结构、数据结构描述文件    存储引擎简介存储引擎是 MySQL 数据库管理系统中的核心部分，负责处理数据存储和检索。存储引擎提供了一种机制，将数据存储在数据库管理系统中，并允许用户使用各种查询语句来检索数据。存储引擎是基于表的，而不是库，所以同一个库中的不同表可以有不同的存储引擎。  查看数据库支持的存储引擎  SHOW ENGINES;   设置存储引擎  CREATE TABLE table_name (……) ENGINE&#x3D;[存储引擎名];    123456789101112131415161718192021-- 查看建表语句-- ENGINE=InnoDB 默认存储引擎为 InnoDBSHOW CREATE TABLE account;--...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Code Dog</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">38</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E5%89%8D%E7%BD%AE%E5%87%86%E5%A4%87"><span class="toc-number">1.</span> <span class="toc-text">索引前置准备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Linux-%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">1.1.</span> <span class="toc-text">Linux 服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Linux-%E5%AE%89%E8%A3%85-Mysql"><span class="toc-number">1.2.</span> <span class="toc-text">Linux 安装 Mysql</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E4%B8%8D%E4%B8%8A%E5%8E%9F%E5%9B%A0"><span class="toc-number">1.3.</span> <span class="toc-text">连接不上原因</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E6%A6%82%E8%BF%B0"><span class="toc-number">2.</span> <span class="toc-text">索引概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%89%E6%97%A0%E7%B4%A2%E5%BC%95"><span class="toc-number">2.1.</span> <span class="toc-text">有无索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-number">2.2.</span> <span class="toc-text">优缺点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E7%BB%93%E6%9E%84"><span class="toc-number">3.</span> <span class="toc-text">索引结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#B-%E6%A0%91%E7%B4%A2%E5%BC%95"><span class="toc-number">3.1.</span> <span class="toc-text">B+树索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hash-%E7%B4%A2%E5%BC%95"><span class="toc-number">3.2.</span> <span class="toc-text">Hash 索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88-InnoDB-%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E4%BD%BF%E7%94%A8-B-%E6%A0%91%E7%B4%A2%E5%BC%95"><span class="toc-number">3.3.</span> <span class="toc-text">为什么 InnoDB 存储引擎使用 B+树索引</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">4.</span> <span class="toc-text">索引的分类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%B1%BB"><span class="toc-number">4.1.</span> <span class="toc-text">分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%9A%E9%9B%86%E7%B4%A2%E5%BC%95%E5%92%8C%E9%9D%9E%E8%81%9A%E9%9B%86%E7%B4%A2%E5%BC%95"><span class="toc-number">4.2.</span> <span class="toc-text">聚集索引和非聚集索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9E%E8%A1%A8"><span class="toc-number">4.3.</span> <span class="toc-text">回表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0"><span class="toc-number">4.4.</span> <span class="toc-text">练习</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E8%AF%AD%E6%B3%95"><span class="toc-number">5.</span> <span class="toc-text">索引语法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="toc-number">5.1.</span> <span class="toc-text">创建索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E7%B4%A2%E5%BC%95"><span class="toc-number">5.2.</span> <span class="toc-text">查看索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95"><span class="toc-number">5.3.</span> <span class="toc-text">删除索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E7%BB%83%E4%B9%A0"><span class="toc-number">5.4.</span> <span class="toc-text">索引练习</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL-%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90"><span class="toc-number">6.</span> <span class="toc-text">SQL 性能分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL-%E6%89%A7%E8%A1%8C%E9%A2%91%E7%8E%87"><span class="toc-number">6.1.</span> <span class="toc-text">SQL 执行频率</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="toc-number">6.2.</span> <span class="toc-text">慢查询日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#profile-%E8%AF%A6%E6%83%85"><span class="toc-number">6.3.</span> <span class="toc-text">profile 详情</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90-explain"><span class="toc-number">6.4.</span> <span class="toc-text">性能分析 explain</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E6%80%BB%E7%BB%93"><span class="toc-number">6.5.</span> <span class="toc-text">性能分析总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%B4%A2%E5%BC%95"><span class="toc-number">7.</span> <span class="toc-text">使用索引</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="toc-number">7.1.</span> <span class="toc-text">示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E5%B7%A6%E5%89%8D%E7%BC%80%E6%B3%95%E5%88%99"><span class="toc-number">7.2.</span> <span class="toc-text">最左前缀法则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8C%83%E5%9B%B4%E6%9F%A5%E8%AF%A2"><span class="toc-number">7.3.</span> <span class="toc-text">范围查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E5%88%97%E8%BF%90%E7%AE%97"><span class="toc-number">7.4.</span> <span class="toc-text">索引列运算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="toc-number">7.5.</span> <span class="toc-text">类型转换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%BC%80%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2"><span class="toc-number">7.6.</span> <span class="toc-text">前缀模糊查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OR-%E6%9F%A5%E8%AF%A2"><span class="toc-number">7.7.</span> <span class="toc-text">OR 查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%88%86%E5%B8%83%E5%BD%B1%E5%93%8D"><span class="toc-number">7.8.</span> <span class="toc-text">数据分布影响</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL-%E6%8F%90%E7%A4%BA"><span class="toc-number">7.9.</span> <span class="toc-text">SQL 提示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%95"><span class="toc-number">7.10.</span> <span class="toc-text">覆盖索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%BC%80%E7%B4%A2%E5%BC%95"><span class="toc-number">7.11.</span> <span class="toc-text">前缀索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E9%80%89%E6%8B%A9"><span class="toc-number">7.12.</span> <span class="toc-text">索引选择</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E8%AE%BE%E8%AE%A1"><span class="toc-number">8.</span> <span class="toc-text">索引设计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E6%80%BB%E7%BB%93"><span class="toc-number">9.</span> <span class="toc-text">索引总结</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/11/25/MySQL10/" title="MySQL 视图/存储过程/触发器"><img src="/img/05.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL 视图/存储过程/触发器"/></a><div class="content"><a class="title" href="/2025/11/25/MySQL10/" title="MySQL 视图/存储过程/触发器">MySQL 视图/存储过程/触发器</a><time datetime="2025-11-25T14:32:08.000Z" title="发表于 2025-11-25 22:32:08">2025-11-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/11/24/MySQL9/" title="MySQL SQL 优化"><img src="/img/11.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL SQL 优化"/></a><div class="content"><a class="title" href="/2025/11/24/MySQL9/" title="MySQL SQL 优化">MySQL SQL 优化</a><time datetime="2025-11-24T12:40:22.000Z" title="发表于 2025-11-24 20:40:22">2025-11-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/11/11/MySQL8/" title="MySQL 索引"><img src="/img/10.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL 索引"/></a><div class="content"><a class="title" href="/2025/11/11/MySQL8/" title="MySQL 索引">MySQL 索引</a><time datetime="2025-11-11T15:37:21.000Z" title="发表于 2025-11-11 23:37:21">2025-11-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/11/09/MySQL7/" title="MySQL 存储引擎"><img src="/img/13.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL 存储引擎"/></a><div class="content"><a class="title" href="/2025/11/09/MySQL7/" title="MySQL 存储引擎">MySQL 存储引擎</a><time datetime="2025-11-09T15:05:41.000Z" title="发表于 2025-11-09 23:05:41">2025-11-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/11/09/MySQL6/" title="MySQL 事务"><img src="/img/12.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL 事务"/></a><div class="content"><a class="title" href="/2025/11/09/MySQL6/" title="MySQL 事务">MySQL 事务</a><time datetime="2025-11-09T12:30:13.000Z" title="发表于 2025-11-09 20:30:13">2025-11-09</time></div></div></div></div></div></div></main><footer id="footer" style="background: ture;"><div id="footer-wrap"><div class="copyright">&copy;2025 By Code Dog</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script>(() => {
  const destroyAplayer = () => {
    if (window.aplayers) {
      for (let i = 0; i < window.aplayers.length; i++) {
        if (!window.aplayers[i].options.fixed) {
          window.aplayers[i].destroy()
        }
      }
    }
  }

  const runMetingJS = () => {
    typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()
  }

  btf.addGlobalFn('pjaxSend', destroyAplayer, 'destroyAplayer')
  btf.addGlobalFn('pjaxComplete', loadMeting, 'runMetingJS')
})()</script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>(() => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => fn())
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      const usePjax = true
      false 
        ? (usePjax ? pjax.loadUrl('/404.html') : window.location.href = '/404.html')
        : window.location.href = e.request.responseURL
    }
  })
})()</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>